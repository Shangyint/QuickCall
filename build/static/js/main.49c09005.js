/*! For license information please see main.49c09005.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var i=n(43),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,a={},l=null,d=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,i)&&!c.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:d,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},202:(e,t)=>{var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=y.prototype=new b;k.constructor=y,m(k,v.prototype),k.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,w={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,i){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)T.call(t,r)&&!C.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(1===c)a.children=i;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];a.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===a[r]&&(a[r]=c[r]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:w.current}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function O(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return o=o(c=e),e=""===a?"."+R(c,0):a,S(o)?(r="",null!=e&&(r=e.replace(P,"$&/")+"/"),O(o,t,r,"",function(e){return e})):null!=o&&(x(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(P,"$&/")+"/")+e)),t.push(o)),1;if(c=0,a=""===a?".":a+":",S(e))for(var l=0;l<e.length;l++){var d=a+R(s=e[l],l);c+=O(s,t,r,d,o)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(s=e.next()).done;)c+=O(s=s.value,t,r,d=a+R(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function _(e,t,n){if(null==e)return e;var i=[],r=0;return O(e,i,"","",function(e){return t.call(n,e,r++)}),i}function N(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},A={transition:null},D={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:A,ReactCurrentOwner:w};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,n){_(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=M,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=w.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)T.call(t,l)&&!C.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=A.transition;A.transition={};try{e()}finally{A.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,c=e[s],l=s+1,d=e[l];if(0>a(c,n))l<r&&0>a(d,c)?(e[i]=d,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<r&&0>a(d,n)))break e;e[i]=d,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=i(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(l,t)}t=i(d)}}function S(e){if(g=!1,k(e),!m)if(null!==i(l))m=!0,A(T);else{var t=i(d);null!==t&&D(S,t.startTime-e)}}function T(e,n){m=!1,g&&(g=!1,b(x),x=-1),f=!0;var a=p;try{for(k(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!O());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===i(l)&&r(l),k(n)}else r(l);h=i(l)}if(null!==h)var c=!0;else{var u=i(d);null!==u&&D(S,u.startTime-n),c=!1}return c}finally{h=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,C=!1,E=null,x=-1,P=5,R=-1;function O(){return!(t.unstable_now()-R<P)}function _(){if(null!==E){var e=t.unstable_now();R=e;var n=!0;try{n=E(!0,e)}finally{n?w():(C=!1,E=null)}}else C=!1}if("function"===typeof y)w=function(){y(_)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,I=N.port2;N.port1.onmessage=_,w=function(){I.postMessage(null)}}else w=function(){v(_,0)};function A(e){E=e,C||(C=!0,w())}function D(e,n){x=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,A(T))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(d,e),null===i(l)&&e===i(d)&&(g?(b(x),x=-1):g=!0,D(S,a-o))):(e.sortIndex=s,n(l,e),m||f||(m=!0,A(T))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},391:(e,t,n)=>{var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var i=n(43),r=n(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!u.call(f,e)||!u.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var S=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),R=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var U,F=Object.assign;function B(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var z=!1;function V(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var c="\n"+r[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function q(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case w:return"Portal";case x:return"Profiler";case E:return"StrictMode";case N:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case P:return(e._context.displayName||"Context")+".Provider";case O:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return H(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function K(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function J(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=G(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function $(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=K(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function ee(e,t){Z(e,t);var n=K(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ne(e,t.type,n):t.hasOwnProperty("defaultValue")&&ne(e,t.type,K(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function te(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ne(e,t,n){"number"===t&&$(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ie=Array.isArray;function re(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+K(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(ie(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:K(n)}}function se(e,t){var n=K(t.value),i=K(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function de(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,he,pe=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return he(e,t)})}:he);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function be(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ve(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(me).forEach(function(e){ge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]})});var ye=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ke(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function Se(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Te=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Ee=null,xe=null;function Pe(e){if(e=Sr(e)){if("function"!==typeof Ce)throw Error(a(280));var t=e.stateNode;t&&(t=wr(t),Ce(e.stateNode,e.type,t))}}function Re(e){Ee?xe?xe.push(e):xe=[e]:Ee=e}function Oe(){if(Ee){var e=Ee,t=xe;if(xe=Ee=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function _e(e,t){return e(t)}function Ne(){}var Ie=!1;function Ae(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return _e(e,t,n)}finally{Ie=!1,(null!==Ee||null!==xe)&&(Ne(),Oe())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=wr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Me=!1;if(d)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(he){Me=!1}function je(e,t,n,i,r,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(d){this.onError(d)}}var Ue=!1,Fe=null,Be=!1,ze=null,Ve={onError:function(e){Ue=!0,Fe=e}};function qe(e,t,n,i,r,a,o,s,c){Ue=!1,Fe=null,je.apply(Ve,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ke(e){if(He(e)!==e)throw Error(a(188))}function Ge(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Ke(r),e;if(o===i)return Ke(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,c=r.child;c;){if(c===n){s=!0,n=r,i=o;break}if(c===i){s=!0,i=r,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,i=r;break}if(c===i){s=!0,i=o,n=r;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e),null!==e?Je(e):null}function Je(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Je(e);if(null!==t)return t;e=e.sibling}return null}var Qe=r.unstable_scheduleCallback,$e=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Xe=r.unstable_requestPaint,Ze=r.unstable_now,et=r.unstable_getCurrentPriorityLevel,tt=r.unstable_ImmediatePriority,nt=r.unstable_UserBlockingPriority,it=r.unstable_NormalPriority,rt=r.unstable_LowPriority,at=r.unstable_IdlePriority,ot=null,st=null;var ct=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lt(e)/dt|0)|0},lt=Math.log,dt=Math.LN2;var ut=64,ht=4194304;function pt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=pt(s):0!==(a&=o)&&(i=pt(a))}else 0!==(o=n&~r)?i=pt(o):0!==a&&(i=pt(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ct(t)),i|=e[n],t&=~r;return i}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function bt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ct(t)]=n}function kt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ct(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var St=0;function Tt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,Ct,Et,xt,Pt,Rt=!1,Ot=[],_t=null,Nt=null,It=null,At=new Map,Dt=new Map,Mt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jt(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ut(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=Sr(t))&&Ct(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=kr(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void Pt(e.priority,function(){Et(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=Sr(n))&&Ct(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Te=i,n.target.dispatchEvent(i),Te=null,t.shift()}return!0}function zt(e,t,n){Bt(e)&&n.delete(t)}function Vt(){Rt=!1,null!==_t&&Bt(_t)&&(_t=null),null!==Nt&&Bt(Nt)&&(Nt=null),null!==It&&Bt(It)&&(It=null),At.forEach(zt),Dt.forEach(zt)}function qt(e,t){e.blockedOn===t&&(e.blockedOn=null,Rt||(Rt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Vt)))}function Ht(e){function t(t){return qt(t,e)}if(0<Ot.length){qt(Ot[0],e);for(var n=1;n<Ot.length;n++){var i=Ot[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==_t&&qt(_t,e),null!==Nt&&qt(Nt,e),null!==It&&qt(It,e),At.forEach(t),Dt.forEach(t),n=0;n<Mt.length;n++)(i=Mt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Mt.shift()}var Wt=S.ReactCurrentBatchConfig,Kt=!0;function Gt(e,t,n,i){var r=St,a=Wt.transition;Wt.transition=null;try{St=1,Qt(e,t,n,i)}finally{St=r,Wt.transition=a}}function Jt(e,t,n,i){var r=St,a=Wt.transition;Wt.transition=null;try{St=4,Qt(e,t,n,i)}finally{St=r,Wt.transition=a}}function Qt(e,t,n,i){if(Kt){var r=Yt(e,t,n,i);if(null===r)Ki(e,t,i,$t,n),jt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return _t=Ut(_t,e,t,n,i,r),!0;case"dragenter":return Nt=Ut(Nt,e,t,n,i,r),!0;case"mouseover":return It=Ut(It,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return At.set(a,Ut(At.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Dt.set(a,Ut(Dt.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(jt(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var a=Sr(r);if(null!==a&&wt(a),null===(a=Yt(e,t,n,i))&&Ki(e,t,i,$t,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Ki(e,t,i,null,n)}}var $t=null;function Yt(e,t,n,i){if($t=null,null!==(e=kr(e=we(i))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(et()){case tt:return 1;case nt:return 4;case it:case rt:return 16;case at:return 536870912;default:return 16}default:return 16}}var Zt=null,en=null,tn=null;function nn(){if(tn)return tn;var e,t,n=en,i=n.length,r="value"in Zt?Zt.value:Zt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return tn=r.slice(e,1<t?1-t:void 0)}function rn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function an(){return!0}function on(){return!1}function sn(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?an:on,this.isPropagationStopped=on,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=an)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=an)},persist:function(){},isPersistent:an}),t}var cn,ln,dn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=sn(un),pn=F({},un,{view:0,detail:0}),fn=sn(pn),mn=F({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(cn=e.screenX-dn.screenX,ln=e.screenY-dn.screenY):ln=cn=0,dn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),gn=sn(mn),vn=sn(F({},mn,{dataTransfer:0})),bn=sn(F({},pn,{relatedTarget:0})),yn=sn(F({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),kn=F({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Sn=sn(kn),Tn=sn(F({},un,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function Pn(){return xn}var Rn=F({},pn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=rn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Cn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pn,charCode:function(e){return"keypress"===e.type?rn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?rn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),On=sn(Rn),_n=sn(F({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=sn(F({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pn})),In=sn(F({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=F({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=sn(An),Mn=[9,13,27,32],Ln=d&&"CompositionEvent"in window,jn=null;d&&"documentMode"in document&&(jn=document.documentMode);var Un=d&&"TextEvent"in window&&!jn,Fn=d&&(!Ln||jn&&8<jn&&11>=jn),Bn=String.fromCharCode(32),zn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Gn(e,t,n,i){Re(i),0<(t=Ji(t,"onChange")).length&&(n=new hn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Jn=null,Qn=null;function $n(e){Bi(e,0)}function Yn(e){if(Q(Tr(e)))return e}function Xn(e,t){if("change"===e)return t}var Zn=!1;if(d){var ei;if(d){var ti="oninput"in document;if(!ti){var ni=document.createElement("div");ni.setAttribute("oninput","return;"),ti="function"===typeof ni.oninput}ei=ti}else ei=!1;Zn=ei&&(!document.documentMode||9<document.documentMode)}function ii(){Jn&&(Jn.detachEvent("onpropertychange",ri),Qn=Jn=null)}function ri(e){if("value"===e.propertyName&&Yn(Qn)){var t=[];Gn(t,Qn,e,we(e)),Ae($n,t)}}function ai(e,t,n){"focusin"===e?(ii(),Qn=n,(Jn=t).attachEvent("onpropertychange",ri)):"focusout"===e&&ii()}function oi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Qn)}function si(e,t){if("click"===e)return Yn(t)}function ci(e,t){if("input"===e||"change"===e)return Yn(t)}var li="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function di(e,t){if(li(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!u.call(t,r)||!li(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hi(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function pi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fi(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=$((e=t.contentWindow).document)}return t}function mi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gi(e){var t=fi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pi(n.ownerDocument.documentElement,n)){if(null!==i&&mi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=hi(n,a);var o=hi(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vi=d&&"documentMode"in document&&11>=document.documentMode,bi=null,yi=null,ki=null,Si=!1;function Ti(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Si||null==bi||bi!==$(i)||("selectionStart"in(i=bi)&&mi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ki&&di(ki,i)||(ki=i,0<(i=Ji(yi,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=bi)))}function wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ci={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},Ei={},xi={};function Pi(e){if(Ei[e])return Ei[e];if(!Ci[e])return e;var t,n=Ci[e];for(t in n)if(n.hasOwnProperty(t)&&t in xi)return Ei[e]=n[t];return e}d&&(xi=document.createElement("div").style,"AnimationEvent"in window||(delete Ci.animationend.animation,delete Ci.animationiteration.animation,delete Ci.animationstart.animation),"TransitionEvent"in window||delete Ci.transitionend.transition);var Ri=Pi("animationend"),Oi=Pi("animationiteration"),_i=Pi("animationstart"),Ni=Pi("transitionend"),Ii=new Map,Ai="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){Ii.set(e,t),c(t,[e])}for(var Mi=0;Mi<Ai.length;Mi++){var Li=Ai[Mi];Di(Li.toLowerCase(),"on"+(Li[0].toUpperCase()+Li.slice(1)))}Di(Ri,"onAnimationEnd"),Di(Oi,"onAnimationIteration"),Di(_i,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Ni,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ji="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ui=new Set("cancel close invalid load scroll toggle".split(" ").concat(ji));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,c,l){if(qe.apply(this,arguments),Ue){if(!Ue)throw Error(a(198));var d=Fe;Ue=!1,Fe=null,Be||(Be=!0,ze=d)}}(i,t,void 0,e),e.currentTarget=null}function Bi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&r.isPropagationStopped())break e;Fi(r,s,l),a=c}else for(o=0;o<i.length;o++){if(c=(s=i[o]).instance,l=s.currentTarget,s=s.listener,c!==a&&r.isPropagationStopped())break e;Fi(r,s,l),a=c}}}if(Be)throw e=ze,Be=!1,ze=null,e}function zi(e,t){var n=t[vr];void 0===n&&(n=t[vr]=new Set);var i=e+"__bubble";n.has(i)||(Wi(t,e,2,!1),n.add(i))}function Vi(e,t,n){var i=0;t&&(i|=4),Wi(n,e,i,t)}var qi="_reactListening"+Math.random().toString(36).slice(2);function Hi(e){if(!e[qi]){e[qi]=!0,o.forEach(function(t){"selectionchange"!==t&&(Ui.has(t)||Vi(t,!1,e),Vi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[qi]||(t[qi]=!0,Vi("selectionchange",!1,t))}}function Wi(e,t,n,i){switch(Xt(t)){case 1:var r=Gt;break;case 4:r=Jt;break;default:r=Qt}n=r.bind(null,t,n,e),r=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Ki(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=kr(s)))return;if(5===(c=o.tag)||6===c){i=a=o;continue e}s=s.parentNode}}i=i.return}Ae(function(){var i=a,r=we(n),o=[];e:{var s=Ii.get(e);if(void 0!==s){var c=hn,l=e;switch(e){case"keypress":if(0===rn(n))break e;case"keydown":case"keyup":c=On;break;case"focusin":l="focus",c=bn;break;case"focusout":l="blur",c=bn;break;case"beforeblur":case"afterblur":c=bn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Nn;break;case Ri:case Oi:case _i:c=yn;break;case Ni:c=In;break;case"scroll":c=fn;break;case"wheel":c=Dn;break;case"copy":case"cut":case"paste":c=Sn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=_n}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==s?s+"Capture":null:s;d=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=De(f,h))&&d.push(Gi(f,m,p)))),u)break;f=f.return}0<d.length&&(s=new c(s,l,null,n,r),o.push({event:s,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Te||!(l=n.relatedTarget||n.fromElement)||!kr(l)&&!l[gr])&&(c||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?kr(l):null)&&(l!==(u=He(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(d=gn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=_n,m="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==c?s:Tr(c),p=null==l?s:Tr(l),(s=new d(m,f+"leave",c,n,r)).target=u,s.relatedTarget=p,m=null,kr(r)===i&&((d=new d(h,f+"enter",l,n,r)).target=p,d.relatedTarget=u,m=d),u=m,c&&l)e:{for(h=l,f=0,p=d=c;p;p=Qi(p))f++;for(p=0,m=h;m;m=Qi(m))p++;for(;0<f-p;)d=Qi(d),f--;for(;0<p-f;)h=Qi(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=Qi(d),h=Qi(h)}d=null}else d=null;null!==c&&$i(o,s,c,d,!1),null!==l&&null!==u&&$i(o,u,l,d,!0)}if("select"===(c=(s=i?Tr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Xn;else if(Kn(s))if(Zn)g=ci;else{g=oi;var v=ai}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=si);switch(g&&(g=g(e,i))?Gn(o,g,n,r):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ne(s,"number",s.value)),v=i?Tr(i):window,e){case"focusin":(Kn(v)||"true"===v.contentEditable)&&(bi=v,yi=i,ki=null);break;case"focusout":ki=yi=bi=null;break;case"mousedown":Si=!0;break;case"contextmenu":case"mouseup":case"dragend":Si=!1,Ti(o,n,r);break;case"selectionchange":if(vi)break;case"keydown":case"keyup":Ti(o,n,r)}var b;if(Ln)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Hn?Vn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Fn&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Hn&&(b=nn()):(en="value"in(Zt=r)?Zt.value:Zt.textContent,Hn=!0)),0<(v=Ji(i,y)).length&&(y=new Tn(y,e,null,n,r),o.push({event:y,listeners:v}),b?y.data=b:null!==(b=qn(n))&&(y.data=b))),(b=Un?function(e,t){switch(e){case"compositionend":return qn(t);case"keypress":return 32!==t.which?null:(zn=!0,Bn);case"textInput":return(e=t.data)===Bn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Ln&&Vn(e,t)?(e=nn(),tn=en=Zt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Ji(i,"onBeforeInput")).length&&(r=new Tn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=b))}Bi(o,t)})}function Gi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ji(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=De(e,n))&&i.unshift(Gi(e,a,r)),null!=(a=De(e,t))&&i.push(Gi(e,a,r))),e=e.return}return i}function Qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $i(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(c=De(n,a))&&o.unshift(Gi(n,c,s)):r||null!=(c=De(n,a))&&o.push(Gi(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yi=/\r\n?/g,Xi=/\u0000|\uFFFD/g;function Zi(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Xi,"")}function er(e,t,n){if(t=Zi(t),Zi(e)!==t&&n)throw Error(a(425))}function tr(){}var nr=null,ir=null;function rr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ar="function"===typeof setTimeout?setTimeout:void 0,or="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,cr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(lr)}:ar;function lr(e){setTimeout(function(){throw e})}function dr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Ht(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ht(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var pr=Math.random().toString(36).slice(2),fr="__reactFiber$"+pr,mr="__reactProps$"+pr,gr="__reactContainer$"+pr,vr="__reactEvents$"+pr,br="__reactListeners$"+pr,yr="__reactHandles$"+pr;function kr(e){var t=e[fr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gr]||n[fr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=hr(e);null!==e;){if(n=e[fr])return n;e=hr(e)}return t}n=(e=n).parentNode}return null}function Sr(e){return!(e=e[fr]||e[gr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Tr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function wr(e){return e[mr]||null}var Cr=[],Er=-1;function xr(e){return{current:e}}function Pr(e){0>Er||(e.current=Cr[Er],Cr[Er]=null,Er--)}function Rr(e,t){Er++,Cr[Er]=e.current,e.current=t}var Or={},_r=xr(Or),Nr=xr(!1),Ir=Or;function Ar(e,t){var n=e.type.contextTypes;if(!n)return Or;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mr(){Pr(Nr),Pr(_r)}function Lr(e,t,n){if(_r.current!==Or)throw Error(a(168));Rr(_r,t),Rr(Nr,n)}function jr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,W(e)||"Unknown",r));return F({},n,i)}function Ur(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Or,Ir=_r.current,Rr(_r,e),Rr(Nr,Nr.current),!0}function Fr(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=jr(e,t,Ir),i.__reactInternalMemoizedMergedChildContext=e,Pr(Nr),Pr(_r),Rr(_r,e)):Pr(Nr),Rr(Nr,n)}var Br=null,zr=!1,Vr=!1;function qr(e){null===Br?Br=[e]:Br.push(e)}function Hr(){if(!Vr&&null!==Br){Vr=!0;var e=0,t=St;try{var n=Br;for(St=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Br=null,zr=!1}catch(_){throw null!==Br&&(Br=Br.slice(e+1)),Qe(tt,Hr),_}finally{St=t,Vr=!1}}return null}var Wr=[],Kr=0,Gr=null,Jr=0,Qr=[],$r=0,Yr=null,Xr=1,Zr="";function ea(e,t){Wr[Kr++]=Jr,Wr[Kr++]=Gr,Gr=e,Jr=t}function ta(e,t,n){Qr[$r++]=Xr,Qr[$r++]=Zr,Qr[$r++]=Yr,Yr=e;var i=Xr;e=Zr;var r=32-ct(i)-1;i&=~(1<<r),n+=1;var a=32-ct(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Xr=1<<32-ct(t)+r|n<<r|i,Zr=a+e}else Xr=1<<a|n<<r|i,Zr=e}function na(e){null!==e.return&&(ea(e,1),ta(e,1,0))}function ia(e){for(;e===Gr;)Gr=Wr[--Kr],Wr[Kr]=null,Jr=Wr[--Kr],Wr[Kr]=null;for(;e===Yr;)Yr=Qr[--$r],Qr[$r]=null,Zr=Qr[--$r],Qr[$r]=null,Xr=Qr[--$r],Qr[$r]=null}var ra=null,aa=null,oa=!1,sa=null;function ca(e,t){var n=Al(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function la(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,aa=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,aa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Xr,overflow:Zr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Al(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,aa=null,!0);default:return!1}}function da(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ua(e){if(oa){var t=aa;if(t){var n=t;if(!la(e,t)){if(da(e))throw Error(a(418));t=ur(n.nextSibling);var i=ra;t&&la(e,t)?ca(i,n):(e.flags=-4097&e.flags|2,oa=!1,ra=e)}}else{if(da(e))throw Error(a(418));e.flags=-4097&e.flags|2,oa=!1,ra=e}}}function ha(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function pa(e){if(e!==ra)return!1;if(!oa)return ha(e),oa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!rr(e.type,e.memoizedProps)),t&&(t=aa)){if(da(e))throw fa(),Error(a(418));for(;t;)ca(e,t),t=ur(t.nextSibling)}if(ha(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){aa=ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}aa=null}}else aa=ra?ur(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=aa;e;)e=ur(e.nextSibling)}function ma(){aa=ra=null,oa=!1}function ga(e){null===sa?sa=[e]:sa.push(e)}var va=S.ReactCurrentBatchConfig;function ba(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ya(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ka(e){return(0,e._init)(e._payload)}function Sa(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ml(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=Fl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===C?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&ka(a)===t.type)?((i=r(t,n.props)).ref=ba(e,t,n),i.return=e,i):((i=Ll(n.type,n.key,n.props,null,e.mode,i)).ref=ba(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,a){return null===t||7!==t.tag?((t=jl(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case T:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=ba(e,null,t),n.return=e,n;case w:return(t=Bl(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(ie(t)||j(t))return(t=jl(t,e.mode,n,null)).return=e,t;ya(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case T:return n.key===r?l(e,t,n,i):null;case w:return n.key===r?d(e,t,n,i):null;case D:return p(e,t,(r=n._init)(n._payload),i)}if(ie(n)||j(n))return null!==r?null:u(e,t,n,i,null);ya(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case T:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case D:return f(e,t,n,(0,i._init)(i._payload),r)}if(ie(i)||j(i))return u(t,e=e.get(n)||null,i,r,null);ya(t,i)}return null}function m(r,a,s,c){for(var l=null,d=null,u=a,m=a=0,g=null;null!==u&&m<s.length;m++){u.index>m?(g=u,u=null):g=u.sibling;var v=p(r,u,s[m],c);if(null===v){null===u&&(u=g);break}e&&u&&null===v.alternate&&t(r,u),a=o(v,a,m),null===d?l=v:d.sibling=v,d=v,u=g}if(m===s.length)return n(r,u),oa&&ea(r,m),l;if(null===u){for(;m<s.length;m++)null!==(u=h(r,s[m],c))&&(a=o(u,a,m),null===d?l=u:d.sibling=u,d=u);return oa&&ea(r,m),l}for(u=i(r,u);m<s.length;m++)null!==(g=f(u,r,m,s[m],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?m:g.key),a=o(g,a,m),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(r,e)}),oa&&ea(r,m),l}function g(r,s,c,l){var d=j(c);if("function"!==typeof d)throw Error(a(150));if(null==(c=d.call(c)))throw Error(a(151));for(var u=d=null,m=s,g=s=0,v=null,b=c.next();null!==m&&!b.done;g++,b=c.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=p(r,m,b.value,l);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(r,m),s=o(y,s,g),null===u?d=y:u.sibling=y,u=y,m=v}if(b.done)return n(r,m),oa&&ea(r,g),d;if(null===m){for(;!b.done;g++,b=c.next())null!==(b=h(r,b.value,l))&&(s=o(b,s,g),null===u?d=b:u.sibling=b,u=b);return oa&&ea(r,g),d}for(m=i(r,m);!b.done;g++,b=c.next())null!==(b=f(m,r,g,b.value,l))&&(e&&null!==b.alternate&&m.delete(null===b.key?g:b.key),s=o(b,s,g),null===u?d=b:u.sibling=b,u=b);return e&&m.forEach(function(e){return t(r,e)}),oa&&ea(r,g),d}return function e(i,a,o,c){if("object"===typeof o&&null!==o&&o.type===C&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case T:e:{for(var l=o.key,d=a;null!==d;){if(d.key===l){if((l=o.type)===C){if(7===d.tag){n(i,d.sibling),(a=r(d,o.props.children)).return=i,i=a;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===D&&ka(l)===d.type){n(i,d.sibling),(a=r(d,o.props)).ref=ba(i,d,o),a.return=i,i=a;break e}n(i,d);break}t(i,d),d=d.sibling}o.type===C?((a=jl(o.props.children,i.mode,c,o.key)).return=i,i=a):((c=Ll(o.type,o.key,o.props,null,i.mode,c)).ref=ba(i,a,o),c.return=i,i=c)}return s(i);case w:e:{for(d=o.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=Bl(o,i.mode,c)).return=i,i=a}return s(i);case D:return e(i,a,(d=o._init)(o._payload),c)}if(ie(o))return m(i,a,o,c);if(j(o))return g(i,a,o,c);ya(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Fl(o,i.mode,c)).return=i,i=a),s(i)):n(i,a)}}var Ta=Sa(!0),wa=Sa(!1),Ca=xr(null),Ea=null,xa=null,Pa=null;function Ra(){Pa=xa=Ea=null}function Oa(e){var t=Ca.current;Pr(Ca),e._currentValue=t}function _a(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Na(e,t){Ea=e,Pa=xa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ss=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(Pa!==e)if(e={context:e,memoizedValue:t,next:null},null===xa){if(null===Ea)throw Error(a(308));xa=e,Ea.dependencies={lanes:0,firstContext:e}}else xa=xa.next=e;return t}var Aa=null;function Da(e){null===Aa?Aa=[e]:Aa.push(e)}function Ma(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Da(t)):(n.next=r.next,r.next=n),t.interleaved=n,La(e,i)}function La(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ja=!1;function Ua(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&_c)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,La(e,n)}return null===(r=i.interleaved)?(t.next=t,Da(i)):(t.next=r.next,r.next=t),i.interleaved=t,La(e,n)}function Va(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,kt(e,n)}}function qa(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ha(e,t,n,i){var r=e.updateQueue;ja=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===o?a=l:o.next=l,o=c;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===s?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(null!==a){var u=r.baseState;for(o=0,d=l=c=null,s=a;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(p,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,u,h):f)||void 0===h)break e;u=F({},u,h);break e;case 2:ja=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,o|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(c=u),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Uc|=o,e.lanes=o,e.memoizedState=u}}function Wa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Ka={},Ga=xr(Ka),Ja=xr(Ka),Qa=xr(Ka);function $a(e){if(e===Ka)throw Error(a(174));return e}function Ya(e,t){switch(Rr(Qa,t),Rr(Ja,e),Rr(Ga,Ka),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:de(null,"");break;default:t=de(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Pr(Ga),Rr(Ga,t)}function Xa(){Pr(Ga),Pr(Ja),Pr(Qa)}function Za(e){$a(Qa.current);var t=$a(Ga.current),n=de(t,e.type);t!==n&&(Rr(Ja,e),Rr(Ga,n))}function eo(e){Ja.current===e&&(Pr(Ga),Pr(Ja))}var to=xr(0);function no(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var io=[];function ro(){for(var e=0;e<io.length;e++)io[e]._workInProgressVersionPrimary=null;io.length=0}var ao=S.ReactCurrentDispatcher,oo=S.ReactCurrentBatchConfig,so=0,co=null,lo=null,uo=null,ho=!1,po=!1,fo=0,mo=0;function go(){throw Error(a(321))}function vo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!li(e[n],t[n]))return!1;return!0}function bo(e,t,n,i,r,o){if(so=o,co=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ao.current=null===e||null===e.memoizedState?ts:ns,e=n(i,r),po){o=0;do{if(po=!1,fo=0,25<=o)throw Error(a(301));o+=1,uo=lo=null,t.updateQueue=null,ao.current=is,e=n(i,r)}while(po)}if(ao.current=es,t=null!==lo&&null!==lo.next,so=0,uo=lo=co=null,ho=!1,t)throw Error(a(300));return e}function yo(){var e=0!==fo;return fo=0,e}function ko(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===uo?co.memoizedState=uo=e:uo=uo.next=e,uo}function So(){if(null===lo){var e=co.alternate;e=null!==e?e.memoizedState:null}else e=lo.next;var t=null===uo?co.memoizedState:uo.next;if(null!==t)uo=t,lo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(lo=e).memoizedState,baseState:lo.baseState,baseQueue:lo.baseQueue,queue:lo.queue,next:null},null===uo?co.memoizedState=uo=e:uo=uo.next=e}return uo}function To(e,t){return"function"===typeof t?t(e):t}function wo(e){var t=So(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=lo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var c=s=null,l=null,d=o;do{var u=d.lane;if((so&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,s=i):l=l.next=h,co.lanes|=u,Uc|=u}d=d.next}while(null!==d&&d!==o);null===l?s=i:l.next=c,li(i,t.memoizedState)||(Ss=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,co.lanes|=o,Uc|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Co(e){var t=So(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);li(o,t.memoizedState)||(Ss=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Eo(){}function xo(e,t){var n=co,i=So(),r=t(),o=!li(i.memoizedState,r);if(o&&(i.memoizedState=r,Ss=!0),i=i.queue,Uo(Oo.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==uo&&1&uo.memoizedState.tag){if(n.flags|=2048,Ao(9,Ro.bind(null,n,i,r,t),void 0,null),null===Nc)throw Error(a(349));0!==(30&so)||Po(n,t,r)}return r}function Po(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=co.updateQueue)?(t={lastEffect:null,stores:null},co.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ro(e,t,n,i){t.value=n,t.getSnapshot=i,_o(t)&&No(e)}function Oo(e,t,n){return n(function(){_o(t)&&No(e)})}function _o(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!li(e,n)}catch(i){return!0}}function No(e){var t=La(e,1);null!==t&&rl(t,e,1,-1)}function Io(e){var t=ko();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:To,lastRenderedState:e},t.queue=e,e=e.dispatch=$o.bind(null,co,e),[t.memoizedState,e]}function Ao(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=co.updateQueue)?(t={lastEffect:null,stores:null},co.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Do(){return So().memoizedState}function Mo(e,t,n,i){var r=ko();co.flags|=e,r.memoizedState=Ao(1|t,n,void 0,void 0===i?null:i)}function Lo(e,t,n,i){var r=So();i=void 0===i?null:i;var a=void 0;if(null!==lo){var o=lo.memoizedState;if(a=o.destroy,null!==i&&vo(i,o.deps))return void(r.memoizedState=Ao(t,n,a,i))}co.flags|=e,r.memoizedState=Ao(1|t,n,a,i)}function jo(e,t){return Mo(8390656,8,e,t)}function Uo(e,t){return Lo(2048,8,e,t)}function Fo(e,t){return Lo(4,2,e,t)}function Bo(e,t){return Lo(4,4,e,t)}function zo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4,4,zo.bind(null,t,e),n)}function qo(){}function Ho(e,t){var n=So();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&vo(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Wo(e,t){var n=So();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&vo(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ko(e,t,n){return 0===(21&so)?(e.baseState&&(e.baseState=!1,Ss=!0),e.memoizedState=n):(li(n,t)||(n=vt(),co.lanes|=n,Uc|=n,e.baseState=!0),t)}function Go(e,t){var n=St;St=0!==n&&4>n?n:4,e(!0);var i=oo.transition;oo.transition={};try{e(!1),t()}finally{St=n,oo.transition=i}}function Jo(){return So().memoizedState}function Qo(e,t,n){var i=il(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Yo(e))Xo(t,n);else if(null!==(n=Ma(e,t,n,i))){rl(n,e,i,nl()),Zo(n,t,i)}}function $o(e,t,n){var i=il(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(e))Xo(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,li(s,o)){var c=t.interleaved;return null===c?(r.next=r,Da(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=Ma(e,t,r,i))&&(rl(n,e,i,r=nl()),Zo(n,t,i))}}function Yo(e){var t=e.alternate;return e===co||null!==t&&t===co}function Xo(e,t){po=ho=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zo(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,kt(e,n)}}var es={readContext:Ia,useCallback:go,useContext:go,useEffect:go,useImperativeHandle:go,useInsertionEffect:go,useLayoutEffect:go,useMemo:go,useReducer:go,useRef:go,useState:go,useDebugValue:go,useDeferredValue:go,useTransition:go,useMutableSource:go,useSyncExternalStore:go,useId:go,unstable_isNewReconciler:!1},ts={readContext:Ia,useCallback:function(e,t){return ko().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:jo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Mo(4194308,4,zo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Mo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Mo(4,2,e,t)},useMemo:function(e,t){var n=ko();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ko();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Qo.bind(null,co,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ko().memoizedState=e},useState:Io,useDebugValue:qo,useDeferredValue:function(e){return ko().memoizedState=e},useTransition:function(){var e=Io(!1),t=e[0];return e=Go.bind(null,e[1]),ko().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=co,r=ko();if(oa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Nc)throw Error(a(349));0!==(30&so)||Po(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,jo(Oo.bind(null,i,o,e),[e]),i.flags|=2048,Ao(9,Ro.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=ko(),t=Nc.identifierPrefix;if(oa){var n=Zr;t=":"+t+"R"+(n=(Xr&~(1<<32-ct(Xr)-1)).toString(32)+n),0<(n=fo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=mo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ns={readContext:Ia,useCallback:Ho,useContext:Ia,useEffect:Uo,useImperativeHandle:Vo,useInsertionEffect:Fo,useLayoutEffect:Bo,useMemo:Wo,useReducer:wo,useRef:Do,useState:function(){return wo(To)},useDebugValue:qo,useDeferredValue:function(e){return Ko(So(),lo.memoizedState,e)},useTransition:function(){return[wo(To)[0],So().memoizedState]},useMutableSource:Eo,useSyncExternalStore:xo,useId:Jo,unstable_isNewReconciler:!1},is={readContext:Ia,useCallback:Ho,useContext:Ia,useEffect:Uo,useImperativeHandle:Vo,useInsertionEffect:Fo,useLayoutEffect:Bo,useMemo:Wo,useReducer:Co,useRef:Do,useState:function(){return Co(To)},useDebugValue:qo,useDeferredValue:function(e){var t=So();return null===lo?t.memoizedState=e:Ko(t,lo.memoizedState,e)},useTransition:function(){return[Co(To)[0],So().memoizedState]},useMutableSource:Eo,useSyncExternalStore:xo,useId:Jo,unstable_isNewReconciler:!1};function rs(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function as(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=nl(),r=il(e),a=Ba(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=za(e,a,r))&&(rl(t,e,r,i),Va(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=nl(),r=il(e),a=Ba(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=za(e,a,r))&&(rl(t,e,r,i),Va(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=nl(),i=il(e),r=Ba(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=za(e,r,i))&&(rl(t,e,i,n),Va(t,e,i))}};function ss(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!di(n,i)||!di(r,a))}function cs(e,t,n){var i=!1,r=Or,a=t.contextType;return"object"===typeof a&&null!==a?a=Ia(a):(r=Dr(t)?Ir:_r.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ar(e,r):Or),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function ls(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function ds(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Ua(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Ia(a):(a=Dr(t)?Ir:_r.current,r.context=Ar(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(as(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&os.enqueueReplaceState(r,r.state,null),Ha(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function us(e,t){try{var n="",i=t;do{n+=q(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ps(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fs="function"===typeof WeakMap?WeakMap:Map;function ms(e,t,n){(n=Ba(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Kc||(Kc=!0,Gc=i),ps(0,t)},n}function gs(e,t,n){(n=Ba(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ps(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ps(0,t),"function"!==typeof i&&(null===Jc?Jc=new Set([this]):Jc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new fs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Pl.bind(null,e,t,n),t.then(e,e))}function bs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ba(-1,1)).tag=2,za(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ks=S.ReactCurrentOwner,Ss=!1;function Ts(e,t,n,i){t.child=null===e?wa(t,null,n,i):Ta(t,e.child,n,i)}function ws(e,t,n,i,r){n=n.render;var a=t.ref;return Na(t,r),i=bo(e,t,n,i,a,r),n=yo(),null===e||Ss?(oa&&n&&na(t),t.flags|=1,Ts(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ks(e,t,r))}function Cs(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||Dl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Es(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:di)(o,i)&&e.ref===t.ref)return Ks(e,t,r)}return t.flags|=1,(e=Ml(a,i)).ref=t.ref,e.return=t,t.child=e}function Es(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(di(a,i)&&e.ref===t.ref){if(Ss=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Ks(e,t,r);0!==(131072&e.flags)&&(Ss=!0)}}return Rs(e,t,n,i,r)}function xs(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rr(Mc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Rr(Mc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Rr(Mc,Dc),Dc|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,Rr(Mc,Dc),Dc|=i;return Ts(e,t,r,n),t.child}function Ps(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Rs(e,t,n,i,r){var a=Dr(n)?Ir:_r.current;return a=Ar(t,a),Na(t,r),n=bo(e,t,n,i,a,r),i=yo(),null===e||Ss?(oa&&i&&na(t),t.flags|=1,Ts(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ks(e,t,r))}function Os(e,t,n,i,r){if(Dr(n)){var a=!0;Ur(t)}else a=!1;if(Na(t,r),null===t.stateNode)Ws(e,t),cs(t,n,i),ds(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ia(l):l=Ar(t,l=Dr(n)?Ir:_r.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||c!==l)&&ls(t,o,i,l),ja=!1;var h=t.memoizedState;o.state=h,Ha(t,i,o,r),c=t.memoizedState,s!==i||h!==c||Nr.current||ja?("function"===typeof d&&(as(t,n,d,i),c=t.memoizedState),(s=ja||ss(t,n,s,i,h,c,l))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),o.props=i,o.state=c,o.context=l,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Fa(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:rs(t.type,s),o.props=l,u=t.pendingProps,h=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ia(c):c=Ar(t,c=Dr(n)?Ir:_r.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==u||h!==c)&&ls(t,o,i,c),ja=!1,h=t.memoizedState,o.state=h,Ha(t,i,o,r);var f=t.memoizedState;s!==u||h!==f||Nr.current||ja?("function"===typeof p&&(as(t,n,p,i),f=t.memoizedState),(l=ja||ss(t,n,l,i,h,f,c)||!1)?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=c,i=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return _s(e,t,n,i,a,r)}function _s(e,t,n,i,r,a){Ps(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&Fr(t,n,!1),Ks(e,t,a);i=t.stateNode,ks.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Ta(t,e.child,null,a),t.child=Ta(t,null,s,a)):Ts(e,t,s,a),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function Ns(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),Ya(e,t.containerInfo)}function Is(e,t,n,i,r){return ma(),ga(r),t.flags|=256,Ts(e,t,n,i),t.child}var As,Ds,Ms,Ls,js={dehydrated:null,treeContext:null,retryLane:0};function Us(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var i,r=t.pendingProps,o=to.current,s=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Rr(to,1&o),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,s?(r=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Ul(c,r,0,null),e=jl(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Us(n),t.memoizedState=js,e):Bs(t,c));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,s){if(n)return 256&t.flags?(t.flags&=-257,zs(e,t,s,i=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Ul({mode:"visible",children:i.children},r,0,null),(o=jl(o,r,s,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Ta(t,e.child,null,s),t.child.memoizedState=Us(s),t.memoizedState=js,o);if(0===(1&t.mode))return zs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var c=i.dgst;return i=c,zs(e,t,s,i=hs(o=Error(a(419)),i,void 0))}if(c=0!==(s&e.childLanes),Ss||c){if(null!==(i=Nc)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,La(e,r),rl(i,e,r,-1))}return vl(),zs(e,t,s,i=hs(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ol.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,aa=ur(r.nextSibling),ra=t,oa=!0,sa=null,null!==e&&(Qr[$r++]=Xr,Qr[$r++]=Zr,Qr[$r++]=Yr,Xr=e.id,Zr=e.overflow,Yr=t),t=Bs(t,i.children),t.flags|=4096,t)}(e,t,c,r,i,o,n);if(s){s=r.fallback,c=t.mode,i=(o=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Ml(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Ml(i,s):(s=jl(s,c,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,c=null===(c=e.child.memoizedState)?Us(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=js,r}return e=(s=e.child).sibling,r=Ml(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Bs(e,t){return(t=Ul({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zs(e,t,n,i){return null!==i&&ga(i),Ta(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),_a(e.return,t,n)}function qs(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Hs(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(Ts(e,t,i.children,n),0!==(2&(i=to.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vs(e,n,t);else if(19===e.tag)Vs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Rr(to,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===no(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),qs(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===no(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}qs(t,!0,n,null,a);break;case"together":qs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ws(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ks(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Uc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ml(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ml(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!oa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Js(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Qs(e,t,n){var i=t.pendingProps;switch(ia(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Js(t),null;case 1:case 17:return Dr(t.type)&&Mr(),Js(t),null;case 3:return i=t.stateNode,Xa(),Pr(Nr),Pr(_r),ro(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(pa(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==sa&&(cl(sa),sa=null))),Ds(e,t),Js(t),null;case 5:eo(t);var r=$a(Qa.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Js(t),null}if(e=$a(Ga.current),pa(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[fr]=t,i[mr]=o,e=0!==(1&t.mode),n){case"dialog":zi("cancel",i),zi("close",i);break;case"iframe":case"object":case"embed":zi("load",i);break;case"video":case"audio":for(r=0;r<ji.length;r++)zi(ji[r],i);break;case"source":zi("error",i);break;case"img":case"image":case"link":zi("error",i),zi("load",i);break;case"details":zi("toggle",i);break;case"input":X(i,o),zi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},zi("invalid",i);break;case"textarea":oe(i,o),zi("invalid",i)}for(var c in ke(n,o),r=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==o.suppressHydrationWarning&&er(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&er(i.textContent,l,e),r=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&zi("scroll",i)}switch(n){case"input":J(i),te(i,o,!0);break;case"textarea":J(i),ce(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=tr)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[fr]=t,e[mr]=i,As(e,t,!1,!1),t.stateNode=e;e:{switch(c=Se(n,i),n){case"dialog":zi("cancel",e),zi("close",e),r=i;break;case"iframe":case"object":case"embed":zi("load",e),r=i;break;case"video":case"audio":for(r=0;r<ji.length;r++)zi(ji[r],e);r=i;break;case"source":zi("error",e),r=i;break;case"img":case"image":case"link":zi("error",e),zi("load",e),r=i;break;case"details":zi("toggle",e),r=i;break;case"input":X(e,i),r=Y(e,i),zi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),zi("invalid",e);break;case"textarea":oe(e,i),r=ae(e,i),zi("invalid",e)}for(o in ke(n,r),l=r)if(l.hasOwnProperty(o)){var d=l[o];"style"===o?be(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&pe(e,d):"children"===o?"string"===typeof d?("textarea"!==n||""!==d)&&fe(e,d):"number"===typeof d&&fe(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=d&&"onScroll"===o&&zi("scroll",e):null!=d&&y(e,o,d,c))}switch(n){case"input":J(e),te(e,i,!1);break;case"textarea":J(e),ce(e);break;case"option":null!=i.value&&e.setAttribute("value",""+K(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?re(e,!!i.multiple,o,!1):null!=i.defaultValue&&re(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=tr)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Js(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(n=$a(Qa.current),$a(Ga.current),pa(t)){if(i=t.stateNode,n=t.memoizedProps,i[fr]=t,(o=i.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:er(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&er(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[fr]=t,t.stateNode=i}return Js(t),null;case 13:if(Pr(to),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(oa&&null!==aa&&0!==(1&t.mode)&&0===(128&t.flags))fa(),ma(),t.flags|=98560,o=!1;else if(o=pa(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[fr]=t}else ma(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Js(t),o=!1}else null!==sa&&(cl(sa),sa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&to.current)?0===Lc&&(Lc=3):vl())),null!==t.updateQueue&&(t.flags|=4),Js(t),null);case 4:return Xa(),Ds(e,t),null===e&&Hi(t.stateNode.containerInfo),Js(t),null;case 10:return Oa(t.type._context),Js(t),null;case 19:if(Pr(to),null===(o=t.memoizedState))return Js(t),null;if(i=0!==(128&t.flags),null===(c=o.rendering))if(i)Gs(o,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=no(e))){for(t.flags|=128,Gs(o,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Rr(to,1&to.current|2),t.child}e=e.sibling}null!==o.tail&&Ze()>Hc&&(t.flags|=128,i=!0,Gs(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=no(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!oa)return Js(t),null}else 2*Ze()-o.renderingStartTime>Hc&&1073741824!==n&&(t.flags|=128,i=!0,Gs(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ze(),t.sibling=null,n=to.current,Rr(to,i?1&n|2:1&n),t):(Js(t),null);case 22:case 23:return pl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Js(t),6&t.subtreeFlags&&(t.flags|=8192)):Js(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function $s(e,t){switch(ia(t),t.tag){case 1:return Dr(t.type)&&Mr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Xa(),Pr(Nr),Pr(_r),ro(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return eo(t),null;case 13:if(Pr(to),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ma()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Pr(to),null;case 4:return Xa(),null;case 10:return Oa(t.type._context),null;case 22:case 23:return pl(),null;default:return null}}As=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ms=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,$a(Ga.current);var a,o=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),o=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),o=[];break;case"textarea":r=ae(e,r),i=ae(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=tr)}for(d in ke(n,i),n=null,r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var c=r[d];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(s.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in i){var l=i[d];if(c=null!=r?r[d]:void 0,i.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(a in c)!c.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&c[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(s.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&zi("scroll",e),o||c===l||(o=[])):(o=o||[]).push(d,l))}n&&(o=o||[]).push("style",n);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Ls=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ys=!1,Xs=!1,Zs="function"===typeof WeakSet?WeakSet:Set,ec=null;function tc(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){xl(e,t,i)}else n.current=null}function nc(e,t,n){try{n()}catch(i){xl(e,t,i)}}var ic=!1;function rc(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&nc(t,n,a)}r=r.next}while(r!==i)}}function ac(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function oc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sc(e){var t=e.alternate;null!==t&&(e.alternate=null,sc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fr],delete t[mr],delete t[vr],delete t[br],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function cc(e){return 5===e.tag||3===e.tag||4===e.tag}function lc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||cc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function dc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=tr));else if(4!==i&&null!==(e=e.child))for(dc(e,t,n),e=e.sibling;null!==e;)dc(e,t,n),e=e.sibling}function uc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var hc=null,pc=!1;function fc(e,t,n){for(n=n.child;null!==n;)mc(e,t,n),n=n.sibling}function mc(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:Xs||tc(n,t);case 6:var i=hc,r=pc;hc=null,fc(e,t,n),pc=r,null!==(hc=i)&&(pc?(e=hc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hc.removeChild(n.stateNode));break;case 18:null!==hc&&(pc?(e=hc,n=n.stateNode,8===e.nodeType?dr(e.parentNode,n):1===e.nodeType&&dr(e,n),Ht(e)):dr(hc,n.stateNode));break;case 4:i=hc,r=pc,hc=n.stateNode.containerInfo,pc=!0,fc(e,t,n),hc=i,pc=r;break;case 0:case 11:case 14:case 15:if(!Xs&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&nc(n,t,o),r=r.next}while(r!==i)}fc(e,t,n);break;case 1:if(!Xs&&(tc(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){xl(n,t,s)}fc(e,t,n);break;case 21:fc(e,t,n);break;case 22:1&n.mode?(Xs=(i=Xs)||null!==n.memoizedState,fc(e,t,n),Xs=i):fc(e,t,n);break;default:fc(e,t,n)}}function gc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zs),t.forEach(function(t){var i=_l.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function vc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:hc=c.stateNode,pc=!1;break e;case 3:case 4:hc=c.stateNode.containerInfo,pc=!0;break e}c=c.return}if(null===hc)throw Error(a(160));mc(o,s,r),hc=null,pc=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(d){xl(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)bc(t,e),t=t.sibling}function bc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vc(t,e),yc(e),4&i){try{rc(3,e,e.return),ac(3,e)}catch(g){xl(e,e.return,g)}try{rc(5,e,e.return)}catch(g){xl(e,e.return,g)}}break;case 1:vc(t,e),yc(e),512&i&&null!==n&&tc(n,n.return);break;case 5:if(vc(t,e),yc(e),512&i&&null!==n&&tc(n,n.return),32&e.flags){var r=e.stateNode;try{fe(r,"")}catch(g){xl(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&Z(r,o),Se(c,s);var d=Se(c,o);for(s=0;s<l.length;s+=2){var u=l[s],h=l[s+1];"style"===u?be(r,h):"dangerouslySetInnerHTML"===u?pe(r,h):"children"===u?fe(r,h):y(r,u,h,d)}switch(c){case"input":ee(r,o);break;case"textarea":se(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?re(r,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?re(r,!!o.multiple,o.defaultValue,!0):re(r,!!o.multiple,o.multiple?[]:"",!1))}r[mr]=o}catch(g){xl(e,e.return,g)}}break;case 6:if(vc(t,e),yc(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(g){xl(e,e.return,g)}}break;case 3:if(vc(t,e),yc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(g){xl(e,e.return,g)}break;case 4:default:vc(t,e),yc(e);break;case 13:vc(t,e),yc(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(qc=Ze())),4&i&&gc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Xs=(d=Xs)||u,vc(t,e),Xs=d):vc(t,e),yc(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(ec=e,u=e.child;null!==u;){for(h=ec=u;null!==ec;){switch(f=(p=ec).child,p.tag){case 0:case 11:case 14:case 15:rc(4,p,p.return);break;case 1:tc(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){xl(i,n,g)}}break;case 5:tc(p,p.return);break;case 22:if(null!==p.memoizedState){wc(h);continue}}null!==f?(f.return=p,ec=f):wc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=ve("display",s))}catch(g){xl(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){xl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:vc(t,e),yc(e),4&i&&gc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(cc(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(fe(r,""),i.flags&=-33),uc(e,lc(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;dc(e,lc(e),o);break;default:throw Error(a(161))}}catch(s){xl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function kc(e,t,n){ec=e,Sc(e,t,n)}function Sc(e,t,n){for(var i=0!==(1&e.mode);null!==ec;){var r=ec,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ys;if(!o){var s=r.alternate,c=null!==s&&null!==s.memoizedState||Xs;s=Ys;var l=Xs;if(Ys=o,(Xs=c)&&!l)for(ec=r;null!==ec;)c=(o=ec).child,22===o.tag&&null!==o.memoizedState?Cc(r):null!==c?(c.return=o,ec=c):Cc(r);for(;null!==a;)ec=a,Sc(a,t,n),a=a.sibling;ec=r,Ys=s,Xs=l}Tc(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,ec=a):Tc(e)}}function Tc(e){for(;null!==ec;){var t=ec;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xs||ac(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Xs)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:rs(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Wa(t,o,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wa(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Ht(h)}}}break;default:throw Error(a(163))}Xs||512&t.flags&&oc(t)}catch(k){xl(t,t.return,k)}}if(t===e){ec=null;break}if(null!==(n=t.sibling)){n.return=t.return,ec=n;break}ec=t.return}}function wc(e){for(;null!==ec;){var t=ec;if(t===e){ec=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ec=n;break}ec=t.return}}function Cc(e){for(;null!==ec;){var t=ec;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ac(4,t)}catch(c){xl(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(c){xl(t,r,c)}}var a=t.return;try{oc(t)}catch(c){xl(t,a,c)}break;case 5:var o=t.return;try{oc(t)}catch(c){xl(t,o,c)}}}catch(c){xl(t,t.return,c)}if(t===e){ec=null;break}var s=t.sibling;if(null!==s){s.return=t.return,ec=s;break}ec=t.return}}var Ec,xc=Math.ceil,Pc=S.ReactCurrentDispatcher,Rc=S.ReactCurrentOwner,Oc=S.ReactCurrentBatchConfig,_c=0,Nc=null,Ic=null,Ac=0,Dc=0,Mc=xr(0),Lc=0,jc=null,Uc=0,Fc=0,Bc=0,zc=null,Vc=null,qc=0,Hc=1/0,Wc=null,Kc=!1,Gc=null,Jc=null,Qc=!1,$c=null,Yc=0,Xc=0,Zc=null,el=-1,tl=0;function nl(){return 0!==(6&_c)?Ze():-1!==el?el:el=Ze()}function il(e){return 0===(1&e.mode)?1:0!==(2&_c)&&0!==Ac?Ac&-Ac:null!==va.transition?(0===tl&&(tl=vt()),tl):0!==(e=St)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function rl(e,t,n,i){if(50<Xc)throw Xc=0,Zc=null,Error(a(185));yt(e,n,i),0!==(2&_c)&&e===Nc||(e===Nc&&(0===(2&_c)&&(Fc|=n),4===Lc&&ll(e,Ac)),al(e,i),1===n&&0===_c&&0===(1&t.mode)&&(Hc=Ze()+500,zr&&Hr()))}function al(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ct(a),s=1<<o,c=r[o];-1===c?0!==(s&n)&&0===(s&i)||(r[o]=mt(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=ft(e,e===Nc?Ac:0);if(0===i)null!==n&&$e(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&$e(n),1===t)0===e.tag?function(e){zr=!0,qr(e)}(dl.bind(null,e)):qr(dl.bind(null,e)),cr(function(){0===(6&_c)&&Hr()}),n=null;else{switch(Tt(i)){case 1:n=tt;break;case 4:n=nt;break;case 16:default:n=it;break;case 536870912:n=at}n=Nl(n,ol.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ol(e,t){if(el=-1,tl=0,0!==(6&_c))throw Error(a(327));var n=e.callbackNode;if(Cl()&&e.callbackNode!==n)return null;var i=ft(e,e===Nc?Ac:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=bl(e,i);else{t=i;var r=_c;_c|=2;var o=gl();for(Nc===e&&Ac===t||(Wc=null,Hc=Ze()+500,fl(e,t));;)try{kl();break}catch(c){ml(e,c)}Ra(),Pc.current=o,_c=r,null!==Ic?t=0:(Nc=null,Ac=0,t=Lc)}if(0!==t){if(2===t&&(0!==(r=gt(e))&&(i=r,t=sl(e,r))),1===t)throw n=jc,fl(e,0),ll(e,i),al(e,Ze()),n;if(6===t)ll(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!li(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=bl(e,i))&&(0!==(o=gt(e))&&(i=o,t=sl(e,o))),1===t))throw n=jc,fl(e,0),ll(e,i),al(e,Ze()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:wl(e,Vc,Wc);break;case 3:if(ll(e,i),(130023424&i)===i&&10<(t=qc+500-Ze())){if(0!==ft(e,0))break;if(((r=e.suspendedLanes)&i)!==i){nl(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ar(wl.bind(null,e,Vc,Wc),t);break}wl(e,Vc,Wc);break;case 4:if(ll(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ct(i);o=1<<s,(s=t[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Ze()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*xc(i/1960))-i)){e.timeoutHandle=ar(wl.bind(null,e,Vc,Wc),i);break}wl(e,Vc,Wc);break;default:throw Error(a(329))}}}return al(e,Ze()),e.callbackNode===n?ol.bind(null,e):null}function sl(e,t){var n=zc;return e.current.memoizedState.isDehydrated&&(fl(e,t).flags|=256),2!==(e=bl(e,t))&&(t=Vc,Vc=n,null!==t&&cl(t)),e}function cl(e){null===Vc?Vc=e:Vc.push.apply(Vc,e)}function ll(e,t){for(t&=~Bc,t&=~Fc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ct(t),i=1<<n;e[n]=-1,t&=~i}}function dl(e){if(0!==(6&_c))throw Error(a(327));Cl();var t=ft(e,0);if(0===(1&t))return al(e,Ze()),null;var n=bl(e,t);if(0!==e.tag&&2===n){var i=gt(e);0!==i&&(t=i,n=sl(e,i))}if(1===n)throw n=jc,fl(e,0),ll(e,t),al(e,Ze()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wl(e,Vc,Wc),al(e,Ze()),null}function ul(e,t){var n=_c;_c|=1;try{return e(t)}finally{0===(_c=n)&&(Hc=Ze()+500,zr&&Hr())}}function hl(e){null!==$c&&0===$c.tag&&0===(6&_c)&&Cl();var t=_c;_c|=1;var n=Oc.transition,i=St;try{if(Oc.transition=null,St=1,e)return e()}finally{St=i,Oc.transition=n,0===(6&(_c=t))&&Hr()}}function pl(){Dc=Mc.current,Pr(Mc)}function fl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,or(n)),null!==Ic)for(n=Ic.return;null!==n;){var i=n;switch(ia(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Mr();break;case 3:Xa(),Pr(Nr),Pr(_r),ro();break;case 5:eo(i);break;case 4:Xa();break;case 13:case 19:Pr(to);break;case 10:Oa(i.type._context);break;case 22:case 23:pl()}n=n.return}if(Nc=e,Ic=e=Ml(e.current,null),Ac=Dc=t,Lc=0,jc=null,Bc=Fc=Uc=0,Vc=zc=null,null!==Aa){for(t=0;t<Aa.length;t++)if(null!==(i=(n=Aa[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}Aa=null}return e}function ml(e,t){for(;;){var n=Ic;try{if(Ra(),ao.current=es,ho){for(var i=co.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ho=!1}if(so=0,uo=lo=co=null,po=!1,fo=0,Rc.current=null,null===n||null===n.return){Lc=1,jc=t,Ic=null;break}e:{var o=e,s=n.return,c=n,l=t;if(t=Ac,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=bs(s);if(null!==f){f.flags&=-257,ys(f,s,c,0,t),1&f.mode&&vs(o,d,t),l=d;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){vs(o,d,t),vl();break e}l=Error(a(426))}else if(oa&&1&c.mode){var v=bs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),ys(v,s,c,0,t),ga(us(l,c));break e}}o=l=us(l,c),4!==Lc&&(Lc=2),null===zc?zc=[o]:zc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,qa(o,ms(0,l,t));break e;case 1:c=l;var b=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Jc||!Jc.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,qa(o,gs(o,c,t));break e}}o=o.return}while(null!==o)}Tl(n)}catch(k){t=k,Ic===n&&null!==n&&(Ic=n=n.return);continue}break}}function gl(){var e=Pc.current;return Pc.current=es,null===e?es:e}function vl(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Nc||0===(268435455&Uc)&&0===(268435455&Fc)||ll(Nc,Ac)}function bl(e,t){var n=_c;_c|=2;var i=gl();for(Nc===e&&Ac===t||(Wc=null,fl(e,t));;)try{yl();break}catch(_){ml(e,_)}if(Ra(),_c=n,Pc.current=i,null!==Ic)throw Error(a(261));return Nc=null,Ac=0,Lc}function yl(){for(;null!==Ic;)Sl(Ic)}function kl(){for(;null!==Ic&&!Ye();)Sl(Ic)}function Sl(e){var t=Ec(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?Tl(e):Ic=t,Rc.current=null}function Tl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Qs(n,t,Dc)))return void(Ic=n)}else{if(null!==(n=$s(n,t)))return n.flags&=32767,void(Ic=n);if(null===e)return Lc=6,void(Ic=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ic=t);Ic=t=e}while(null!==t);0===Lc&&(Lc=5)}function wl(e,t,n){var i=St,r=Oc.transition;try{Oc.transition=null,St=1,function(e,t,n,i){do{Cl()}while(null!==$c);if(0!==(6&_c))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ct(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,o),e===Nc&&(Ic=Nc=null,Ac=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Qc||(Qc=!0,Nl(it,function(){return Cl(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Oc.transition,Oc.transition=null;var s=St;St=1;var c=_c;_c|=4,Rc.current=null,function(e,t){if(nr=Kt,mi(e=fi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(S){n=null;break e}var s=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(c=s+r),h!==o||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++d===r&&(c=s),p===o&&++u===i&&(l=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ir={focusedElem:e,selectionRange:n},Kt=!1,ec=t;null!==ec;)if(e=(t=ec).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,ec=e;else for(;null!==ec;){t=ec;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:rs(t.type,g),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(a(163))}}catch(S){xl(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,ec=e;break}ec=t.return}m=ic,ic=!1}(e,n),bc(n,e),gi(ir),Kt=!!nr,ir=nr=null,e.current=n,kc(n,e,r),Xe(),_c=c,St=s,Oc.transition=o}else e.current=n;if(Qc&&(Qc=!1,$c=e,Yc=r),o=e.pendingLanes,0===o&&(Jc=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),al(e,Ze()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Kc)throw Kc=!1,e=Gc,Gc=null,e;0!==(1&Yc)&&0!==e.tag&&Cl(),o=e.pendingLanes,0!==(1&o)?e===Zc?Xc++:(Xc=0,Zc=e):Xc=0,Hr()}(e,t,n,i)}finally{Oc.transition=r,St=i}return null}function Cl(){if(null!==$c){var e=Tt(Yc),t=Oc.transition,n=St;try{if(Oc.transition=null,St=16>e?16:e,null===$c)var i=!1;else{if(e=$c,$c=null,Yc=0,0!==(6&_c))throw Error(a(331));var r=_c;for(_c|=4,ec=e.current;null!==ec;){var o=ec,s=o.child;if(0!==(16&ec.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for(ec=d;null!==ec;){var u=ec;switch(u.tag){case 0:case 11:case 15:rc(8,u,o)}var h=u.child;if(null!==h)h.return=u,ec=h;else for(;null!==ec;){var p=(u=ec).sibling,f=u.return;if(sc(u),u===d){ec=null;break}if(null!==p){p.return=f,ec=p;break}ec=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}ec=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,ec=s;else e:for(;null!==ec;){if(0!==(2048&(o=ec).flags))switch(o.tag){case 0:case 11:case 15:rc(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,ec=b;break e}ec=o.return}}var y=e.current;for(ec=y;null!==ec;){var k=(s=ec).child;if(0!==(2064&s.subtreeFlags)&&null!==k)k.return=s,ec=k;else e:for(s=y;null!==ec;){if(0!==(2048&(c=ec).flags))try{switch(c.tag){case 0:case 11:case 15:ac(9,c)}}catch(T){xl(c,c.return,T)}if(c===s){ec=null;break e}var S=c.sibling;if(null!==S){S.return=c.return,ec=S;break e}ec=c.return}}if(_c=r,Hr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(ot,e)}catch(T){}i=!0}return i}finally{St=n,Oc.transition=t}}return!1}function El(e,t,n){e=za(e,t=ms(0,t=us(n,t),1),1),t=nl(),null!==e&&(yt(e,1,t),al(e,t))}function xl(e,t,n){if(3===e.tag)El(e,e,n);else for(;null!==t;){if(3===t.tag){El(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Jc||!Jc.has(i))){t=za(t,e=gs(t,e=us(n,e),1),1),e=nl(),null!==t&&(yt(t,1,e),al(t,e));break}}t=t.return}}function Pl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=nl(),e.pingedLanes|=e.suspendedLanes&n,Nc===e&&(Ac&n)===n&&(4===Lc||3===Lc&&(130023424&Ac)===Ac&&500>Ze()-qc?fl(e,0):Bc|=n),al(e,t)}function Rl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var n=nl();null!==(e=La(e,t))&&(yt(e,t,n),al(e,n))}function Ol(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Rl(e,n)}function _l(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),Rl(e,n)}function Nl(e,t){return Qe(e,t)}function Il(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Al(e,t,n,i){return new Il(e,t,n,i)}function Dl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ml(e,t){var n=e.alternate;return null===n?((n=Al(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,n,i,r,o){var s=2;if(i=e,"function"===typeof e)Dl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case C:return jl(n.children,r,o,t);case E:s=8,r|=8;break;case x:return(e=Al(12,n,t,2|r)).elementType=x,e.lanes=o,e;case N:return(e=Al(13,n,t,r)).elementType=N,e.lanes=o,e;case I:return(e=Al(19,n,t,r)).elementType=I,e.lanes=o,e;case M:return Ul(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case P:s=10;break e;case R:s=9;break e;case O:s=11;break e;case A:s=14;break e;case D:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Al(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function jl(e,t,n,i){return(e=Al(7,e,i,t)).lanes=n,e}function Ul(e,t,n,i){return(e=Al(22,e,i,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Fl(e,t,n){return(e=Al(6,e,null,t)).lanes=n,e}function Bl(e,t,n){return(t=Al(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bt(0),this.expirationTimes=bt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Vl(e,t,n,i,r,a,o,s,c){return e=new zl(e,t,n,s,c),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Al(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ua(a),e}function ql(e){if(!e)return Or;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Dr(n))return jr(e,n,t)}return t}function Hl(e,t,n,i,r,a,o,s,c){return(e=Vl(n,i,!0,e,0,a,0,s,c)).context=ql(null),n=e.current,(a=Ba(i=nl(),r=il(n))).callback=void 0!==t&&null!==t?t:null,za(n,a,r),e.current.lanes=r,yt(e,r,i),al(e,i),e}function Wl(e,t,n,i){var r=t.current,a=nl(),o=il(r);return n=ql(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ba(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=za(r,t,o))&&(rl(e,r,o,a),Va(e,r,o)),o}function Kl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Jl(e,t){Gl(e,t),(e=e.alternate)&&Gl(e,t)}Ec=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Nr.current)Ss=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Ss=!1,function(e,t,n){switch(t.tag){case 3:Ns(t),ma();break;case 5:Za(t);break;case 1:Dr(t.type)&&Ur(t);break;case 4:Ya(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Rr(Ca,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Rr(to,1&to.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(Rr(to,1&to.current),null!==(e=Ks(e,t,n))?e.sibling:null);Rr(to,1&to.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Hs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Rr(to,to.current),i)break;return null;case 22:case 23:return t.lanes=0,xs(e,t,n)}return Ks(e,t,n)}(e,t,n);Ss=0!==(131072&e.flags)}else Ss=!1,oa&&0!==(1048576&t.flags)&&ta(t,Jr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ws(e,t),e=t.pendingProps;var r=Ar(t,_r.current);Na(t,n),r=bo(null,t,i,e,r,n);var o=yo();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(i)?(o=!0,Ur(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ua(t),r.updater=os,t.stateNode=r,r._reactInternals=t,ds(t,i,e,n),t=_s(null,t,i,!0,o,n)):(t.tag=0,oa&&o&&na(t),Ts(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ws(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Dl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===O)return 11;if(e===A)return 14}return 2}(i),e=rs(i,e),r){case 0:t=Rs(null,t,i,e,n);break e;case 1:t=Os(null,t,i,e,n);break e;case 11:t=ws(null,t,i,e,n);break e;case 14:t=Cs(null,t,i,rs(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Rs(e,t,i,r=t.elementType===i?r:rs(i,r),n);case 1:return i=t.type,r=t.pendingProps,Os(e,t,i,r=t.elementType===i?r:rs(i,r),n);case 3:e:{if(Ns(t),null===e)throw Error(a(387));i=t.pendingProps,r=(o=t.memoizedState).element,Fa(e,t),Ha(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Is(e,t,i,n,r=us(Error(a(423)),t));break e}if(i!==r){t=Is(e,t,i,n,r=us(Error(a(424)),t));break e}for(aa=ur(t.stateNode.containerInfo.firstChild),ra=t,oa=!0,sa=null,n=wa(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ma(),i===r){t=Ks(e,t,n);break e}Ts(e,t,i,n)}t=t.child}return t;case 5:return Za(t),null===e&&ua(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,rr(i,r)?s=null:null!==o&&rr(i,o)&&(t.flags|=32),Ps(e,t),Ts(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return Fs(e,t,n);case 4:return Ya(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ta(t,null,i,n):Ts(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ws(e,t,i,r=t.elementType===i?r:rs(i,r),n);case 7:return Ts(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ts(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Rr(Ca,i._currentValue),i._currentValue=s,null!==o)if(li(o.value,s)){if(o.children===r.children&&!Nr.current){t=Ks(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===o.tag){(l=Ba(-1,n&-n)).tag=2;var d=o.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),_a(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),_a(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}Ts(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Na(t,n),i=i(r=Ia(r)),t.flags|=1,Ts(e,t,i,n),t.child;case 14:return r=rs(i=t.type,t.pendingProps),Cs(e,t,i,r=rs(i.type,r),n);case 15:return Es(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:rs(i,r),Ws(e,t),t.tag=1,Dr(i)?(e=!0,Ur(t)):e=!1,Na(t,n),cs(t,i,r),ds(t,i,r,n),_s(null,t,i,!0,e,n);case 19:return Hs(e,t,n);case 22:return xs(e,t,n)}throw Error(a(156,t.tag))};var Ql="function"===typeof reportError?reportError:function(e){console.error(e)};function $l(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ed(){}function td(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var e=Kl(o);s.call(e)}}Wl(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var e=Kl(o);a.call(e)}}var o=Hl(t,i,e,0,null,!1,0,"",ed);return e._reactRootContainer=o,e[gr]=o.current,Hi(8===e.nodeType?e.parentNode:e),hl(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Kl(c);s.call(e)}}var c=Vl(e,0,!1,null,0,!1,0,"",ed);return e._reactRootContainer=c,e[gr]=c.current,Hi(8===e.nodeType?e.parentNode:e),hl(function(){Wl(t,c,n,i)}),c}(n,t,e,r,i);return Kl(o)}Yl.prototype.render=$l.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Wl(e,t,null,null)},Yl.prototype.unmount=$l.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hl(function(){Wl(null,e,null,null)}),t[gr]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=xt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Ft(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=pt(t.pendingLanes);0!==n&&(kt(t,1|n),al(t,Ze()),0===(6&_c)&&(Hc=Ze()+500,Hr()))}break;case 13:hl(function(){var t=La(e,1);if(null!==t){var n=nl();rl(t,e,1,n)}}),Jl(e,1)}},Ct=function(e){if(13===e.tag){var t=La(e,134217728);if(null!==t)rl(t,e,134217728,nl());Jl(e,134217728)}},Et=function(e){if(13===e.tag){var t=il(e),n=La(e,t);if(null!==n)rl(n,e,t,nl());Jl(e,t)}},xt=function(){return St},Pt=function(e,t){var n=St;try{return St=e,t()}finally{St=n}},Ce=function(e,t,n){switch(t){case"input":if(ee(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=wr(i);if(!r)throw Error(a(90));Q(i),ee(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&re(e,!!n.multiple,t,!1)}},_e=ul,Ne=hl;var nd={usingClientEntryPoint:!1,Events:[Sr,Tr,wr,Re,Oe,ul]},id={findFiberByHostInstance:kr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rd={bundleType:id.bundleType,version:id.version,rendererPackageName:id.rendererPackageName,rendererConfig:id.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:id.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ad=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ad.isDisabled&&ad.supportsFiber)try{ot=ad.inject(rd),st=ad}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nd,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(a(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xl(e))throw Error(a(299));var n=!1,i="",r=Ql;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Vl(e,1,!1,null,0,n,0,i,r),e[gr]=t.current,Hi(8===e.nodeType?e.parentNode:e),new $l(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return hl(e)},t.hydrate=function(e,t,n){if(!Zl(t))throw Error(a(200));return td(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xl(e))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Ql;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Hl(t,null,e,1,null!=n?n:null,r,0,o,s),e[gr]=t.current,Hi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yl(t)},t.render=function(e,t,n){if(!Zl(t))throw Error(a(200));return td(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(a(40));return!!e._reactRootContainer&&(hl(function(){td(null,null,e,!1,function(){e._reactRootContainer=null,e[gr]=null})}),!0)},t.unstable_batchedUpdates=ul,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Zl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return td(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.r(i),n.d(i,{hasBrowserEnv:()=>Ol,hasStandardBrowserEnv:()=>Nl,hasStandardBrowserWebWorkerEnv:()=>Il,navigator:()=>_l,origin:()=>Al});var r=n(43),a=n(391);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function c(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const h=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],p=(e,t)=>{const n=(0,r.forwardRef)((n,i)=>{let{color:a="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:l="",children:p}=n,f=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(n,h);return(0,r.createElement)("svg",d(d({ref:i},u),{},{width:o,height:o,stroke:a,strokeWidth:c?24*Number(s)/Number(o):s,className:["lucide","lucide-".concat((m=e,m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},f),[...t.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(p)?p:[p]]);var m});return n.displayName="".concat(e),n},f=p("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),m=p("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),g=p("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),v=p("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),b=p("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),y=p("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);function k(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=k(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const S=function(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=k(e))&&(i&&(i+=" "),i+=t);return i};var T=n(579);const w=e=>{let{agents:t,selectedAgent:n,onAgentSelect:i,onNewAgent:r,onToggleAutoReceive:a,onDeleteAllAgents:o}=e;const s=e=>{switch(e){case"online":return"text-green-500";case"busy":return"text-yellow-500";default:return"text-gray-500"}},c=e=>{switch(e){case"online":return"Online";case"busy":return"In Call";case"offline":return"Offline";default:return"Unknown"}};return(0,T.jsxs)("div",{className:"flex flex-col h-full bg-dark-100 border-r border-dark-200",children:[(0,T.jsxs)("div",{className:"p-4 border-b border-dark-200",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold text-white",children:"AI Agents"}),(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsxs)("button",{onClick:o,className:"flex items-center gap-1 px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-xs font-medium",title:"Delete all agents from server",children:[(0,T.jsx)(f,{size:12}),"Clear All"]}),(0,T.jsxs)("button",{onClick:r,className:"flex items-center gap-2 px-3 py-1.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors text-sm font-medium",children:[(0,T.jsx)(m,{size:16}),"New"]})]})]}),(0,T.jsxs)("div",{className:"text-sm text-dark-500",children:[t.length," agent",1!==t.length?"s":""," available"]})]}),(0,T.jsxs)("div",{className:"flex-1 overflow-y-auto scrollbar-thin",children:[(0,T.jsx)("div",{className:"p-2",children:t.map(e=>(0,T.jsxs)("div",{onClick:()=>i(e),className:S("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2",(null===n||void 0===n?void 0:n.id)===e.id?"bg-primary-600/20 border border-primary-500/30":"hover:bg-dark-200/50 border border-transparent"),children:[(0,T.jsxs)("div",{className:"relative",children:[(0,T.jsx)("div",{className:"w-10 h-10 bg-dark-300 rounded-full flex items-center justify-center",children:e.avatar?(0,T.jsx)("img",{src:e.avatar,alt:e.name,className:"w-10 h-10 rounded-full object-cover"}):(0,T.jsx)(g,{size:20,className:"text-dark-500"})}),(0,T.jsx)(v,{size:8,className:S("absolute -bottom-0.5 -right-0.5 fill-current",s(e.status))})]}),(0,T.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)("h3",{className:"font-medium text-white truncate",children:e.name}),(0,T.jsx)("span",{className:S("text-xs",s(e.status)),children:c(e.status)})]}),e.description&&(0,T.jsx)("p",{className:"text-sm text-dark-500 truncate mt-0.5",children:e.description}),(0,T.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,T.jsxs)("div",{className:"text-xs text-dark-400",children:["Last active: ",e.lastActive.toLocaleTimeString()]}),(0,T.jsx)("div",{className:"flex items-center gap-2",children:(0,T.jsxs)("button",{onClick:t=>{t.stopPropagation(),a(e.id,!e.autoReceiveCalls)},className:S("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors",e.autoReceiveCalls?"bg-green-600/20 text-green-400 hover:bg-green-600/30":"bg-dark-300 text-dark-500 hover:bg-dark-200"),title:e.autoReceiveCalls?"Auto-receive calls enabled":"Auto-receive calls disabled",children:[e.autoReceiveCalls?(0,T.jsx)(b,{size:12}):(0,T.jsx)(y,{size:12}),(0,T.jsx)("span",{children:e.autoReceiveCalls?"Auto":"Manual"})]})})]})]})]},e.id))}),0===t.length&&(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-center p-6",children:[(0,T.jsx)(g,{size:48,className:"text-dark-400 mb-4"}),(0,T.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No Agents Yet"}),(0,T.jsx)("p",{className:"text-dark-500 mb-4",children:"Create your first AI agent to get started with phone calls."}),(0,T.jsxs)("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors",children:[(0,T.jsx)(m,{size:16}),"Create Agent"]})]})]})]})},C=p("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),E=p("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]),x=p("PhoneIncoming",[["polyline",{points:"16 2 16 8 22 8",key:"1ygljm"}],["line",{x1:"22",x2:"16",y1:"2",y2:"8",key:"1xzwqn"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),P=p("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),R=p("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);function O(e,t){return t.forEach(function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var _=Object.defineProperty,N=(e,t,n)=>((e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class I{constructor(){N(this,"_locking"),N(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}}function A(e,t){if(!e)throw new Error(t)}function D(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function M(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function L(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const j=Symbol("@bufbuild/protobuf/enum-type");function U(e){const t=e[j];return A(t,"missing enum type on enum object"),t}function F(e,t,n,i){e[j]=B(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function B(e,t,n){const i=Object.create(null),r=Object.create(null),a=[];for(const o of t){const e=V(o);a.push(e),i[o.name]=e,r[o.no]=e}return{typeName:e,values:a,findName:e=>i[e],findNumber:e=>r[e]}}function z(e,t,n){const i={};for(const r of t){const e=V(r);i[e.localName]=e.no,i[e.no]=e.localName}return F(i,e,t),i}function V(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class q{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(_){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(_ instanceof Error?_.message:String(_)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function H(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function W(e,t,n){for(let a=0;a<28;a+=7){const i=e>>>a,r=!(i>>>7==0&&0==t),o=255&(r?128|i:i);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),a=255&(r?128|i:i);if(n.push(a),!r)return}n.push(t>>>31&1)}}const K=4294967296;function G(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function a(t,a){const o=Number(e.slice(t,a));r*=n,i=i*n+o,i>=K&&(r+=i/K|0,i%=K)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?$(i,r):Q(i,r)}function J(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(K*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,a=n+8147497*i,o=2*i;const s=1e7;return r>=s&&(a+=Math.floor(r/s),r%=s),a>=s&&(o+=Math.floor(a/s),a%=s),o.toString()+Y(a)+Y(r)}function Q(e,t){return{lo:0|e,hi:0|t}}function $(e,t){return t=~t,e?e=1+~e:t+=1,Q(e,t)}const Y=e=>{const t=String(e);return"0000000".slice(t.length)+t};function X(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function Z(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const ee=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_LIVEKIT_URL:"wss://test-9m0bd0iw.livekit.cloud",REACT_APP_LIVEKIT_API_KEY:"APIvewCcq5Rxi8X",REACT_APP_LIVEKIT_API_SECRET:"hYsLrq4mJgPeBd5zevoo4RVeB7DMOj6gvaPxz1Vp0DtA",REACT_APP_DEEPGRAM_API_KEY:"b588f1608d86f2268f76d00d90f4210e1d71d464",REACT_APP_CARTESIA_API_KEY:"sk_car_vYKXUKKFtepsuvtLXkwchF",REACT_APP_LETTA_API_URL:"http://localhost:8284",REACT_APP_TWILIO_PHONE_NUMBER:"+1234567890",REACT_APP_BACKEND_URL:"http://localhost:3002",REACT_APP_WEBSOCKET_URL:"ws://localhost:3002"}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>A(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>A(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),G(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),G(e)),dec:(e,t)=>function(e,t){let n=Q(e,t);const i=2147483648&n.hi;i&&(n=$(n.lo,n.hi));const r=J(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>J(e,t)}}();var te,ne,ie;function re(e,t,n){if(t===n)return!0;if(e==te.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case te.UINT64:case te.FIXED64:case te.INT64:case te.SFIXED64:case te.SINT64:return t==n}return!1}function ae(e,t){switch(e){case te.BOOL:return!1;case te.UINT64:case te.FIXED64:case te.INT64:case te.SFIXED64:case te.SINT64:return 0==t?ee.zero:"0";case te.DOUBLE:case te.FLOAT:return 0;case te.BYTES:return new Uint8Array(0);case te.STRING:return"";default:return 0}}function oe(e,t){switch(e){case te.BOOL:return!1===t;case te.STRING:return""===t;case te.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(te||(te={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(ne||(ne={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(ie||(ie={}));class se{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(M(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return D(e),X(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){L(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){M(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){D(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return D(e),X(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=ee.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=ee.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=ee.enc(e);return W(t.lo,t.hi,this.buf),this}sint64(e){let t=ee.enc(e),n=t.hi>>31;return W(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=ee.uEnc(e);return W(t.lo,t.hi,this.buf),this}}class ce{constructor(e,t){this.varint64=H,this.uint32=Z,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case ie.Varint:for(;128&this.buf[this.pos++];);break;case ie.Bit64:this.pos+=4;case ie.Bit32:this.pos+=4;break;case ie.LengthDelimited:let n=this.uint32();this.pos+=n;break;case ie.StartGroup:for(;;){const[e,n]=this.tag();if(n===ie.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return ee.dec(...this.varint64())}uint64(){return ee.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,ee.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ee.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ee.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function le(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return ae(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let de="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ue=[];for(let Xd=0;Xd<de.length;Xd++)ue[de[Xd].charCodeAt(0)]=Xd;ue["-".charCodeAt(0)]=de.indexOf("+"),ue["_".charCodeAt(0)]=de.indexOf("/");const he={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,a=0,o=0;for(let s=0;s<e.length;s++){if(n=ue[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=n,a=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,a=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,a=3;break;case 3:i[r++]=(3&o)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let a=0;a<e.length;a++)switch(t=e[a],i){case 0:n+=de[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=de[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=de[r|t>>6],n+=de[63&t],i=0}return i&&(n+=de[r],n+="=",1==i&&(n+="=")),n}};function pe(e,t,n){ge(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[a,o]=le(t);for(const s of r)t.runtime.bin.readField(a,i.readerFactory(s.data),t.field,s.wireType,i);return o()}function fe(e,t,n,i){ge(t,e);const r=t.runtime.bin.makeReadOptions(i),a=t.runtime.bin.makeWriteOptions(i);if(me(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const o=a.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,o,a);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function me(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function ge(e,t){A(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function ve(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!oe(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function be(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?ae(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function ye(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(q.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function ke(e,t){return ye(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}te.DOUBLE,te.FLOAT,te.INT64,te.UINT64,te.INT32,te.UINT32,te.BOOL,te.STRING,te.BYTES;const Se={ignoreUnknownFields:!1},Te={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function we(e){return e?Object.assign(Object.assign({},Se),e):Se}function Ce(e){return e?Object.assign(Object.assign({},Te),e):Te}const Ee=Symbol(),xe=Symbol();function Pe(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function Re(e,t,n,i,r){let a=n.localName;if(n.repeated){if(A("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(t)));const o=e[a];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(e)));switch(n.kind){case"message":o.push(n.T.fromJson(e,i));break;case"enum":const t=Ne(n.T,e,i.ignoreUnknownFields,!0);t!==xe&&o.push(t);break;case"scalar":try{o.push(_e(n.T,e,n.L,!0))}catch(_){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(e));throw _ instanceof Error&&_.message.length>0&&(i+=": ".concat(_.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(t)));const o=e[a];for(const[e,a]of Object.entries(t)){if(null===a)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let s;try{s=Oe(n.K,e)}catch(_){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(t));throw _ instanceof Error&&_.message.length>0&&(i+=": ".concat(_.message)),new Error(i)}switch(n.V.kind){case"message":o[s]=n.V.T.fromJson(a,i);break;case"enum":const e=Ne(n.V.T,a,i.ignoreUnknownFields,!0);e!==xe&&(o[s]=e);break;case"scalar":try{o[s]=_e(n.V.T,a,ne.BIGINT,!0)}catch(_){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(t));throw _ instanceof Error&&_.message.length>0&&(i+=": ".concat(_.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:a},a="value"),n.kind){case"message":const o=n.T;if(null===t&&"google.protobuf.Value"!=o.typeName)return;let s=e[a];ye(s)?s.fromJson(t,i):(e[a]=s=o.fromJson(t,i),o.fieldWrapper&&!n.oneof&&(e[a]=o.fieldWrapper.unwrapField(s)));break;case"enum":const c=Ne(n.T,t,i.ignoreUnknownFields,!1);switch(c){case Ee:be(n,e);break;case xe:break;default:e[a]=c}break;case"scalar":try{const i=_e(n.T,t,n.L,!1);if(i===Ee)be(n,e);else e[a]=i}catch(_){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Pe(t));throw _ instanceof Error&&_.message.length>0&&(i+=": ".concat(_.message)),new Error(i)}}}function Oe(e,t){if(e===te.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return _e(e,t,ne.BIGINT,!0).toString()}function _e(e,t,n,i){if(null===t)return i?ae(e,n):Ee;switch(e){case te.DOUBLE:case te.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==te.FLOAT&&L(i),i;case te.INT32:case te.FIXED32:case te.SFIXED32:case te.SINT32:case te.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==te.UINT32||e==te.FIXED32?M(r):D(r),r;case te.INT64:case te.SFIXED64:case te.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=ee.parse(t);return n?a.toString():a;case te.FIXED64:case te.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=ee.uParse(t);return n?o.toString():o;case te.BOOL:if("boolean"!==typeof t)break;return t;case te.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(_){throw new Error("invalid UTF8")}return t;case te.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return he.dec(t)}throw new Error}function Ne(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:Ee;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return xe}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(Pe(t)))}function Ie(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function Ae(e,t,n){if("map"==e.kind){A("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,a]of r)i[n.toString()]=Me(e.V.T,a);break;case"message":for(const[e,a]of r)i[e.toString()]=a.toJson(n);break;case"enum":const t=e.V.T;for(const[e,a]of r)i[e.toString()]=De(t,a,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){A(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(Me(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(De(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return Me(e.T,t);case"enum":return De(e.T,t,n.enumAsInteger);case"message":return ke(e.T,t).toJson(n)}}function De(e,t,n){var i;if(A("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:t}function Me(e,t){switch(e){case te.INT32:case te.SFIXED32:case te.SINT32:case te.FIXED32:case te.UINT32:return A("number"==typeof t),t;case te.FLOAT:case te.DOUBLE:return A("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case te.STRING:return A("string"==typeof t),t;case te.BOOL:return A("boolean"==typeof t),t;case te.UINT64:case te.FIXED64:case te.INT64:case te.SFIXED64:case te.SINT64:return A("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case te.BYTES:return A(t instanceof Uint8Array),he.enc(t)}}const Le=Symbol("@bufbuild/protobuf/unknown-fields"),je={readUnknownFields:!0,readerFactory:e=>new ce(e)},Ue={writeUnknownFields:!0,writerFactory:()=>new se};function Fe(e){return e?Object.assign(Object.assign({},je),e):je}function Be(e){return e?Object.assign(Object.assign({},Ue),e):Ue}function ze(e,t,n,i,r){let{repeated:a,localName:o}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=o&&delete e.value,e.case=o,o="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?te.INT32:n.T;let c=He;if("scalar"==n.kind&&n.L>0&&(c=qe),a){let n=e[o];if(i==ie.LengthDelimited&&s!=te.STRING&&s!=te.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[o]=c(t,s);break;case"message":const l=n.T;a?e[o].push(Ve(t,new l,r,n)):ye(e[o])?Ve(t,e[o],r,n):(e[o]=Ve(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[o]=l.fieldWrapper.unwrapField(e[o])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let a,o;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:a=He(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=He(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=Ve(t,new e.V.T,n,void 0)}}}void 0===a&&(a=ae(e.K,ne.BIGINT));"string"!=typeof a&&"number"!=typeof a&&(a=a.toString());if(void 0===o)switch(e.V.kind){case"scalar":o=ae(e.V.T,ne.BIGINT);break;case"enum":o=e.V.T.values[0].no;break;case"message":o=new e.V.T}return[a,o]}(n,t,r);e[o][d]=u}}function Ve(e,t,n,i){const r=t.getType().runtime.bin,a=null===i||void 0===i?void 0:i.delimited;return r.readMessage(t,e,a?i.no:e.uint32(),n,a),t}function qe(e,t){const n=He(e,t);return"bigint"==typeof n?n.toString():n}function He(e,t){switch(t){case te.STRING:return e.string();case te.BOOL:return e.bool();case te.DOUBLE:return e.double();case te.FLOAT:return e.float();case te.INT32:return e.int32();case te.INT64:return e.int64();case te.UINT64:return e.uint64();case te.FIXED64:return e.fixed64();case te.BYTES:return e.bytes();case te.FIXED32:return e.fixed32();case te.SFIXED32:return e.sfixed32();case te.SFIXED64:return e.sfixed64();case te.SINT64:return e.sint64();case te.UINT32:return e.uint32();case te.SINT32:return e.sint32()}}function We(e,t,n,i){A(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let a="enum"==e.kind?te.INT32:e.T;if(r)if(A(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,ie.LengthDelimited).fork();let[,r]=Qe(t);for(let a=0;a<i.length;a++)e[r](i[a]);e.join()}(n,a,e.no,t);else for(const i of t)Je(n,a,e.no,i);else Je(n,a,e.no,t);break;case"message":if(r){A(Array.isArray(t));for(const r of t)Ge(n,i,e,r)}else Ge(n,i,e,t);break;case"map":A("object"==typeof t&&null!=t);for(const[r,o]of Object.entries(t))Ke(n,i,e,r,o)}}function Ke(e,t,n,i,r){e.tag(n.no,ie.LengthDelimited),e.fork();let a=i;switch(n.K){case te.INT32:case te.FIXED32:case te.UINT32:case te.SFIXED32:case te.SINT32:a=Number.parseInt(i);break;case te.BOOL:A("true"==i||"false"==i),a="true"==i}switch(Je(e,n.K,1,a),n.V.kind){case"scalar":Je(e,n.V.T,2,r);break;case"enum":Je(e,te.INT32,2,r);break;case"message":A(void 0!==r),e.tag(2,ie.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Ge(e,t,n,i){const r=ke(n.T,i);n.delimited?e.tag(n.no,ie.StartGroup).raw(r.toBinary(t)).tag(n.no,ie.EndGroup):e.tag(n.no,ie.LengthDelimited).bytes(r.toBinary(t))}function Je(e,t,n,i){A(void 0!==i);let[r,a]=Qe(t);e.tag(n,r)[a](i)}function Qe(e){let t=ie.Varint;switch(e){case te.BYTES:case te.STRING:t=ie.LengthDelimited;break;case te.DOUBLE:case te.FIXED64:case te.SFIXED64:t=ie.Bit64;break;case te.FIXED32:case te.SFIXED32:case te.FLOAT:t=ie.Bit32}return[t,te[e].toLowerCase()]}function $e(e){if(void 0===e)return e;if(ye(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Ye(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Xe{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Ze(e,t){const n=tt(e);return t?n:ot(at(n))}const et=tt;function tt(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const nt=new Set(["constructor","toString","toJSON","valueOf"]),it=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),rt=e=>"".concat(e,"$"),at=e=>it.has(e)?rt(e):e,ot=e=>nt.has(e)?rt(e):e;class st{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Ze(e,!1)}addField(e){A(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const ct=(lt=e=>new Xe(e,e=>function(e){var t,n,i,r,a,o;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=Ze(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:et(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:ne.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(a=l.req)&&void 0!==a&&a,e.opt=null!==(o=l.opt)&&void 0!==o&&o,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=te.BYTES&&l.T!=te.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new st(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e)),dt=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=ae(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:we,makeWriteOptions:Ce,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(Pe(t)));i=null!==i&&void 0!==i?i:new e;const r=new Map,a=n.typeRegistry;for(const[o,s]of Object.entries(t)){const t=e.fields.findJsonName(o);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(o,'"'));r.set(t.oneof,o)}Re(i,s,t,n,e)}else{let t=!1;if((null===a||void 0===a?void 0:a.findExtension)&&o.startsWith("[")&&o.endsWith("]")){const r=a.findExtension(o.substring(1,o.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,a]=le(r);Re(e,s,r.field,n,r),fe(i,r,a(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!ve(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!Ie(r))continue}const n=Ae(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const a=t.typeRegistry;if(null===a||void 0===a?void 0:a.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const o=a.findExtensionFor(n.typeName,r.no);if(o&&me(e,o)){const n=pe(e,o,t),r=Ae(o.field,n,t);void 0!==r&&(i[o.field.jsonName]=r)}}}catch(_){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=_ instanceof Error?_.message:String(_);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>_e(e,t,null!==n&&void 0!==n?n:ne.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||oe(e,t)?Me(e,t):void 0},debug:Pe},bin:{makeReadOptions:Fe,makeWriteOptions:Be,listUnknownFields(e){var t;return null!==(t=e[Le])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[Le]},writeUnknownFields(e,t){const n=e[Le];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[Le])||(r[Le]=[]),r[Le].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const a=e.getType(),o=r?t.len:t.pos+n;let s,c;for(;t.pos<o&&([s,c]=t.tag(),!0!==r||c!=ie.EndGroup);){const n=a.fields.find(s);if(!n){const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n);continue}ze(e,t,n,c,i)}if(r&&(c!=ie.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:ze,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(ve(r,e))We(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&We(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:F,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,a=e;if(null!=a[n])switch(i.kind){case"oneof":const e=a[n].case;if(void 0===e)continue;const t=i.findField(e);let o=a[n].value;t&&"message"==t.kind&&!ye(o,t.T)?o=new t.T(o):t&&"scalar"===t.kind&&t.T===te.BYTES&&(o=Ye(o)),r[n]={case:e,value:o};break;case"scalar":case"enum":let s=a[n];i.T===te.BYTES&&(s=i.repeated?s.map(Ye):Ye(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===te.BYTES)for(const[t,i]of Object.entries(a[n]))r[n][t]=Ye(i);else Object.assign(r[n],a[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(a[n])){let i=a[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=a[n].map(e=>ye(e,c)?e:new c(e));else{const e=a[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Ye(e):r[n]=e:r[n]=ye(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every((t,n)=>e.T.equals(t,r[n]));case"scalar":return i.every((t,n)=>re(e.T,t,r[n]));case"enum":return i.every((e,t)=>re(te.INT32,e,r[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=r;return e.T.fieldWrapper&&(void 0===t||ye(t)||(t=e.T.fieldWrapper.wrapField(t)),void 0===n||ye(n)||(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return re(te.INT32,i,r);case"scalar":return re(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const a=e.findField(i.case);if(void 0===a)return!0;switch(a.kind){case"message":return a.T.equals(i.value,r.value);case"enum":return re(te.INT32,i.value,r.value);case"scalar":return re(a.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const o=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return o.every(e=>t.equals(i[e],r[e]));case"enum":return o.every(e=>re(te.INT32,i[e],r[e]));case"scalar":const n=e.V.T;return o.every(e=>re(n,i[e],r[e]))}}}),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map($e);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=$e(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:$e(t.value)}:{case:void 0}:$e(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:lt,initFields:dt}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const a=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o={[a]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[a];return Object.setPrototypeOf(o.prototype,new q),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new o).fromBinary(e,t),fromJson:(e,t)=>(new o).fromJson(e,t),fromJsonString:(e,t)=>(new o).fromJsonString(e,t),equals:(t,n)=>e.util.equals(o,t,n)}),o}(this,e,t,n)},makeEnum:z,makeEnumType:B,getEnumType:U,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var lt,dt;class ut extends q{constructor(e){super(),this.seconds=ee.zero,this.nanos=0,ct.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(ct.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ee.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return ut.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new ut({seconds:ee.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new ut).fromBinary(e,t)}static fromJson(e,t){return(new ut).fromJson(e,t)}static fromJsonString(e,t){return(new ut).fromJsonString(e,t)}static equals(e,t){return ct.util.equals(ut,e,t)}}ut.runtime=ct,ut.typeName="google.protobuf.Timestamp",ut.fields=ct.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const ht=ct.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ut},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:pt,repeated:!0},{no:5,name:"events",kind:"message",T:mt,repeated:!0}]),pt=ct.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:ft,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),ft=ct.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ut},{no:3,name:"value",kind:"scalar",T:2}]),mt=ct.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ut},{no:7,name:"normalized_end_timestamp",kind:"message",T:ut,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),gt=ct.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),vt=ct.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),bt=ct.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),yt=ct.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),kt=ct.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),St=ct.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Tt=ct.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),wt=ct.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Ct=ct.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Et=ct.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),xt=ct.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Pt,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:an}]),Pt=ct.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Rt=ct.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ct.getEnumType(bt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ot=ct.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ct.getEnumType(_t)},{no:4,name:"tracks",kind:"message",T:Mt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Rt},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ct.getEnumType(Nt)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ct.getEnumType(Tt)},{no:18,name:"kind_details",kind:"enum",T:ct.getEnumType(It),repeated:!0}]),_t=ct.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Nt=ct.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),It=ct.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),At=ct.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Dt=ct.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lt,repeated:!0}]),Mt=ct.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ct.getEnumType(vt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ct.getEnumType(bt)},{no:10,name:"layers",kind:"message",T:Lt,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Dt,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ct.getEnumType(At)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:an},{no:19,name:"audio_features",kind:"enum",T:ct.getEnumType(Et),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:ct.getEnumType(gt)}]),Lt=ct.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:ct.getEnumType(yt)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),jt=ct.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:ct.getEnumType(Ut)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:zt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Ft,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Vt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:qt,oneof:"value"},{no:8,name:"metrics",kind:"message",T:ht,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Wt,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Kt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Gt,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Jt,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ln,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:dn,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:un,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ut=ct.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Ft=ct.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Bt,repeated:!0}]),Bt=ct.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),zt=ct.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Vt=ct.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),qt=ct.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Ht,repeated:!0}]),Ht=ct.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Wt=ct.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Kt=ct.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Gt=ct.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Jt=ct.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Qt,oneof:"value"}]),Qt=ct.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),$t=ct.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Yt=ct.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:ct.getEnumType(Xt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Xt=ct.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Zt=ct.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:ct.getEnumType(en)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),en=ct.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"}]),tn=ct.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:nn},{no:2,name:"screen",kind:"message",T:nn},{no:3,name:"resume_connection",kind:"enum",T:ct.getEnumType(St)},{no:4,name:"disabled_codecs",kind:"message",T:rn},{no:5,name:"force_relay",kind:"enum",T:ct.getEnumType(St)}]),nn=ct.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:ct.getEnumType(St)}]),rn=ct.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Pt,repeated:!0},{no:2,name:"publish",kind:"message",T:Pt,repeated:!0}]),an=ct.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),on=ct.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),sn=ct.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:ct.getEnumType(on)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),cn=ct.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ln=ct.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:ct.getEnumType(At)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:sn,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:cn,oneof:"content_header"}],{localName:"DataStream_Header"}),dn=ct.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),un=ct.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),hn=ct.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),pn=ct.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),fn=ct.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),mn=ct.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:En,oneof:"message"},{no:2,name:"answer",kind:"message",T:En,oneof:"message"},{no:3,name:"trickle",kind:"message",T:yn,oneof:"message"},{no:4,name:"add_track",kind:"message",T:bn,oneof:"message"},{no:5,name:"mute",kind:"message",T:kn,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Pn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Rn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Nn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:An,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Kn,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Qn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Xn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Dn,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Zn,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:On,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:_n,oneof:"message"}]),gn=ct.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Sn,oneof:"message"},{no:2,name:"answer",kind:"message",T:En,oneof:"message"},{no:3,name:"offer",kind:"message",T:En,oneof:"message"},{no:4,name:"trickle",kind:"message",T:yn,oneof:"message"},{no:5,name:"update",kind:"message",T:xn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:wn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Nn,oneof:"message"},{no:9,name:"mute",kind:"message",T:kn,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Ln,oneof:"message"},{no:11,name:"room_update",kind:"message",T:jn,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Fn,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:zn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Hn,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Gn,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Cn,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Tn,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:ei,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:ii,oneof:"message"},{no:22,name:"request_response",kind:"message",T:ri,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:oi,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Jn,oneof:"message"}]),vn=ct.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),bn=ct.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:ct.getEnumType(vt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:ct.getEnumType(bt)},{no:9,name:"layers",kind:"message",T:Lt,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:vn,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:ct.getEnumType(At)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:ct.getEnumType(gt)},{no:17,name:"audio_features",kind:"enum",T:ct.getEnumType(Et),repeated:!0}]),yn=ct.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:ct.getEnumType(hn)},{no:3,name:"final",kind:"scalar",T:8}]),kn=ct.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Sn=ct.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:xt},{no:2,name:"participant",kind:"message",T:Ot},{no:3,name:"other_participants",kind:"message",T:Ot,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Mn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:tn},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Yt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Pt,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Tn=ct.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Mn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:tn},{no:3,name:"server_info",kind:"message",T:Yt},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),wn=ct.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Mt}]),Cn=ct.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),En=ct.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),xn=ct.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ot,repeated:!0}]),Pn=ct.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:$t,repeated:!0}]),Rn=ct.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:ct.getEnumType(yt)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),On=ct.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:ct.getEnumType(Et),repeated:!0}]),_n=ct.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Nn=ct.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:ct.getEnumType(Tt)},{no:3,name:"action",kind:"enum",T:ct.getEnumType(In)},{no:4,name:"regions",kind:"message",T:ti}]),In=ct.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),An=ct.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Lt,repeated:!0}]),Dn=ct.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Mn=ct.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Ln=ct.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Bt,repeated:!0}]),jn=ct.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:xt}]),Un=ct.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:ct.getEnumType(kt)},{no:3,name:"score",kind:"scalar",T:2}]),Fn=ct.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Un,repeated:!0}]),Bn=ct.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ct.getEnumType(pn)}]),zn=ct.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Bn,repeated:!0}]),Vn=ct.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:ct.getEnumType(yt)},{no:2,name:"enabled",kind:"scalar",T:8}]),qn=ct.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Vn,repeated:!0}]),Hn=ct.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Vn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:qn,repeated:!0}]),Wn=ct.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Kn=ct.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Wn,repeated:!0}]),Gn=ct.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Jn=ct.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:xt},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ot},{no:4,name:"other_participants",kind:"message",T:Ot,repeated:!0}]),Qn=ct.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:En},{no:2,name:"subscription",kind:"message",T:Pn},{no:3,name:"publish_tracks",kind:"message",T:wn,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Yn,repeated:!0},{no:5,name:"offer",kind:"message",T:En},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:$n,repeated:!0}]),$n=ct.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Yn=ct.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:ct.getEnumType(hn)}]),Xn=ct.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:ct.getEnumType(fn),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Zn=ct.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),ei=ct.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),ti=ct.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:ni,repeated:!0}]),ni=ct.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),ii=ct.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:ct.getEnumType(Ct)}]),ri=ct.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:ct.getEnumType(ai)},{no:3,name:"message",kind:"scalar",T:9}]),ai=ct.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),oi=ct.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function si(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ci,li={exports:{}},di=li.exports;var ui,hi,pi=function(){return ci||(ci=1,e=li,function(t,n){e.exports?e.exports=n():t.log=n()}(di,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},a=null;function o(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(_){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var a=i[r];this[a]=r<n?e:this.methodFactory(a,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,a){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var o,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(a){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(a){}return void 0===u.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"===typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:o},u.setLevel=function(e,n){return l=f(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(r){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=f(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(a!==u&&(o=f(a.getLevel())),c.call(u),a===u)for(var e in r)r[e].rebuild()},o=f(a?a.getLevel():"WARN");var m=p();null!=m&&(l=f(m)),c.call(u)}(a=new u).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,a.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=h),a},a.getLoggers=function(){return r},a.default=a,a})),li.exports;var e}();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(ui||(ui={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(hi||(hi={}));let fi=pi.getLogger("livekit");Object.values(hi).map(e=>pi.getLogger(e));function mi(e){const t=pi.getLogger(e);return t.setDefaultLevel(fi.getLevel()),t}fi.setDefaultLevel(ui.info);const gi=pi.getLogger("lk-e2ee"),vi=7e3,bi=[0,300,1200,2700,4800,vi,vi,vi,vi,vi];function yi(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{c(i.next(e))}catch(_){a(_)}}function s(e){try{c(i.throw(e))}catch(_){a(_)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((i=i.apply(e,t||[])).next())})}function ki(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Si(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=ki(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}"function"===typeof SuppressedError&&SuppressedError;var Ti,wi={exports:{}};var Ci=function(){if(Ti)return wi.exports;Ti=1;var e,t="object"===typeof Reflect?Reflect:null,n=t&&"function"===typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"===typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}wi.exports=r,wi.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}f(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&f(e,"error",t,n)}(e,r,{once:!0})})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,a,c,l;if(o(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),c=a[t]),void 0===c)c=a[t]=n,++e._eventsCount;else if("function"===typeof c?c=a[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,l=d,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function f(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(a){i.once&&e.removeEventListener(t,r),n(a)})}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=a[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return o(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,a,s;if(o(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},wi.exports}();let Ei=!0,xi=!0;function Pi(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function Ri(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const a=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,a),r.apply(this,[e,a])};const a=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Oi(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ei=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(xi=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ni(){if("object"===typeof window){if(Ei)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function Ii(e,t){xi&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ai(e){return"[object Object]"===Object.prototype.toString.call(e)}function Di(e){return Ai(e)?Object.keys(e).reduce(function(t,n){const i=Ai(e[n]),r=i?Di(e[n]):e[n],a=i&&!Object.keys(r).length;return void 0===r||a?t:Object.assign(t,{[n]:r})},{}):e}function Mi(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?Mi(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{Mi(e,e.get(t),n)})}))}function Li(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const a=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&Mi(e,n,r)})}),r}const ji=Ni;function Ui(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let a=e.video.facingMode;a=a&&("object"===typeof a?a:{ideal:a});const o=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let o=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),ji("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return ji("chrome: "+JSON.stringify(e)),r(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(a(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(a(e))))}}}function Fi(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Bi(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ri(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function zi(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vi(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Li(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ri(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Li(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qi(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function Hi(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qi(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wi(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Ki(e,t){Ri(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Gi=Object.freeze({__proto__:null,fixNegotiationNeeded:Ki,shimAddTrackRemoveTrack:Hi,shimAddTrackRemoveTrackWithNative:qi,shimGetSendersWithDtmf:zi,shimGetUserMedia:Ui,shimMediaStream:Fi,shimOnTrack:Bi,shimPeerConnection:Wi,shimSenderReceiverGetStats:Vi});function Ji(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Ii("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Qi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $i(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,a]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(_){if("TypeError"!==_.name)throw _;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,a)}}function Yi(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Xi(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ri(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zi(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ii("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function er(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function tr(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function nr(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ir(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function rr(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var ar=Object.freeze({__proto__:null,shimAddTransceiver:tr,shimCreateAnswer:rr,shimCreateOffer:ir,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:nr,shimGetUserMedia:Ji,shimOnTrack:Qi,shimPeerConnection:$i,shimRTCDataChannel:er,shimReceiverGetStats:Xi,shimRemoveStream:Zi,shimSenderGetStats:Yi});function or(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function sr(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function cr(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function lr(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(dr(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function dr(e){return e&&void 0!==e.video?Object.assign({},e,{video:Di(e.video)}):e}function ur(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(Ii("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function hr(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function fr(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var mr,gr=Object.freeze({__proto__:null,shimAudioContext:fr,shimCallbacksAPI:cr,shimConstraints:dr,shimCreateOfferLegacy:pr,shimGetUserMedia:lr,shimLocalStreamsAPI:or,shimRTCIceServerUrls:ur,shimRemoteStreamsAPI:sr,shimTrackEventTransceiver:hr}),vr={exports:{}};var br=(mr||(mr=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let a=3;a<i.length;a++){const r=i[a],o=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){const i=t.parseRtpMap(o),a=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=a.length?t.parseFmtp(a[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let r=0;return n.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const a=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(vr)),vr.exports),yr=si(br),kr=O({__proto__:null,default:yr},[br]);function Sr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=yr.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Ri(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Tr(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ri(e,"icecandidate",e=>{if(e.candidate){const t=yr.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function wr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=yr.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=yr.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=yr.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>r}),this._sctp=a}return n.apply(this,arguments)}}function Cr(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Ri(e,"datachannel",e=>(t(e.channel,e.target),e))}function Er(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function xr(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Pr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Rr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var Or=Object.freeze({__proto__:null,removeExtmapAllowMixed:xr,shimAddIceCandidateNullOrEmpty:Pr,shimConnectionState:Er,shimMaxMessageSize:wr,shimParameterlessSetLocalDescription:Rr,shimRTCIceCandidate:Sr,shimRTCIceCandidateRelayProtocol:Tr,shimSendThrowTypeError:Cr});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ni,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Pi(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Pi(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(Pi(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Pi(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:Or,extractVersion:Pi,disableLog:Oi,disableWarnings:_i,sdp:kr};switch(i.browser){case"chrome":if(!Gi||!Wi||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Gi,Pr(e,i),Rr(e),Ui(e,i),Fi(e),Wi(e,i),Bi(e),Hi(e,i),zi(e),Vi(e),Ki(e,i),Sr(e),Tr(e),Er(e),wr(e,i),Cr(e),xr(e,i);break;case"firefox":if(!ar||!$i||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=ar,Pr(e,i),Rr(e),Ji(e,i),$i(e,i),Qi(e),Zi(e),Yi(e),Xi(e),er(e),tr(e),nr(e),ir(e),rr(e),Sr(e),Er(e),wr(e,i),Cr(e);break;case"safari":if(!gr||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=gr,Pr(e,i),Rr(e),ur(e),pr(e),cr(e),or(e),sr(e),hr(e),lr(e),fr(e),Sr(e),Tr(e),wr(e,i),Cr(e),xr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const _r="lk_e2ee";var Nr,Ir,Ar,Dr;function Mr(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||Lr()}function Lr(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Nr||(Nr={})),function(e){e.KeyRatcheted="keyRatcheted"}(Ir||(Ir={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(Ar||(Ar={})),function(e){e.Error="cryptorError"}(Dr||(Dr={}));Ci.EventEmitter;class jr extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var Ur,Fr,Br,zr,Vr,qr,Hr;!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(Ur||(Ur={}));class Wr extends jr{constructor(e,t,n,i){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=i,this.reasonName=Ur[t]}}class Kr extends jr{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class Gr extends jr{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid"),this.name="TrackInvalidError"}}class Jr extends jr{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server"),this.name="UnsupportedServer"}}class Qr extends jr{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class $r extends jr{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate"),this.name="NegotiationError"}}class Yr extends jr{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Xr extends jr{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"===typeof t?t:ai[t]}}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(Fr||(Fr={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(Fr||(Fr={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(Br||(Br={}));!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(zr||(zr={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(Vr||(Vr={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(qr||(qr={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(Hr||(Hr={}));const Zr=/version\/(\d+(\.?_?\d+)+)/i;let ea;function ta(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===ea||t){const e=na.find(e=>{let{test:t}=e;return t.test(n)});ea=null===e||void 0===e?void 0:e.describe(n)}return ea}const na=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:ia(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:ra(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:ia(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:ra(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:ia(Zr,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:ra(e)})}];function ia(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function ra(e){return e.includes("mac os")?ia(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class aa{}aa.setTimeout=function(){return setTimeout(...arguments)},aa.setInterval=function(){return setInterval(...arguments)},aa.clearTimeout=function(){return clearTimeout(...arguments)},aa.clearInterval=function(){return clearInterval(...arguments)};const oa=[];var sa;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(sa||(sa={}));class ca extends Ci.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=ca.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=fi,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),5e3):this.handleAppVisibilityChanged()},this.log=mi(null!==(i=n.loggerName)&&void 0!==i?i:hi.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=ca.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),bo(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===ca.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===ca.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(oa.forEach(t=>{null!==t.parentElement||e||(e=t)}),e&&oa.splice(oa.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),la(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some(e=>"audio"===e.kind);return e.play().then(()=>{this.emit(i?Hr.AudioPlaybackStarted:Hr.VideoPlaybackStarted)}).catch(t=>{"NotAllowedError"===t.name?this.emit(i?Hr.AudioPlaybackFailed:Hr.VideoPlaybackFailed,t):"AbortError"===t.name?fi.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):fi.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some(e=>"video"===e.kind)&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Hr.ElementAttached,e),e}detach(e){try{if(e){da(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Hr.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(e=>{da(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Hr.ElementDetached,e)}),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=mi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),oa.forEach(e=>{e.parentElement||(t=!1)}),t&&oa.push(e)}}handleAppVisibilityChanged(){return yi(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==ca.Kind.Video||setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Na()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Na()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function la(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),Pa()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Pa()||xa())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function da(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return vt.AUDIO;case t.Video:return vt.VIDEO;default:return vt.DATA}},e.kindFromProto=function(e){switch(e){case vt.AUDIO:return t.Audio;case vt.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return bt.CAMERA;case n.Microphone:return bt.MICROPHONE;case n.ScreenShare:return bt.SCREEN_SHARE;case n.ScreenShareAudio:return bt.SCREEN_SHARE_AUDIO;default:return bt.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case bt.CAMERA:return n.Camera;case bt.MICROPHONE:return n.Microphone;case bt.SCREEN_SHARE:return n.ScreenShare;case bt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case pn.ACTIVE:return i.Active;case pn.PAUSED:return i.Paused;default:return i.Unknown}}}(ca||(ca={}));class ua{constructor(e,t,n,i,r){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const ha=["vp8","h264"],pa=["vp8","h264","vp9","av1"];function fa(e){return!!ha.find(t=>t===e)}var ma,ga;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(ma||(ma={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(ga||(ga={}));const va={h90:new ua(160,90,9e4,20),h180:new ua(320,180,16e4,20),h216:new ua(384,216,18e4,20),h360:new ua(640,360,45e4,20),h540:new ua(960,540,8e5,25),h720:new ua(1280,720,17e5,30),h1080:new ua(1920,1080,3e6,30),h1440:new ua(2560,1440,5e6,30),h2160:new ua(3840,2160,8e6,30)},ba={h120:new ua(160,120,7e4,20),h180:new ua(240,180,125e3,20),h240:new ua(320,240,14e4,20),h360:new ua(480,360,33e4,20),h480:new ua(640,480,5e5,20),h540:new ua(720,540,6e5,25),h720:new ua(960,720,13e5,30),h1080:new ua(1440,1080,23e5,30),h1440:new ua(1920,1440,38e5,30)},ya={h360fps3:new ua(640,360,2e5,3,"medium"),h360fps15:new ua(640,360,4e5,15,"medium"),h720fps5:new ua(1280,720,8e5,5,"medium"),h720fps15:new ua(1280,720,15e5,15,"medium"),h720fps30:new ua(1280,720,2e6,30,"medium"),h1080fps15:new ua(1920,1080,25e5,15,"medium"),h1080fps30:new ua(1920,1080,5e6,30,"medium"),original:new ua(0,0,7e6,30,"medium")},ka="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Sa(e){return yi(this,void 0,void 0,function*(){return new Promise(t=>aa.setTimeout(t,e))})}function Ta(){return"addTransceiver"in RTCPeerConnection.prototype}function wa(){return"addTrack"in RTCPeerConnection.prototype}function Ca(e){return"av1"===e||"vp9"===e}function Ea(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function xa(){var e;return"Firefox"===(null===(e=ta())||void 0===e?void 0:e.name)}function Pa(){var e;return"Safari"===(null===(e=ta())||void 0===e?void 0:e.name)}function Ra(){const e=ta();return"Safari"===(null===e||void 0===e?void 0:e.name)||"iOS"===(null===e||void 0===e?void 0:e.os)}function Oa(){const e=ta();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")}function _a(){var e,t;return!!Na()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function Na(){return"undefined"!==typeof document}function Ia(){return"ReactNative"==navigator.product}function Aa(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function Da(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Ma(){if(!Ia())return;let e=Da();return e?e.platform:void 0}function La(){if(Na())return window.devicePixelRatio;if(Ia()){let e=Da();if(e)return e.devicePixelRatio}return 1}function ja(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let a=0;a<r;++a){const e=parseInt(n[a],10),t=parseInt(i[a],10);if(e>t)return 1;if(e<t)return-1;if(a===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Ua(e){for(const t of e)t.target.handleResize(t)}function Fa(e){for(const t of e)t.target.handleVisibilityChanged(t)}let Ba=null;const za=()=>(Ba||(Ba=new ResizeObserver(Ua)),Ba);let Va=null;const qa=()=>(Va||(Va=new IntersectionObserver(Fa,{root:null,rootMargin:"0px"})),Va);let Ha;function Wa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const a=r.getContext("2d");null===a||void 0===a||a.fillRect(0,0,r.width,r.height),i&&a&&(a.beginPath(),a.arc(e/2,t/2,50,0,2*Math.PI,!0),a.closePath(),a.fillStyle="grey",a.fill());const o=r.captureStream(),[s]=o.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function Ka(){if(!Ha){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Ha]=i.stream.getAudioTracks(),!Ha)throw Error("Could not get empty media stream audio track");Ha.enabled=!1}return Ha.clone()}class Ga{constructor(e,t){this.onFinally=t,this.promise=new Promise((t,n)=>yi(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)})}}function Ja(e){if("string"===typeof e||"number"===typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Qa(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function $a(e){switch(e.reason){case Ur.LeaveRequest:return e.context;case Ur.Cancelled:return Tt.CLIENT_INITIATED;case Ur.NotAllowed:return Tt.USER_REJECTED;case Ur.ServerUnreachable:return Tt.JOIN_FAILURE;default:return Tt.UNKNOWN_REASON}}function Ya(e){return void 0!==e?Number(e):void 0}function Xa(e){return void 0!==e?BigInt(e):void 0}function Za(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function eo(e){return!!e&&e.kind==ca.Kind.Audio}function to(e){return!!e&&e.kind==ca.Kind.Video}function no(e){return Za(e)&&to(e)}function io(e){return Za(e)&&eo(e)}function ro(e){return!!e&&!e.isLocal}function ao(e){return!!e&&!e.isLocal}function oo(e){return ro(e)&&to(e)}function so(e,t,n){var i,r,a,o;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=yo(null!==e&&void 0!==e?e:{}),d=null===t||void 0===t?void 0:t.processor,u=null===n||void 0===n?void 0:n.processor,h=null!==s&&void 0!==s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(co(h.audio,t),null!==(i=(a=h.audio).deviceId)&&void 0!==i||(a.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=null!==c&&void 0!==c?c:d)),h.video&&(co(h.video,n),null!==(r=(o=h.video).deviceId)&&void 0!==r||(o.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=null!==l&&void 0!==l?l:u)),h}function co(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function lo(e){var t,n,i,r;const a={};if(e.video)if("object"===typeof e.video){const n={},r=n,o=e.video;Object.keys(o).forEach(e=>{if("resolution"===e)co(r,o.resolution);else r[e]=o[e]}),a.video=n,null!==(t=(i=a.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else a.video=!!e.video&&{deviceId:{ideal:"default"}};else a.video=!1;return e.audio?"object"===typeof e.audio?(a.audio=e.audio,null!==(n=(r=a.audio).deviceId)&&void 0!==n||(r.deviceId={ideal:"default"})):a.audio={deviceId:{ideal:"default"}}:a.audio=!1,a}function uo(e){return yi(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=ho();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,a=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Sa(t),i.getByteTimeDomainData(a);const o=a.some(e=>128!==e&&0!==e);return n.close(),!o}return!1}()})}function ho(){var e;const t="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&"undefined"!==typeof window&&(null===(e=window.document)||void 0===e?void 0:e.body)){const e=()=>yi(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(_){console.warn("Error trying to auto-resume audio context",_)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)});window.document.body.addEventListener("click",e)}return n}}function po(e){return"audioinput"===e?ca.Source.Microphone:"videoinput"===e?ca.Source.Camera:ca.Source.Unknown}function fo(e){return e===ca.Source.Microphone?"audioinput":e===ca.Source.Camera?"videoinput":void 0}function mo(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=Pa()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function go(e){return e.split("/")[1].toLowerCase()}function vo(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new wn({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function bo(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?bo(e.track):{})}}function yo(e){const t=Object.assign({},e);let n,i;return"object"===typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"===typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:(r=t,"undefined"===typeof r?r:"function"===typeof structuredClone?"object"===typeof r&&null!==r?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r)))};var r}class ko extends Ci.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":fi.error(r.error.message),this.emit(Ar.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(Ar.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(Ar.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(Nr.KeyRatcheted,r.ratchetResult,r.participantIdentity,r.keyIndex)}},this.onWorkerError=e=>{fi.error("e2ee worker encountered an error:",{error:e.error}),this.emit(Ar.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Mr())throw new Kr("tried to setup end-to-end encryption on an unsupported browser");if(fi.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:gi.getLevel()}};this.worker&&(fi.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){fi.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):fi.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(qr.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(e,t){e.on(zr.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==At.NONE,t.identity)),e.on(zr.ConnectionStateChanged,t=>{t===rc.Connected&&e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==At.NONE,e.identity)})})}).on(zr.TrackUnsubscribed,(e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)}).on(zr.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(zr.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Vr.LocalTrackPublished,e=>yi(this,void 0,void 0,function*(){this.setupE2EESender(e.track,e.track.sender)})),t.on(Nr.SetKey,e=>this.postKey(e)).on(Nr.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(a)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?go(n.mimeType):void 0)}}setupE2EESender(e,t){Za(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||fi.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return yi(this,void 0,void 0,function*(){if(this.worker){if(Lr()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(_r in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,a=e.readableStream;if(!r||!a){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,a=t.readable}const o={kind:"decode",data:{readableStream:a,writableStream:r,trackId:t,codec:i,participantIdentity:n,isReuse:_r in e}};this.worker.postMessage(o,[a,r])}e[_r]=!0}})}handleSender(e,t,n){var i;if(!(_r in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Lr()){fi.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{fi.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[i.readable,i.writable])}e[_r]=!0}}}const So="default";class To{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new To),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return yi(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=To.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){fi.debug("awaiting getUserMedia promise");try{e?yield To.userMediaPromiseMap.get(e):yield Promise.all(To.userMediaPromiseMap.values())}catch(_){fi.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!Pa()||!t.hasDeviceInUse(e))){if(0===r.filter(t=>t.kind===e).length||r.some(t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}}return t._previousDevices=r,e&&(r=r.filter(t=>t.kind===e)),r}()})}normalizeDeviceId(e,t,n){return yi(this,void 0,void 0,function*(){if(t!==So)return t;const i=yield this.getDevices(e),r=i.find(e=>e.deviceId===So);if(!r)return void fi.warn("could not reliably determine default device");const a=i.find(e=>e.deviceId!==So&&e.groupId===(null!==n&&void 0!==n?n:r.groupId));if(a)return null===a||void 0===a?void 0:a.deviceId;fi.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?To.userMediaPromiseMap.has(e):To.userMediaPromiseMap.size>0}}var wo;To.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],To.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(wo||(wo={}));class Co{constructor(){this.pendingTasks=new Map,this.taskMutex=new I,this.nextTaskIndex=0}run(e){return yi(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:wo.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=wo.RUNNING,yield e()}finally{t.status=wo.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return yi(this,void 0,void 0,function*(){return this.run(()=>yi(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function Eo(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}const xo=["syncState","trickle","offer","answer","simulate","leave"];var Po;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(Po||(Po={}));class Ro{get currentState(){return this.state}get isDisconnected(){return this.state===Po.DISCONNECTING||this.state===Po.DISCONNECTED}get isEstablishingConnection(){return this.state===Po.CONNECTING||this.state===Po.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=Po.DISCONNECTED,this.log=fi,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=mi(null!==(n=t.loggerName)&&void 0!==n?n:hi.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Co,this.queuedRequests=[],this.closingLock=new I,this.connectionLock=new I,this.state=Po.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return yi(this,void 0,void 0,function*(){this.state=Po.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)})}reconnect(e,t,n,i){return yi(this,void 0,void 0,function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=Po.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))})}connect(e,t,n,i){this.connectOptions=n;const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Ia()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return r}(t,function(){var e;const t=new Zt({sdk:en.JS,protocol:16,version:"2.13.8"});return Ia()&&(t.os=null!==(e=Ma())&&void 0!==e?e:""),t}(),n),a=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),Eo(n,"rtc")}(e,r),o=Eo(new URL(Qa(a)),"validate");return new Promise((e,t)=>yi(this,void 0,void 0,function*(){const r=yield this.connectionLock.lock();try{const r=()=>yi(this,void 0,void 0,function*(){this.close(),clearTimeout(s),t(new Wr("room connection has been cancelled (signal)",Ur.Cancelled))}),s=setTimeout(()=>{this.close(),t(new Wr("room connection has timed out (signal)",Ur.ServerUnreachable))},n.websocketTimeout);(null===i||void 0===i?void 0:i.aborted)&&r(),null===i||void 0===i||i.addEventListener("abort",r);const c=new URL(a);c.searchParams.has("access_token")&&c.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(c),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(s)},this.ws.onerror=e=>yi(this,void 0,void 0,function*(){if(this.state===Po.CONNECTED)this.handleWSError(e);else{this.state=Po.DISCONNECTED,clearTimeout(s);try{const n=yield fetch(o);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new Wr(e,Ur.NotAllowed,n.status))}else t(new Wr("Encountered unknown websocket error during connection: ".concat(e.toString()),Ur.InternalError,n.status))}catch(_){t(new Wr(_ instanceof Error?_.message:"server was not reachable",Ur.ServerUnreachable))}}}),this.ws.onmessage=a=>yi(this,void 0,void 0,function*(){var o,s,c;let l;if("string"===typeof a.data){const e=JSON.parse(a.data);l=gn.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(a.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof a.data),this.logContext);l=gn.fromBinary(new Uint8Array(a.data))}if(this.state!==Po.CONNECTED){let a=!1;if("join"===(null===(o=l.message)||void 0===o?void 0:o.case)?(this.state=Po.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(l.message.value)):this.state===Po.RECONNECTING&&"leave"!==l.message.case?(this.state=Po.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?e(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),a=!0)):this.isEstablishingConnection&&"leave"===l.message.case?t(new Wr("Received leave request while trying to (re)connect",Ur.LeaveRequest,void 0,l.message.value.reason)):n.reconnect||t(new Wr("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"),Ur.InternalError)),!a)return}this.signalLatency&&(yield Sa(this.signalLatency)),this.handleSignalResponse(l)}),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new Wr("Websocket got closed during a (re)connection attempt",Ur.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{r()}}))}close(){return yi(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=Po.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise(t=>{e.ws?e.ws.onclose=()=>{t()}:t()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,Sa(250)])),e.ws=void 0}}finally{t&&(e.state=Po.DISCONNECTED),n()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:_o(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:_o(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new yn({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new kn({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return yi(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new Dn({requestId:r,metadata:e,name:t,attributes:i})}),r}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new An({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Kn({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ee.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Zn({timestamp:ee.parse(Date.now()),rtt:ee.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new On({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Nn({reason:Tt.CLIENT_INITIATED,action:In.DISCONNECT})})}sendRequest(e){return yi(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=xo.indexOf(e.case)>=0;return fi.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===Po.RECONNECTING)return void t.queuedRequests.push(()=>yi(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield Sa(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),t.logContext);const r=new mn({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(_){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:_}))}}()})}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=Oo(i.value);this.onAnswer&&this.onAnswer(e,i.value.id)}else if("offer"===i.case){const e=Oo(i.value);this.onOffer&&this.onOffer(e,i.value.id)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return yi(this,void 0,void 0,function*(){if(this.state===Po.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=aa.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&aa.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=aa.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&aa.clearInterval(this.pingInterval)}}function Oo(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function _o(e,t){return new En({sdp:e.sdp,type:e.type,id:t})}class No{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0;){if(!(this.buffer[0].sequence<=e))break;this.pop()}}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Io{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(!(t.expiresAt<Date.now()))return t.value;this._map.delete(e)}}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,r]of n.entries())t.push(e(r,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var Ao,Do,Mo,Lo,jo,Uo={},Fo={},Bo={exports:{}};function zo(){if(Ao)return Bo.exports;Ao=1;var e=Bo.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),Bo.exports}function Vo(){return Do||(Do=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var a=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var a=0;a<i.length;a+=1)null!=e[a+1]&&(n[i[a]]=t(e[a+1]))}(i.match(e.reg),a,e.names,e.name),e.push&&n[e.push].push(a)},i=zo(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,o,r)}}),t.media=a,t};var a=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(Fo)),Fo}function qo(){if(Lo)return Mo;Lo=1;var e=zo(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var o=t.names[a];t.name?r.push(i[t.name][o]):r.push(i[t.names[a]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];return Mo=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var o=n.outerOrder||r,s=n.innerOrder||a,c=[];return o.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})}),t.media.forEach(function(t){c.push(i("m",e.m[0],t)),s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})})}),c.join("\r\n")+"\r\n"},Mo}var Ho=function(){if(jo)return Uo;jo=1;var e=Vo(),t=qo(),n=zo();return Uo.grammar=n,Uo.write=t,Uo.parse=e.parse,Uo.parseParams=e.parseParams,Uo.parseFmtpConfig=e.parseFmtpConfig,Uo.parsePayloads=e.parsePayloads,Uo.parseRemoteCandidates=e.parseRemoteCandidates,Uo.parseImageAttributes=e.parseImageAttributes,Uo.parseSimulcastStreamList=e.parseSimulcastStreamList,Uo}();function Wo(e,t,n){var i,r,a;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,r){var c=o&&void 0===a;if(void 0!==a&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!o){var i=e.apply(n,t);s&&s(i),d.forEach(function(e){return(0,e.resolve)(i)}),d=[]}},u()),c){var h=e.apply(n,t);return s&&s(h),i(h)}d.push({resolve:i,reject:r})})};return h.cancel=function(e){void 0!==a&&clearTimeout(a),d.forEach(function(t){return(0,t.reject)(e)}),d=[]},h}const Ko="negotiationStarted",Go="negotiationComplete",Jo="rtpVideoPayloadTypes";class Qo extends Ci.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=fi,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Wo(e=>yi(this,void 0,void 0,function*(){this.emit(Ko);try{yield this.createAndSendOffer()}catch(_){if(!e)throw _;e(_)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=mi(null!==(n=t.loggerName)&&void 0!==n?n:hi.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return yi(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return yi(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=Ho.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let a=0;return r.media.forEach(e=>{var t;"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(a=e.payload,!0)),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(e=>e.payload===a&&"nack"===e.type))&&i.push(e.mid),e.fmtp.some(t=>t.payload===a&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)))}),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=Ho.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{"audio"===e.type&&this.trackBitrates.some(t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),i=Ho.write(t)}if(yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(Go),e.sdp)){Ho.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(Jo,e.rtp)})}return!0})}createAndSendOffer(e){return yi(this,void 0,void 0,function*(){var t;const n=this.latestOfferId+1;if(this.latestOfferId=n,void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=Ho.parse(null!==(t=i.sdp)&&void 0!==t?t:"");r.media.forEach(e=>{Yo(e),"audio"===e.type?$o(e,[],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;if(Ca(t.codec)&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(i));break}return!0})}),this.latestOfferId>n?this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n})):(yield this.setMungedSDP(i,Ho.write(r)),this.onOffer(i,this.latestOfferId))})}createAndSetAnswer(){return yi(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=Ho.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{Yo(e),"audio"===e.type&&$o(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Ho.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Qr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Qr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return yi(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0})}setMungedSDP(e,t,n){return yi(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(_){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:_,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(_){let i="unknown error";_ instanceof Error?i=_.message:"string"===typeof _&&(i=_);const r={error:i,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new $r(i)}})}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===ka))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:ka})}}}function $o(e,t,n){let i=0;e.rtp.some(e=>"opus"===e.codec&&(i=e.payload,!0)),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(e=>e.payload===i&&"nack"===e.type)&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function Yo(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const Xo="vp8",Zo={audioPreset:ga.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ya.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Xo,backupCodec:!0,preConnectBuffer:!1},es={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},ts={deviceId:{ideal:"default"},resolution:va.h720.resolution},ns={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:bi}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},is={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var rs;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(rs||(rs={}));class as{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=is.peerConnectionTimeout,this.log=fi,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map(e=>e.getConnectionState());n.every(e=>"connected"===e)?this.state=rs.CONNECTED:n.some(e=>"failed"===e)?this.state=rs.FAILED:n.some(e=>"connecting"===e)?this.state=rs.CONNECTING:n.every(e=>"closed"===e)?this.state=rs.CLOSED:n.some(e=>"closed"===e)?this.state=rs.CLOSING:n.every(e=>"new"===e)&&(this.state=rs.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(rs[t]," to ").concat(rs[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=mi(null!==(i=n.loggerName)&&void 0!==i?i:hi.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new Qo(e,n),this.subscriber=new Qo(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,hn.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,hn.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=rs.NEW,this.connectionLock=new I,this.remoteOfferLock=new I}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return yi(this,void 0,void 0,function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(_){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:_}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return yi(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return yi(this,void 0,void 0,function*(){t===hn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return yi(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{if(!(yield this.subscriber.setRemoteDescription(e,t)))return;return yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return yi(this,void 0,void 0,function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{i()}})}negotiate(e){return yi(this,void 0,void 0,function*(){return new Promise((t,n)=>yi(this,void 0,void 0,function*(){const i=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(i),n("negotiation aborted")}),this.publisher.once(Ko,()=>{e.signal.aborted||this.publisher.once(Go,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(i),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===hn.PUBLISHER||e===hn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return yi(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise((e,r)=>yi(n,void 0,void 0,function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),aa.clearTimeout(a),r(new Wr("room connection has been cancelled",Ur.Cancelled))};(null===t||void 0===t?void 0:t.signal.aborted)&&n(),null===t||void 0===t||t.signal.addEventListener("abort",n);const a=aa.setTimeout(()=>{null===t||void 0===t||t.signal.removeEventListener("abort",n),r(new Wr("could not establish pc connection",Ur.InternalError))},i);for(;this.state!==rs.CONNECTED;)if(yield Sa(50),null===t||void 0===t?void 0:t.signal.aborted)return void r(new Wr("room connection has been cancelled",Ur.Cancelled));aa.clearTimeout(a),null===t||void 0===t||t.signal.removeEventListener("abort",n),e()}))}()})}}class os extends Error{constructor(e,t,n){super(t),this.code=e,this.message=cs(t,os.MAX_MESSAGE_BYTES),this.data=n?cs(n,os.MAX_DATA_BYTES):void 0}static fromProto(e){return new os(e.code,e.message,e.data)}toProto(){return new Qt({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new os(os.ErrorCode[e],os.ErrorMessage[e],t)}}os.MAX_MESSAGE_BYTES=256,os.MAX_DATA_BYTES=15360,os.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},os.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};function ss(e){return(new TextEncoder).encode(e).length}function cs(e,t){if(ss(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const a=Math.floor((n+i+1)/2);r.encode(e.slice(0,a)).length<=t?n=a:i=a-1}return e.slice(0,n)}const ls=2e3;function ds(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const us="undefined"!==typeof MediaRecorder;const hs=us?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class ps extends hs{constructor(e,t){if(!us)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const r=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",a),null===i||void 0===i||i.close(),i=void 0},a=e=>{null===i||void 0===i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",a),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>yi(this,void 0,void 0,function*(){const n=yield t.data.arrayBuffer();void 0!==i&&e.enqueue(new Uint8Array(n))}),this.addEventListener("dataavailable",n)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",a)}}class fs extends ca{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Wo(()=>yi(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>yi(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Hr.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new I,this.pauseUpstreamLock=new I,this.processorLock=new I,this.restartLock=new I,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ca.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return yi(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let i;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{da(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(la(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{t()}}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(null!==i&&void 0!==i?i:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{la(null!==i&&void 0!==i?i:e,t)}))})}waitForDimensions(){return yi(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===ca.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=ta())||void 0===n?void 0:n.os)&&(yield Sa(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield Sa(50)}throw new Gr("unable to get track dimensions after timeout")}()})}setDeviceId(e){return yi(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ja(e)||(this._constraints.deviceId=e,!!this.isMuted||(yield this.restartTrack(),Ja(e)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return yi(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===ca.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===ca.Kind.Audio?"audioinput":"videoinput";return t?To.getInstance().normalizeDeviceId(r,n,i):n}()})}mute(){return yi(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return yi(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return yi(this,void 0,void 0,function*(){if(!this.sender)throw new Gr("unable to replace an unpublished track");let n,i;return"boolean"===typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null===n||void 0===n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return yi(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===ca.Kind.Video?r.video=!t&&!n||{deviceId:t,facingMode:n}:r.audio=!t||{deviceId:t},this.attachedElements.forEach(e=>{da(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return yield a.applyConstraints(i),a.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(a),this._constraints=e,this.emit(Hr.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Hr.Muted:Hr.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return yi(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),_a()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return yi(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Hr.UpstreamPaused,this);const t=ta();if("Safari"===(null===t||void 0===t?void 0:t.name)&&ja(t.version,"12.0")<0)throw new Kr("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return yi(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Hr.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return yi(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()})}setProcessor(e){return yi(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.processorLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),a={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(a),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.stopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(la(t._mediaStreamTrack,r),r.muted=!0,r.play().catch(e=>t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(da(t._mediaStreamTrack,e),la(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(Hr.TrackProcessorUpdate,t.processor)}finally{r()}}()})}getProcessor(){return this.processor}stopProcessor(){return yi(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Hr.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;us?this.localTrackRecorder?this.log.warn("preconnect buffer already started"):(this.localTrackRecorder=new ps(this,{mimeType:"audio/webm;codecs=opus"}),this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},1e4)):this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}}class ms extends fs{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,ca.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>yi(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(_){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:_}))}e&&this.prevStats&&(this._currentBitrate=ds(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Hr.AudioTrackFeatureUpdate,this,Et.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Hr.AudioTrackFeatureUpdate,this,Et.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return yi(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ca.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return yi(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ja(this._constraints.deviceId);return this.source!==ca.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return yi(this,void 0,void 0,function*(){let t;if(e){const n=lo({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return yi(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){Na()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},ls)))}setProcessor(e){return yi(this,void 0,void 0,function*(){var t;const n=yield this.processorLock.lock();try{if(!Ia()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Hr.TrackProcessorUpdate,this.processor)}finally{n()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return yi(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return yi(this,void 0,void 0,function*(){const e=yield uo(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Hr.AudioSilenceDetected)),e})}}const gs=Object.values(va),vs=Object.values(ba),bs=Object.values(ya),ys=[va.h180,va.h360],ks=[ba.h180,ba.h360],Ss=["q","h","f"];function Ts(e,t,n,i){var r,a;let o=null===i||void 0===i?void 0:i.videoEncoding;e&&(o=null===i||void 0===i?void 0:i.screenShareEncoding);const s=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!o&&!s&&!c||!t||!n)return[{}];o||(o=function(e,t,n,i){const r=function(e,t,n){if(e)return bs;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return gs;return vs}(e,t,n);let{encoding:a}=r[0];const o=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(a=e.encoding,e.width>=o)break}if(i)switch(i){case"av1":a=Object.assign({},a),a.maxBitrate=.7*a.maxBitrate;break;case"vp9":a=Object.assign({},a),a.maxBitrate=.85*a.maxBitrate}return a}(e,t,n,l),fi.debug("using video encoding",o));const d=o.maxFramerate,u=new ua(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Ca(l)){const e=new xs(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=ta();if(Pa()||Ia()||"Chrome"===(null===n||void 0===n?void 0:n.name)&&ja(null===n||void 0===n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,r=function(e){return e||(e=ta()),"Safari"===(null===e||void 0===e?void 0:e.name)&&ja(e.version,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:Ss[2-n],maxBitrate:o.maxBitrate/Math.pow(i,n),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:r?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:o.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(t[0].priority=u.encoding.priority,t[0].networkPriority=u.encoding.priority),fi.debug("using svc encoding",{encodings:t}),t}if(!s)return[o];let h,p=[];if(p=e?null!==(r=Es(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:ws(e,u):null!==(a=Es(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==a?a:ws(e,u),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return Cs(t,n,[e,h,u],d);if(i>=480)return Cs(t,n,[e,u],d)}return Cs(t,n,[u])}function ws(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map(e=>{var t,i;return new ua(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)});var n;const{width:i,height:r}=t,a=i>r?i/r:r/i;return Math.abs(a-16/9)<Math.abs(a-4/3)?ys:ks}function Cs(e,t,n,i){const r=[];if(n.forEach((n,a)=>{if(a>=Ss.length)return;const o=Math.min(e,t),s={rid:Ss[a],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=xa()||0===a;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)}),Ia()&&"ios"===Ma()){let e;r.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;r.forEach(n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,fi.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),fi.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)})}return r}function Es(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}class xs{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Ps extends fs{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,ca.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>yi(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(_){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:_}))}const t=new Map(e.map(e=>[e.rid,e]));if(this.prevStats){let e=0;t.forEach((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=ds(t,r)}),this._currentBitrate=e}this.prevStats=t}),this.senderLock=new I}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Na())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},ls))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return yi(this,void 0,void 0,function*(){var t,n,i,r,a;yield e.pauseUpstream.call(this);try{for(var o,s=!0,c=Si(this.simulcastCodecs.values());!(t=(o=yield c.next()).done);s=!0){r=o.value,s=!1;const e=r;yield null===(a=e.sender)||void 0===a?void 0:a.replaceTrack(null)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return yi(this,void 0,void 0,function*(){var t,n,i,r,a;yield e.resumeUpstream.call(this);try{for(var o,s=!0,c=Si(this.simulcastCodecs.values());!(t=(o=yield c.next()).done);s=!0){r=o.value,s=!1;const e=r;yield null===(a=e.sender)||void 0===a?void 0:a.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return yi(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==ca.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return yi(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==ca.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return yi(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},a=n.get(e.remoteId);a&&(r.jitter=a.jitter,r.packetsLost=a.packetsLost,r.roundTripTime=a.roundTripTime),t.push(r)}}),t.sort((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),t})}setPublishingQuality(e){const t=[];for(let n=sa.LOW;n<=sa.HIGH;n+=1)t.push(new Vn({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Ca(this.codec),t)}restartTrack(e){return yi(this,void 0,void 0,function*(){var t,n,i,r,a;let o;if(e){const t=lo({video:e});"boolean"!==typeof t.video&&(o=t.video)}yield this.restart(o);try{for(var s,c=!0,l=Si(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){r=s.value,c=!1;const e=r;e.sender&&"closed"!==(null===(a=e.sender.transport)||void 0===a?void 0:a.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(d){n={error:d}}finally{try{c||t||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return yi(this,arguments,void 0,function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,a,o,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var d,u=!0,h=Si(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(p){a={error:p}}finally{try{u||r||!(o=h.return)||(yield o.call(h))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return yi(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(_){this.log.warn("failed to set degradationPreference",Object.assign({error:_},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},5e3))}setPublishingCodecs(e){return yi(this,void 0,void 0,function*(){var t,n,i,r,a,o,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Ca(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=Si(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Rs(t.sender,t.encodings,e.qualities,this.senderLock,Ca(e.codec),this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(Ca(e.codec),e.qualities)}}catch(l){a={error:l}}finally{try{t||r||!(o=n.return)||(yield o.call(n))}finally{if(a)throw a.error}}return c})}setPublishingLayers(e,t){return yi(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield Rs(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return yi(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),_a()&&this.isInBackground&&this.source===ca.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Rs(e,t,n,i,r,a,o){return yi(this,void 0,void 0,function*(){const s=yield i.lock();a.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void a.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:s,senderEncodings:t}));let c=!1;if(!1&&s[0].scalabilityMode);else{if(r){n.some(e=>e.enabled)&&n.forEach(e=>e.enabled=!0)}s.forEach((e,i)=>{var r;let s=null!==(r=e.rid)&&void 0!==r?r:"";""===s&&(s="q");const l=Os(s),d=n.find(e=>e.quality===l);d&&e.active!==d.enabled&&(c=!0,e.active=d.enabled,a.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),o),xa()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})}c&&(i.encodings=s,a.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}})}function Os(e){switch(e){case"f":default:return sa.HIGH;case"h":return sa.MEDIUM;case"q":return sa.LOW}}function _s(e,t,n,i){if(!n)return[new Lt({quality:sa.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new xs(i),a=[],o="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let c=0;c<r.spatial;c+=1)a.push(new Lt({quality:Math.min(sa.HIGH,r.spatial-1)-c,width:Math.ceil(e/Math.pow(o,c)),height:Math.ceil(t/Math.pow(o,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,c)):0,ssrc:0}));return a}return n.map(n=>{var i,r,a;const o=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Os(null!==(r=n.rid)&&void 0!==r?r:"");return new Lt({quality:s,width:Math.ceil(e/o),height:Math.ceil(t/o),bitrate:null!==(a=n.maxBitrate)&&void 0!==a?a:0,ssrc:0})})}const Ns="_lossy",Is="_reliable",As="leave-reconnect";var Ds;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Ds||(Ds={}));class Ms extends Ci.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=is.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ds.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=fi,this.reliableDataSequence=1,this.reliableMessageBuffer=new No,this.reliableReceivedState=new Io(3e4),this.handleDataChannel=e=>yi(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===Is)t.reliableDCSub=n;else{if(n.label!==Ns)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=e=>yi(this,void 0,void 0,function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=jt.fromBinary(new Uint8Array(i));if(r.sequence>0&&""!==r.participantSid){const e=this.reliableReceivedState.get(r.participantSid);if(e&&r.sequence<=e)return;this.reliableReceivedState.set(r.participantSid,r.sequence)}"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(qr.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(qr.DataPacketReceived,r))}finally{i()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?Ut.LOSSY:Ut.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(qr.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===As&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=aa.setTimeout(()=>this.attemptReconnect(t).finally(()=>this.reconnectTimeout=void 0),r)):n(i)},this.waitForRestarted=()=>new Promise((e,t)=>{this.pcState===Ds.Connected&&e();const n=()=>{this.off(qr.Disconnected,i),e()},i=()=>{this.off(qr.Restarted,n),t()};this.once(qr.Restarted,n),this.once(qr.Disconnected,i)}),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(qr.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===Ut.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Po.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(wt.RR_SIGNAL_DISCONNECTED))},this.log=mi(null!==(t=e.loggerName)&&void 0!==t?t:hi.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ro(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new I,this.dataProcessLock=new I,this.dcBufferStatus=new Map([[Ut.LOSSY,!0],[Ut.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(qr.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(qr.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(qr.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(qr.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(qr.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(qr.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(qr.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(qr.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,a;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(a=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===a?void 0:a.identity,pID:this.participantSid}}join(e,t,n,i){return yi(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary&&!r.fastPublish||this.negotiate(),this.clientConfiguration=r.clientConfiguration,this.emit(qr.SignalConnected,r),r}catch(_){if(_ instanceof Wr&&_.reason===Ur.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw _}})}close(){return yi(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(qr.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return yi(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new No,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return yi(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Gr("a track with the same ID has already been published");return new Promise((t,n)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],n(new Wr("publication of local track timed out, no response from server",Ur.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(_){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:_}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return yi(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return yi(this,void 0,void 0,function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==rs.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var r;this.pcManager=new as(i,e.subscriberPrimary,this.loggerOptions),this.emit(qr.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>yi(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===rs.CONNECTED){const t=this.pcState===Ds.New;this.pcState=Ds.Connected,t&&this.emit(qr.Connected,e)}else t===rs.FAILED&&this.pcState===Ds.Connected&&(this.pcState=Ds.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?wt.RR_SUBSCRIBER_FAILED:wt.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===Po.RECONNECTING,a=[rs.FAILED,rs.CLOSING,rs.CLOSED].includes(t);r&&a&&!this._isClosed&&this.emit(qr.Offline)}),this.pcManager.onTrack=e=>{this.emit(qr.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(r=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&r>13||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>yi(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>yi(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(qr.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(qr.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(qr.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(qr.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(qr.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",wt.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case In.DISCONNECT:this.emit(qr.Disconnected,null===e||void 0===e?void 0:e.reason),this.close();break;case In.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(As);break;case In.RESUME:this.handleDisconnect(As)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===St.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ns,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Is,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return yi(this,void 0,void 0,function*(){if(Ta()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(wa()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new Qr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,i){return yi(this,void 0,void 0,function*(){if(Ta())return this.createSimulcastTransceiverSender(e,t,n,i);if(wa())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Qr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return yi(this,void 0,void 0,function*(){if(!this.pcManager)throw new Qr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),to(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,t,n,i){return yi(this,void 0,void 0,function*(){if(!this.pcManager)throw new Qr("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const a=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return yi(this,void 0,void 0,function*(){if(!this.pcManager)throw new Qr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return yi(this,void 0,void 0,function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)fi.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==St.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:rs.NEW)!==rs.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(_){this.reconnectAttempts+=1;let t=!0;_ instanceof Qr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:_})),t=!1):_ instanceof Ls||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",wt.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(qr.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(_){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:_}))}return null}restartConnection(e){return yi(this,void 0,void 0,function*(){var t,n,i;try{if(!this.url||!this.token)throw new Qr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(qr.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ls;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(_){if(_ instanceof Wr&&_.reason===Ur.NotAllowed)throw new Qr("could not reconnect, token might be expired");throw new Ls}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(qr.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==Po.CONNECTED)throw new Ls("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(qr.Restarted)}catch(r){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),r}})}resumeConnection(e){return yi(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new Qr("could not reconnect, url or token not saved");if(!this.pcManager)throw new Qr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(qr.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let e="";if(i instanceof Error&&(e=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Wr&&i.reason===Ur.NotAllowed)throw new Qr("could not reconnect, token might be expired");if(i instanceof Wr&&i.reason===Ur.LeaveRequest)throw i;throw new Ls(e)}if(this.emit(qr.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Po.CONNECTED)throw new Ls("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),(null===n||void 0===n?void 0:n.lastMessageSeq)&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(qr.Resumed)})}waitForPCInitialConnection(e,t){return yi(this,void 0,void 0,function*(){if(!this.pcManager)throw new Qr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return yi(this,void 0,void 0,function*(){this.pcState=Ds.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Sa(2e3),!this.pcManager)throw new Qr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ds.Connected}catch(_){throw this.pcState=Ds.Disconnected,new Wr("could not establish PC connection, ".concat(_.message),Ur.InternalError)}})}publishRpcResponse(e,t,n,i){return yi(this,void 0,void 0,function*(){const r=new jt({destinationIdentities:[e],kind:Ut.RELIABLE,value:{case:"rpcResponse",value:new Jt({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!==n&&void 0!==n?n:""}})}});yield this.sendDataPacket(r,Ut.RELIABLE)})}publishRpcAck(e,t){return yi(this,void 0,void 0,function*(){const n=new jt({destinationIdentities:[e],kind:Ut.RELIABLE,value:{case:"rpcAck",value:new Gt({requestId:t})}});yield this.sendDataPacket(n,Ut.RELIABLE)})}sendDataPacket(e,t){return yi(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===Ut.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===Ut.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return yi(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ut.RELIABLE);const t=this.dataChannelForKind(Ut.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(Ut.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,n)=>yi(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>n("Engine closed");for(this.once(qr.Closing,i);!this.dcBufferStatus.get(e);)yield Sa(10);this.off(qr.Closing,i),t()}}))}ensureDataTransportConnected(e){return yi(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new Qr("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,a=n?"Subscriber":"Publisher";if(!r)throw new Wr("".concat(a," connection not set"),Ur.InternalError);let o=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),o=!0),o||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(o=!0),o&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield Sa(50)}throw new Wr("could not establish ".concat(a," connection, state: ").concat(r.getICEConnectionState()),Ur.InternalError)}()})}ensurePublisherConnected(e){return yi(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===rs.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return yi(this,void 0,void 0,function*(){return new Promise((e,t)=>yi(this,void 0,void 0,function*(){if(!this.pcManager)return void t(new $r("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(qr.Closing,i),this.pcManager.publisher.once(Jo,e=>{const t=new Map;e.forEach(e=>{const n=e.codec.toLowerCase();var i;i=n,pa.includes(i)&&t.set(e.payload,n)}),this.emit(qr.RTPVideoMapUpdate,t)});try{yield this.pcManager.negotiate(n),e()}catch(_){_ instanceof $r&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",wt.RR_UNKNOWN),t(_)}finally{this.off(qr.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===Ut.LOSSY)return this.lossyDCSub;if(e===Ut.RELIABLE)return this.reliableDCSub}else{if(e===Ut.LOSSY)return this.lossyDC;if(e===Ut.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),a=this.pcManager.subscriber.getRemoteDescription(),o=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach(e=>{e.isDesired!==o&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)}),this.client.sendSyncState(new Qn({answer:r?_o({sdp:r.sdp,type:r.type}):void 0,offer:a?_o({sdp:a.sdp,type:a.type}):void 0,subscription:new Pn({trackSids:s,subscribe:!o,participantTracks:[]}),publishTracks:vo(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new $n({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new Yn({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(Ut.LOSSY),hn.PUBLISHER),t(this.dataChannelForKind(Ut.RELIABLE),hn.PUBLISHER),t(this.dataChannelForKind(Ut.LOSSY,!0),hn.SUBSCRIBER),t(this.dataChannelForKind(Ut.RELIABLE,!0),hn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&aa.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Na()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Na()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Ls extends Error{}class js{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Aa(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return yi(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),fi.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return yi(this,void 0,void 0,function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new Wr("Could not fetch region settings: ".concat(t.statusText),401===t.status?Ur.NotAllowed:Ur.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class Us{get info(){return this._info}constructor(e,t,n){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0}}class Fs extends Us{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>yi(this,void 0,void 0,function*(){try{const{done:t,value:n}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(n),{done:!1,value:n.content})}catch(t){return{done:!0,value:void 0}}}),return(){return yi(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return yi(this,void 0,void 0,function*(){var e,t,n,i;let r=new Set;try{for(var a,o=!0,s=Si(this);!(e=(a=yield s.next()).done);o=!0){i=a.value,o=!1;const e=i;r.add(e)}}catch(c){t={error:c}}finally{try{o||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return Array.from(r)})}}class Bs extends Us{constructor(e,t,n){super(e,t,n),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=Ya(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>yi(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:t.decode(i.content)})}catch(n){return{done:!0,value:void 0}}}),return(){return yi(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return yi(this,void 0,void 0,function*(){var e,t,n,i;let r="";try{for(var a,o=!0,s=Si(this);!(e=(a=yield s.next()).done);o=!0){i=a.value,o=!1;r+=i}}catch(c){t={error:c}}finally{try{o||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return r})}}class zs{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return yi(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class Vs extends zs{}class qs extends zs{}class Hs extends ca{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Hr.Muted:Hr.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Hr.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return yi(this,void 0,void 0,function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),ls)),"undefined"!==typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Hr.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class Ws extends Hs{constructor(e,t,n,i,r,a){super(e,t,ca.Kind.Audio,n,a),this.monitorReceiver=()=>yi(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=ds(e,this.prevStats)),this.prevStats=e}),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Ia()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ia())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return yi(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Ea(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Ea(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{n.connect(e),n=e}),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then(()=>{"running"!==e.state&&this.emit(Hr.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(e=>{this.emit(Hr.AudioPlaybackFailed,e)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return yi(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}class Ks extends Hs{constructor(e,t,n,i,r){super(e,t,ca.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>yi(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=ds(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=Wo(()=>{this.updateDimensions()},100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?da(this._mediaStreamTrack,t):la(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new Gs(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return yi(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)}),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return yi(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const n=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some(e=>e.pictureInPicture),a=this.elementInfos.some(e=>e.visible)&&!i||r;this.lastVisible!==a&&(!a&&Date.now()-n<100?aa.setTimeout(()=>{this.updateVisibility()},100):(this.lastVisible=a,this.emit(Hr.VisibilityChanged,a,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const a of this.elementInfos){const e=a.width()*r,t=a.height()*r;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(Hr.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return La();if(!t){return La()>2?2:1}return t}}class Gs{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=Js(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Js(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=Js(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:Qs(e),this.isPiP=Na()&&Js(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Qs(this.element),this.isPiP=Js(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,qa().observe(this.element),za().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=qa())||void 0===e||e.unobserve(this.element),null===(t=za())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function Js(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&Qs(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Qs(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const a=e.offsetWidth,o=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+a>n.pageXOffset&&!s&&"none"!==c}class $s extends Ci.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=At.NONE,this.log=fi,this.handleMuted=()=>{this.emit(Hr.Muted)},this.handleUnmuted=()=>{this.emit(Hr.Unmuted)},this.log=mi(null!==(r=null===i||void 0===i?void 0:i.loggerName)&&void 0!==r?r:hi.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=ca.Source.Unknown}setTrack(e){this.track&&(this.track.off(Hr.Muted,this.handleMuted),this.track.off(Hr.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Hr.Muted,this.handleMuted),e.on(Hr.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),bo(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==At.NONE}get audioTrack(){if(eo(this.track))return this.track}get videoTrack(){if(to(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ca.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ca.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}($s||($s={}));class Ys extends $s{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Hr.Ended)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&this.track.off(Hr.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Hr.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return yi(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return yi(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return yi(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return yi(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(eo(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(Et.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(Et.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(Et.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(Et.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(Et.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(Et.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Xs(e,t){return yi(this,void 0,void 0,function*(){null!==e&&void 0!==e||(e={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:a}=yo(e);let o=a.audio,s=a.video;if(i&&"object"===typeof a.audio&&(a.audio.processor=i),r&&"object"===typeof a.video&&(a.video.processor=r),e.audio&&"object"===typeof a.audio&&"string"===typeof a.audio.deviceId){const e=a.audio.deviceId;a.audio.deviceId={exact:e},n=!0,o=Object.assign(Object.assign({},a.audio),{deviceId:{ideal:e}})}if(a.video&&"object"===typeof a.video&&"string"===typeof a.video.deviceId){const e=a.video.deviceId;a.video.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},a.video),{deviceId:{ideal:e}})}(!0===a.audio||"object"===typeof a.audio&&!a.audio.deviceId)&&(a.audio={deviceId:"default"}),!0===a.video?a.video={deviceId:"default"}:"object"!==typeof a.video||a.video.deviceId||(a.video.deviceId="default");const c=so(a,es,ts),l=lo(c),d=navigator.mediaDevices.getUserMedia(l);a.audio&&(To.userMediaPromiseMap.set("audioinput",d),d.catch(()=>To.userMediaPromiseMap.delete("audioinput"))),a.video&&(To.userMediaPromiseMap.set("videoinput",d),d.catch(()=>To.userMediaPromiseMap.delete("videoinput")));try{const e=yield d;return yield Promise.all(e.getTracks().map(n=>yi(this,void 0,void 0,function*(){const a="audio"===n.kind;let o,s=a?c.audio:c.video;"boolean"!==typeof s&&s||(s={});const d=a?l.audio:l.video;"boolean"!==typeof d&&(o=d);const u=n.getSettings().deviceId;(null===o||void 0===o?void 0:o.deviceId)&&Ja(o.deviceId)!==u?o.deviceId=u:o||(o={deviceId:u});const h=function(e,t,n){switch(e.kind){case"audio":return new ms(e,t,!1,void 0,n);case"video":return new Ps(e,t,!1,n);default:throw new Gr("unsupported track type: ".concat(e.kind))}}(n,o,t);return h.kind===ca.Kind.Video?h.source=ca.Source.Camera:h.kind===ca.Kind.Audio&&(h.source=ca.Source.Microphone),h.mediaStream=e,eo(h)&&i?yield h.setProcessor(i):to(h)&&r&&(yield h.setProcessor(r)),h})))}catch(_){if(!n)throw _;return Xs(Object.assign(Object.assign({},e),{audio:o,video:s}),t)}})}var Zs;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(Zs||(Zs={}));class ec extends Ci.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===Nt.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===_t.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Nt.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Zs.Unknown,this.log=fi,this.log=mi(null!==(s=null===a||void 0===a?void 0:a.loggerName)&&void 0!==s?s:hi.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=null!==r&&void 0!==r?r:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new Ga,this.once(Vr.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(ca.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(ca.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ca.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===_t.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==_t.ACTIVE&&this.emit(Vr.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(Vr.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(Vr.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const a of i)e[a]!==t[a]&&(r[a]=null!==(n=t[a])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(Vr.AttributesChanged,t)}setPermissions(e){var t,n,i,r,a,o;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(a=this.permissions)||void 0===a?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||e.canSubscribeMetrics!==(null===(o=this.permissions)||void 0===o?void 0:o.canSubscribeMetrics);return this.permissions=e,c&&this.emit(Vr.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Vr.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case kt.EXCELLENT:return Zs.Excellent;case kt.GOOD:return Zs.Good;case kt.POOR:return Zs.Poor;case kt.LOST:return Zs.Lost;default:return Zs.Unknown}}(e),t!==this._connectionQuality&&this.emit(Vr.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>eo(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Hr.Muted,()=>{this.emit(Vr.TrackMuted,e)}),e.on(Hr.Unmuted,()=>{this.emit(Vr.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ca.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ca.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class tc extends ec{constructor(e,t,n,i,r){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=At.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Ga)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t,n,i,r,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(a=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===a||a.call(r,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Ga),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==ai.OK&&r.reject(new Xr(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=os.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let r=e.value.value;this.handleIncomingRpcAck(r.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Wn({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),bo(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),bo(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),bo(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.handleSubscribedQualityUpdate=e=>yi(this,void 0,void 0,function*(){var t,n,i,r,a;if(!(null===(a=this.roomOptions)||void 0===a?void 0:a.dynacast))return;const o=this.videoTrackPublications.get(e.trackSid);if(!o)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!o.videoTrack)return;const s=yield o.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=Si(s);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;fa(e)&&(this.log.debug("publish ".concat(e," for ").concat(o.videoTrack.sid),Object.assign(Object.assign({},this.logContext),bo(o))),yield this.publishAdditionalCodecForTrack(o.videoTrack,e,o.options))}}catch(u){n={error:u}}finally{try{l||t||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>yi(this,void 0,void 0,function*(){if(e.source===ca.Source.ScreenShare||e.source===ca.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),bo(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(io(e)||no(e))try{if(Na())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===ca.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),bo(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(_){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),bo(e))),io(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(_){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),bo(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==At.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(qr.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())}),this.engine.on(qr.Connected,this.handleReconnected).on(qr.SignalConnected,this.handleSignalConnected).on(qr.SignalRestarted,this.handleReconnected).on(qr.SignalResumed,this.handleReconnected).on(qr.Restarting,this.handleReconnecting).on(qr.Resuming,this.handleReconnecting).on(qr.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(qr.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(qr.Disconnected,this.handleDisconnected).on(qr.SignalRequestResponse,this.handleSignalRequestResponse).on(qr.DataPacketReceived,this.handleDataPacket),this.signalConnectedFuture=void 0}setMetadata(e){return yi(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return yi(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return yi(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return yi(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise((e,a)=>yi(t,void 0,void 0,function*(){var t,o;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!==n&&void 0!==n?n:this.metadata)&&void 0!==t?t:"",null!==(o=null!==i&&void 0!==i?i:this.name)&&void 0!==o?o:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{a(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(c),void e();yield Sa(50)}a(new Xr("Request to update local metadata timed out","TimeoutError"))}catch(_){_ instanceof Error&&a(_)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(ca.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(ca.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(ca.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(Vr.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return yi(this,void 0,void 0,function*(){this.encryptionType=e?At.GCM:At.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,n,i){return yi(this,void 0,void 0,function*(){var r,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(e);if(t)if(o)yield o.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null===t||void 0===t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case ca.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case ca.Source.Microphone:t=yield this.createTracks({audio:null===(a=n)||void 0===a||a});break;case ca.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new Gr(e)}}catch(_){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),_ instanceof Error&&this.emit(Vr.MediaDevicesError,_,fo(e)),this.pendingPublishing.delete(e),_}for(const n of t)e===ca.Source.Microphone&&eo(n)&&(null===i||void 0===i?void 0:i.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),n.startPreConnectBuffer());try{const e=[];for(const r of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),bo(r))),e.push(this.publishTrack(r,i));const n=yield Promise.all(e);[o]=n}catch(_){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),_}finally{this.pendingPublishing.delete(e)}}else if(!(null===o||void 0===o?void 0:o.track)&&this.pendingPublishing.has(e)&&(o=yield this.waitForPendingPublicationOfSource(e),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),o&&o.track)if(e===ca.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const e=this.getTrackPublication(ca.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return yi(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(ca.Source.Camera)&&!this.pendingPublishing.has(ca.Source.Microphone)){this.pendingPublishing.add(ca.Source.Camera),this.pendingPublishing.add(ca.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(ca.Source.Camera),this.pendingPublishing.delete(ca.Source.Microphone)}}})}createTracks(e){return yi(this,void 0,void 0,function*(){var t,n;null!==e&&void 0!==e||(e={});const i=so(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{const e=yield Xs(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return e.map(e=>(eo(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=ca.Source.Microphone,this.emit(Vr.AudioStreamAcquired)),to(e)&&(this.cameraError=void 0,e.source=ca.Source.Camera),e))}catch(r){throw r instanceof Error&&(e.audio&&(this.microphoneError=r),e.video&&(this.cameraError=r)),r}})}createScreenTracks(e){return yi(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new Kr("getDisplayMedia not supported");void 0!==e.resolution||Oa()||(e.resolution=ya.h1080fps30.resolution);const t=mo(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Gr("no video track found");const r=new Ps(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=ca.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const a=[r];if(n.getAudioTracks().length>0){this.emit(Vr.AudioStreamAcquired);const e=new ms(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=ca.Source.ScreenShareAudio,a.push(e)}return a})}publishTrack(e,t){return yi(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return yi(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,a,o,s;let c,l;if(io(e)&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),Za(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case ca.Source.Microphone:t="audioinput";break;case ca.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new ms(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Ps(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Gr("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(l=t)}),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),bo(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(a=null===t||void 0===t?void 0:t.forceStereo)&&void 0!==a?a:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),bo(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(o=t.dtx)&&void 0!==o||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=ta(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&ja(t,e.osVersion)>=0)||"Safari"===e.name&&ja(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise((t,i)=>yi(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Po.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:bo(e)}));const n=setTimeout(()=>{i(new Yr("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const r=yield this.publish(e,h,u);t(r)}else try{const n=yield this.publish(e,h,u);t(n)}catch(_){i(_)}}catch(_){i(_)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(_){throw _}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Ga),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),bo(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>function(e){switch(e){case bt.CAMERA:return ca.Source.Camera;case bt.MICROPHONE:return ca.Source.Microphone;case bt.SCREEN_SHARE:return ca.Source.ScreenShare;case bt.SCREEN_SHARE_AUDIO:return ca.Source.ScreenShareAudio;default:return ca.Source.Unknown}}(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),bo(e))),!1)}publish(e,t,n){return yi(this,void 0,void 0,function*(){var i,r,a,o,s,c,l,d,u,h;if(!this.hasPermissionsToPublish(e))throw new Yr("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(t=>Za(e)&&t.source===e.source)&&e.source!==ca.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),bo(e))),t.stopMicTrackOnMute&&eo(e)&&(e.stopOnMute=!0),e.source===ca.Source.ScreenShare&&xa()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Pa())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(xa())return!1;if(Pa()){const e=ta();if((null===e||void 0===e?void 0:e.version)&&ja(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Xo),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>t.videoCodec===go(e.mime))||(t.videoCodec=go(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Hr.Muted,this.onTrackMuted),e.on(Hr.Unmuted,this.onTrackUnmuted),e.on(Hr.Ended,this.handleTrackEnded),e.on(Hr.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Hr.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Hr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=[],m=!(null===(i=t.dtx)||void 0===i||i),g=e.getSourceTrackSettings();g.autoGainControl&&f.push(Et.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&f.push(Et.TF_ECHO_CANCELLATION),g.noiseSuppression&&f.push(Et.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&f.push(Et.TF_STEREO),m&&f.push(Et.TF_NO_DTX),io(e)&&e.hasPreConnectBuffer&&f.push(Et.TF_PRECONNECT_BUFFER);const v=new bn({cid:e.mediaStreamTrack.id,name:t.name,type:ca.kindToProto(e.kind),muted:e.isMuted,source:ca.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null===t||void 0===t?void 0:t.stream,backupCodecPolicy:null===t||void 0===t?void 0:t.backupCodecPolicy,audioFeatures:f});let b;if(e.kind===ca.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(_){const i=null!==(o=null===(a=this.roomOptions.videoCaptureDefaults)||void 0===a?void 0:a.resolution)&&void 0!==o?o:va.h720.resolution;n={width:i.width,height:i.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),bo(e)),{dims:n}))}v.width=n.width,v.height=n.height,no(e)&&(Ca(p)&&(e.source===ca.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),bo(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),v.simulcastCodecs=[new vn({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Xo}),t.backupCodec&&p!==t.backupCodec.codec&&v.encryption===At.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new vn({codec:t.backupCodec.codec,cid:""})))),b=Ts(e.source===ca.Source.ScreenShare,v.width,v.height,t),v.layers=_s(v.width,v.height,b,Ca(t.videoCodec))}else e.kind===ca.Kind.Audio&&(b=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(d=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==d?d:"high",networkPriority:null!==(h=null===(u=t.audioPreset)||void 0===u?void 0:u.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new Qr("cannot publish track when not connected");const y=()=>yi(this,void 0,void 0,function*(){var n,i,r;if(!this.engine.pcManager)throw new Qr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,b),no(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===ca.Source.ScreenShare||e.constraints.height&&Ja(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),b)if(xa()&&e.kind===ca.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=b[0])||void 0===i?void 0:i.maxBitrate)?b[0].maxBitrate/1e3:0})}else e.codec&&Ca(e.codec)&&(null===(r=b[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;const S=new Promise((t,n)=>yi(this,void 0,void 0,function*(){var i;try{k=yield this.engine.addTrack(v),t(k)}catch(r){e.sender&&(null===(i=this.engine.pcManager)||void 0===i?void 0:i.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),bo(e)),{error:t}))})),n(r)}}));if(this.enabledPublishVideoCodecs.length>0){const e=yield Promise.all([S,y()]);k=e[0]}else{let n;if(k=yield S,k.codecs.forEach(e=>{void 0===n&&(n=e.mimeType)}),n&&e.kind===ca.Kind.Video){const i=go(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),bo(e)),{codec:i})),t.videoCodec=i,b=Ts(e.source===ca.Source.ScreenShare,v.width,v.height,t))}yield y()}const T=new Ys(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(T.options=t,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),no(e)?e.startMonitor(this.engine.client):io(e)&&e.startMonitor(),this.addTrackPublication(T),this.emit(Vr.LocalTrackPublished,T),io(e)&&k.audioFeatures.includes(Et.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer();if(this.on(Vr.LocalTrackSubscribed,t=>{if(t.trackSid===k.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),bo(e))),e.stopPreConnectBuffer()}}),t){const n=new Promise((n,i)=>yi(this,void 0,void 0,function*(){var r,a,o,s,c,l;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),bo(e)));const f=setTimeout(()=>{i(new Error("agent not active within 10 seconds"))},1e4),m=yield this.waitUntilActiveAgentPresent();clearTimeout(f),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),bo(e)));const v=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[m.identity],attributes:{trackId:T.trackSid,sampleRate:String(null!==(c=g.sampleRate)&&void 0!==c?c:"48000"),channels:String(null!==(l=g.channelCount)&&void 0!==l?l:"1")}});try{for(var d,u=!0,h=Si(t);!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield v.write(e)}}catch(p){a={error:p}}finally{try{u||r||!(o=h.return)||(yield o.call(h))}finally{if(a)throw a.error}}yield v.close(),n()}catch(_){i(_)}}));n.then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),bo(e)))}).catch(t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),bo(e)),{error:t}))})}}return T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return yi(this,void 0,void 0,function*(){var i;if(this.encryptionType!==At.NONE)return;let r;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(r=t)}),!r)throw new Gr("track is not published");if(!no(e))throw new Gr("track is not a video track");const a=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),o=function(e,t,n){var i,r,a,o;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&fi.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(a=s.height)&&void 0!==a?a:null===(o=e.dimensions)||void 0===o?void 0:o.height;return e.source===ca.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Ts(e.source===ca.Source.ScreenShare,c,l,n)}(e,t,a);if(!o)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),bo(e)));const s=e.addSimulcastTrack(t,o);if(!s)return;const c=new bn({cid:s.mediaStreamTrack.id,type:ca.kindToProto(e.kind),muted:e.isMuted,source:ca.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=_s(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new Qr("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>yi(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,s,a,o),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:l}))})}unpublishTrack(e,t){return yi(this,void 0,void 0,function*(){var n,i;if(Za(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),bo(e))),yield t)}const r=this.getPublicationForTrack(e),a=r?bo(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));(e=r.track).off(Hr.Muted,this.onTrackMuted),e.off(Hr.Unmuted,this.onTrackUnmuted),e.off(Hr.Ended,this.handleTrackEnded),e.off(Hr.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Hr.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Hr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t?e.stop():e.stopMonitor();let o=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<rs.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",o=!0);if(this.engine.removeTrack(s)&&(o=!0),no(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(o=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(_){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:_}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case ca.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case ca.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(Vr.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r})}unpublishTracks(e){return yi(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return yi(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((i,r)=>yi(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>yi(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),!n||t.isMuted||t.source===ca.Source.ScreenShare||t.source===ca.Source.ScreenShareAudio||!io(t)&&!no(t)||t.isUserProvided||(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),i()}catch(t){r(t)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return yi(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?Ut.RELIABLE:Ut.LOSSY,r=n.destinationIdentities,a=n.topic,o=new jt({kind:i,value:{case:"user",value:new zt({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:a})}});yield t.engine.sendDataPacket(o,i)}()})}publishDtmf(e,t){return yi(this,void 0,void 0,function*(){const n=new jt({kind:Ut.RELIABLE,value:{case:"sipDtmf",value:new Vt({code:e,digit:t})}});yield this.engine.sendDataPacket(n,Ut.RELIABLE)})}sendChatMessage(e,t){return yi(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null===t||void 0===t?void 0:t.attachments},i=new jt({value:{case:"chatMessage",value:new Wt(Object.assign(Object.assign({},n),{timestamp:ee.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,Ut.RELIABLE),this.emit(Vr.ChatMessage,n),n})}editChatMessage(e,t){return yi(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new jt({value:{case:"chatMessage",value:new Wt(Object.assign(Object.assign({},n),{timestamp:ee.parse(n.timestamp),editTimestamp:ee.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,Ut.RELIABLE),this.emit(Vr.ChatMessage,n),n})}sendText(e,t){return yi(this,void 0,void 0,function*(){var n;const i=crypto.randomUUID(),r=(new TextEncoder).encode(e).byteLength,a=null===(n=null===t||void 0===t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),o=new Array(a?a.length+1:1).fill(0),s=(e,n)=>{var i;o[n]=e;const r=o.reduce((e,t)=>e+t,0);null===(i=null===t||void 0===t?void 0:t.onProgress)||void 0===i||i.call(t,r)},c=yield this.streamText({streamId:i,totalSize:r,destinationIdentities:null===t||void 0===t?void 0:t.destinationIdentities,topic:null===t||void 0===t?void 0:t.topic,attachedStreamIds:a,attributes:null===t||void 0===t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),(null===t||void 0===t?void 0:t.attachments)&&a&&(yield Promise.all(t.attachments.map((e,n)=>yi(this,void 0,void 0,function*(){return this._sendFile(a[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))),c.info})}streamText(e){return yi(this,void 0,void 0,function*(){var t,n;const i=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),r={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null===e||void 0===e?void 0:e.topic)&&void 0!==n?n:"",size:null===e||void 0===e?void 0:e.totalSize,attributes:null===e||void 0===e?void 0:e.attributes},a=new ln({streamId:i,mimeType:r.mimeType,topic:r.topic,timestamp:Xa(r.timestamp),totalLength:Xa(null===e||void 0===e?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new sn({version:null===e||void 0===e?void 0:e.version,attachedStreamIds:null===e||void 0===e?void 0:e.attachedStreamIds,replyToStreamId:null===e||void 0===e?void 0:e.replyToStreamId,operationType:"update"===(null===e||void 0===e?void 0:e.type)?on.UPDATE:on.CREATE})}}),o=null===e||void 0===e?void 0:e.destinationIdentities,s=new jt({destinationIdentities:o,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(s,Ut.RELIABLE);let c=0;const l=this,d=new WritableStream({write(e){return yi(this,void 0,void 0,function*(){for(const t of function(e,t){const n=[];let i=(new TextEncoder).encode(e);for(;i.length>t;){let e=t;for(;e>0;){const t=i[e];if(void 0!==t&&128!==(192&t))break;e--}n.push(i.slice(0,e)),i=i.slice(e)}return i.length>0&&n.push(i),n}(e,15e3)){yield l.engine.waitForBufferStatusLow(Ut.RELIABLE);const e=new dn({content:t,streamId:i,chunkIndex:Xa(c)}),n=new jt({destinationIdentities:o,value:{case:"streamChunk",value:e}});yield l.engine.sendDataPacket(n,Ut.RELIABLE),c+=1}})},close(){return yi(this,void 0,void 0,function*(){const e=new un({streamId:i}),t=new jt({destinationIdentities:o,value:{case:"streamTrailer",value:e}});yield l.engine.sendDataPacket(t,Ut.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let u=()=>yi(this,void 0,void 0,function*(){yield h.close()});l.engine.once(qr.Closing,u);const h=new Vs(d,r,()=>this.engine.off(qr.Closing,u));return h})}sendFile(e,t){return yi(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return yi(this,void 0,void 0,function*(){var i;const r=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null===n||void 0===n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null===n||void 0===n?void 0:n.topic,destinationIdentities:null===n||void 0===n?void 0:n.destinationIdentities}),a=t.stream().getReader();for(;;){const{done:e,value:t}=yield a.read();if(e)break;yield r.write(t)}return yield r.close(),r.info})}streamBytes(e){return yi(this,void 0,void 0,function*(){var t,n,i,r,a;const o=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),s=null===e||void 0===e?void 0:e.destinationIdentities,c={id:o,mimeType:null!==(n=null===e||void 0===e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null===e||void 0===e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null===e||void 0===e?void 0:e.attributes,size:null===e||void 0===e?void 0:e.totalSize,name:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:"unknown"},l=new ln({totalLength:Xa(null!==(a=c.size)&&void 0!==a?a:0),mimeType:c.mimeType,streamId:o,topic:c.topic,timestamp:Xa(Date.now()),attributes:c.attributes,contentHeader:{case:"byteHeader",value:new cn({name:c.name})}}),d=new jt({destinationIdentities:s,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,Ut.RELIABLE);let u=0;const h=new I,p=this.engine,f=this.log,m=new WritableStream({write(e){return yi(this,void 0,void 0,function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield p.waitForBufferStatusLow(Ut.RELIABLE);const i=new jt({destinationIdentities:s,value:{case:"streamChunk",value:new dn({content:t,streamId:o,chunkIndex:Xa(u)})}});yield p.sendDataPacket(i,Ut.RELIABLE),u+=1,n+=t.byteLength}}finally{t()}})},close(){return yi(this,void 0,void 0,function*(){const e=new un({streamId:o}),t=new jt({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield p.sendDataPacket(t,Ut.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new qs(m,c)})}performRpc(e){return yi(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:a=1e4}=e;return function*(){return new Promise((e,o)=>yi(t,void 0,void 0,function*(){var t,s,c,l;if(ss(r)>15360)return void o(os.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&ja(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void o(os.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,a-2e3);const u=setTimeout(()=>{this.pendingAcks.delete(d),o(os.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)},2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout(()=>{this.pendingResponses.delete(d),o(os.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?o(n):e(null!==t&&void 0!==t?t:"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,r){return yi(this,void 0,void 0,function*(){const a=new jt({destinationIdentities:[e],kind:Ut.RELIABLE,value:{case:"rpcRequest",value:new Kt({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(a,Ut.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,os.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),bo(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}}),!0)}setActiveAgent(e){var t,n,i,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(r=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Ga),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(io(i)||no(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}waitForPendingPublicationOfSource(e){return yi(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield Sa(20)}})}}class nc extends $s{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=sa.HIGH,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Hr.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new Pn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new $t({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Hr.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?$s.SubscriptionStatus.Unsubscribed:super.isSubscribed?$s.SubscriptionStatus.Subscribed:$s.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?$s.PermissionStatus.Allowed:$s.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(oo(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&oo(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Hr.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Hr.VisibilityChanged,this.handleVisibilityChange),i.off(Hr.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Hr.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Hr.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Hr.VisibilityChanged,this.handleVisibilityChange),e.on(Hr.Ended,this.handleEnded),this.emit(Hr.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Hr.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Hr.Muted:Hr.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Hr.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Hr.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===ca.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return oo(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Rn({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?e.quality=this.currentVideoQuality:e.quality=sa.HIGH,this.emit(Hr.UpdateSettings,e)}}class ic extends ec{static fromParticipantInfo(e,t,n){return new ic(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,a,o){super(t,n||"",i,r,a,o,arguments.length>7&&void 0!==arguments[7]?arguments[7]:Nt.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Hr.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),bo(e))),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Hr.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),e.on(Hr.SubscriptionPermissionChanged,t=>{this.emit(Vr.TrackSubscriptionPermissionChanged,e,t)}),e.on(Hr.SubscriptionStatusChanged,t=>{this.emit(Vr.TrackSubscriptionStatusChanged,e,t)}),e.on(Hr.Subscribed,t=>{this.emit(Vr.TrackSubscribed,t,e)}),e.on(Hr.Unsubscribed,t=>{this.emit(Vr.TrackUnsubscribed,t,e)}),e.on(Hr.SubscriptionFailed,t=>{this.emit(Vr.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ca.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ca.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,a){let o=this.getTrackPublicationBySid(t);if(o||t.startsWith("TR")||this.trackPublications.forEach(t=>{o||e.kind!==t.kind.toString()||(o=t)}),!o)return 0===a?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(Vr.TrackSubscriptionFailed,t)):(void 0===a&&(a=20),void setTimeout(()=>{this.addSubscribedMediaTrack(e,t,n,i,r,a-1)},150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),bo(o))),void this.emit(Vr.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new Ks(e,t,i,r):new Ws(e,t,i,this.audioContext,this.audioOutput),s.source=o.source,s.isMuted=o.isMuted,s.setMediaStream(n),s.start(),o.setTrack(s),this.volumeMap.has(o.source)&&ro(s)&&eo(s)&&s.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach(e=>{var i,r;let a=this.getTrackPublicationBySid(e.sid);if(a)a.updateInfo(e);else{const t=ca.kindFromProto(e.type);if(!t)return;a=new nc(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),a.updateInfo(e),n.set(e.sid,a);const o=Array.from(this.trackPublications.values()).find(e=>e.source===(null===a||void 0===a?void 0:a.source));o&&a.source!==ca.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:bo(o),newTrack:bo(a)})),this.addTrackPublication(a)}t.set(e.sid,a)}),this.trackPublications.forEach(e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),bo(e))),this.unpublishTrack(e.trackSid,!0))}),n.forEach(e=>{this.emit(Vr.TrackPublished,e)}),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case ca.Kind.Audio:this.audioTrackPublications.delete(e);break;case ca.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(Vr.TrackUnpublished,n)}setAudioOutput(e){return yi(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var i;eo(n.track)&&ro(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}var rc;!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(rc||(rc={}));class ac extends Ci.EventEmitter{constructor(e){var t,n,i,r;if(super(),t=this,this.state=rc.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=fi,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(e,t,n)=>yi(this,void 0,void 0,function*(){var i;if("undefined"===typeof RTCPeerConnection||!Ta()&&!wa())throw Ia()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===rc.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(rc.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Aa(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new js(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const a=(i,o,s)=>yi(this,void 0,void 0,function*(){var c,l;this.abortController&&this.abortController.abort();const d=new AbortController;this.abortController=d,null===r||void 0===r||r();try{yield this.attemptConnection(null!==s&&void 0!==s?s:e,t,n,d),this.abortController=void 0,i()}catch(_){if(this.regionUrlProvider&&_ instanceof Wr&&_.reason!==Ur.Cancelled&&_.reason!==Ur.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(u){if(u instanceof Wr&&(401===u.status||u.reason===Ur.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void o(u)}t&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(_.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield a(i,o,t)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,$a(_)),o(_))}else{let t=Tt.UNKNOWN_REASON;_ instanceof Wr&&(t=$a(_)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),o(_)}}}),o=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Ga((e,t)=>{a(e,t,o)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,i,r,a)=>yi(this,void 0,void 0,function*(){var o,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},a.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(o=l.room)||void 0===o?void 0:o.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new Jr("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(_){this.log.error(_ instanceof Error?_.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:_}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>yi(this,void 0,void 0,function*(){var r,a;this.state===rc.Reconnecting||this.isResuming||(null===(r=this.engine)||void 0===r?void 0:r.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(a=this.regionUrlProvider)||void 0===a?void 0:a.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},is),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(zr.SignalConnected)}catch(o){yield this.engine.close(),this.recreateEngine();const e=new Wr("could not establish signal connection",Ur.ServerUnreachable);throw o instanceof Error&&(e.message="".concat(e.message,": ").concat(o.message)),o instanceof Wr&&(e.reason=o.reason,e.status=o.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:o})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Wr("Connection attempt aborted",Ur.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(_){throw yield this.engine.close(),this.recreateEngine(),_}Na()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Na()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(rc.Connected),this.emit(zr.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return yi(t,[...n],void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,a;const o=yield e.disconnectLock.lock();try{if(e.state===rc.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===rc.Connecting||e.state===rc.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new Wr("Client initiated disconnect",Ur.Cancelled)),e.connectFuture=void 0),(null===(a=e.engine)||void 0===a?void 0:a.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Tt.CLIENT_INITIATED),e.engine=void 0}finally{o()}}()})},this.onPageLeave=()=>yi(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>yi(this,void 0,void 0,function*(){const e=[],t=ta();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=Ka();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(n),this.once(zr.Disconnected,()=>{null===n||void 0===n||n.remove(),n=null})}e.push(n)}this.remoteParticipants.forEach(t=>{t.audioTrackPublications.forEach(t=>{t.track&&t.track.attachedElements.forEach(t=>{e.push(t)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}),this.startVideo=()=>yi(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(rc.Reconnecting)&&this.emit(zr.Reconnecting)},this.handleSignalRestarted=e=>yi(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(rc.Connected),this.emit(zr.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===_t.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach(e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}}),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=t,this.emitWhenConnected(zr.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach(e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)}),e.forEach(e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))});const n=Array.from(t.values());n.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=n,this.emitWhenConnected(zr.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach(e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=ca.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(Vr.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(zr.TrackStreamStateChanged,n,n.track.streamState,t))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case)this.handleStreamHeader(e.value.value,e.participantIdentity);else if("streamChunk"===e.value.case)this.handleStreamChunk(e.value.value);else if("streamTrailer"===e.value.case)this.handleStreamTrailer(e.value.value);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(zr.DataReceived,t.payload,e,n,t.topic),null===e||void 0===e||e.emit(Vr.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(zr.SipDTMFReceived,t,e),null===e||void 0===e||e.emit(Vr.SipDTMFReceived,t)},this.bufferedSegments=new Map,this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null===n||void 0===n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map(e=>{let{id:n,text:i,language:r,startTime:a,endTime:o,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(o.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}})}(t,this.transcriptionReceivedTimes);null===i||void 0===i||i.emit(Hr.TranscriptionReceived,r),null===n||void 0===n||n.emit(Vr.TranscriptionReceived,r,i),this.emit(zr.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(zr.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(zr.MetricsReceived,e,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(zr.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(zr.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(zr.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(zr.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>yi(this,void 0,void 0,function*(){var e;"iOS"!==(null===(e=ta())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(zr.MediaDevicesChanged)}),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(zr.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(zr.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=e=>{this.emit(zr.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(zr.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(zr.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(zr.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(zr.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null===e||void 0===e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>yi(this,void 0,void 0,function*(){var t,n,i,r,a,o;if(null===(t=e.track)||void 0===t||t.on(Hr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Hr.Restarted,this.onLocalTrackRestarted),null===(a=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===a||a.call(r,this),this.emit(zr.LocalTrackPublished,e,this.localParticipant),io(e.track)){(yield e.track.checkForSilence())&&this.emit(zr.LocalAudioSilenceDetected,e)}const s=yield null===(o=e.track)||void 0===o?void 0:o.getDeviceId(!1),c=fo(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(zr.ActiveDeviceChanged,c,s))}),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Hr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Hr.Restarted,this.onLocalTrackRestarted),this.emit(zr.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>yi(this,void 0,void 0,function*(){const t=yield e.getDeviceId(!1),n=fo(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(zr.ActiveDeviceChanged,n,t))}),this.onLocalConnectionQualityChanged=e=>{this.emit(zr.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(zr.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(zr.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(zr.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},ns),e),this.log=mi(null!==(n=this.options.loggerName)&&void 0!==n?n:hi.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},es),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},ts),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Zo),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new I,this.localParticipant=new tc("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ja(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ja(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",Ja(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Na()){const e=new AbortController;null===(r=navigator.mediaDevices)||void 0===r||r.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),ac.cleanupRegistry&&ac.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,n,i,r,a){return yi(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==a)return void(yield this.engine.publishRpcResponse(e,t,null,os.builtIn("UNSUPPORTED_VERSION")));const o=this.rpcHandlers.get(n);if(!o)return void(yield this.engine.publishRpcResponse(e,t,null,os.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const a=yield o({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});ss(a)>15360?(s=os.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=a}catch(l){l instanceof os?s=l:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),l),s=os.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)})}setE2EEEnabled(e){return yi(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new ko(this.options.e2ee),this.e2eeManager.on(Ar.ParticipantEncryptionStatusChanged,(e,t)=>{t.isLocal&&(this.isE2EEEnabled=e),this.emit(zr.ParticipantEncryptionStatusChanged,e,t)}),this.e2eeManager.on(Ar.EncryptionError,e=>this.emit(zr.EncryptionError,e)),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return yi(this,void 0,void 0,function*(){return this.state===rc.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(qr.RoomUpdate,n),e(t.sid))};this.engine.on(qr.RoomUpdate,n),this.once(zr.Disconnected,()=>{this.engine.off(qr.RoomUpdate,n),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Ms(this.options),this.engine.on(qr.ParticipantUpdate,this.handleParticipantUpdates).on(qr.RoomUpdate,this.handleRoomUpdate).on(qr.SpeakersChanged,this.handleSpeakersChanged).on(qr.StreamStateChanged,this.handleStreamStateUpdate).on(qr.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(qr.SubscriptionError,this.handleSubscriptionError).on(qr.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(qr.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(qr.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(qr.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(qr.DataPacketReceived,this.handleDataPacket).on(qr.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(rc.SignalReconnecting)&&this.emit(zr.SignalReconnecting)}).on(qr.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(rc.Connected)&&this.emit(zr.Reconnected)}).on(qr.SignalResumed,()=>{this.bufferedEvents=[],(this.state===rc.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(qr.Restarting,this.handleRestarting).on(qr.SignalRestarted,this.handleSignalRestarted).on(qr.Offline,()=>{this.setAndEmitConnectionState(rc.Reconnecting)&&this.emit(zr.Reconnecting)}).on(qr.DCBufferStatusChanged,(e,t)=>{this.emit(zr.DCBufferStatusChanged,e,t)}).on(qr.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(t=>{let{trackSid:n}=t;return n===e});t?(this.localParticipant.emit(Vr.LocalTrackSubscribed,t),this.emitWhenConnected(zr.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(qr.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(zr.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return To.getInstance().getDevices(e,t)}prepareConnection(e,t){return yi(this,void 0,void 0,function*(){if(this.state===rc.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Aa(new URL(e))&&t){this.regionUrlProvider=new js(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===rc.Disconnected&&(this.regionUrl=n,yield fetch(Qa(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(Qa(e),{method:"HEAD"})}catch(_){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:_}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return yi(this,void 0,void 0,function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Xn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Xn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Xn({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Xn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>yi(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Xn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>yi(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Xn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Xn({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>yi(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new Nn({reason:Tt.CLIENT_INITIATED,action:In.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new Xn({scenario:{case:"subscriberBandwidth",value:Xa(t)}});break;case"leave-full-reconnect":n=new Xn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return yi(this,arguments,void 0,function(e,t){var n=this;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var r,a,o,s,c,l,d;let u=!0,h=!1;const p=i?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter(e=>e.source===ca.Source.Microphone);try{u=(yield Promise.all(i.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(_){throw n.options.audioCaptureDefaults.deviceId=t,_}const a=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});u&&a&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(a=n.getActiveDevice(e))&&void 0!==a?a:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter(e=>e.source===ca.Source.Camera);try{u=(yield Promise.all(i.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(_){throw n.options.videoCaptureDefaults.deviceId=t,_}}else if("audiooutput"===e){if(h=!0,!Ea()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");n.options.webAudioMix&&(t=null!==(o=yield To.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==o?o:""),null!==(s=(d=n.options).audioOutput)&&void 0!==s||(d.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:t})))}catch(_){throw n.options.audioOutput.deviceId=i,_}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(zr.ActiveDeviceChanged,e,t)),u}()})}setupLocalParticipantEvents(){this.localParticipant.on(Vr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Vr.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Vr.AttributesChanged,this.onLocalAttributesChanged).on(Vr.TrackMuted,this.onLocalTrackMuted).on(Vr.TrackUnmuted,this.onLocalTrackUnmuted).on(Vr.LocalTrackPublished,this.onLocalTrackPublished).on(Vr.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Vr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Vr.MediaDevicesError,this.onMediaDevicesError).on(Vr.AudioStreamAcquired,this.startAudio).on(Vr.ChatMessage,this.onLocalChatMessageSent).on(Vr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===rc.Connecting||this.state===rc.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(zr.Reconnected,i),this.off(zr.Connected,i),this.off(zr.Disconnected,r)};return this.once(zr.Reconnected,i),this.once(zr.Connected,i),void this.once(zr.Disconnected,r)}if(this.state===rc.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let a=i[1],o=e.id;if(a&&a.startsWith("TR")&&(o=a),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find(e=>e.sid===r);if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,o,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==rc.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(t=>{var n,i,r;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop()):null===(r=t.track)||void 0===r||r.stopMonitor()}),this.localParticipant.off(Vr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Vr.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Vr.AttributesChanged,this.onLocalAttributesChanged).off(Vr.TrackMuted,this.onLocalTrackMuted).off(Vr.TrackUnmuted,this.onLocalTrackUnmuted).off(Vr.LocalTrackPublished,this.onLocalTrackPublished).off(Vr.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Vr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Vr.MediaDevicesError,this.onMediaDevicesError).off(Vr.AudioStreamAcquired,this.startAudio).off(Vr.ChatMessage,this.onLocalChatMessageSent).off(Vr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Na()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(rc.Disconnected),this.emit(zr.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach(e=>{t.unpublishTrack(e.trackSid,!0)}),this.emit(zr.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleStreamHeader(e,t){return yi(this,void 0,void 0,function*(){var n;if("byteHeader"===e.contentHeader.case){const i=this.byteStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const a={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ya(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:t=>{r=t,this.byteStreamControllers.set(e.streamId,{info:a,controller:r,startTime:Date.now()})}});i(new Fs(a,o,Ya(e.totalLength)),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let i;const r={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:t=>{i=t,this.textStreamControllers.set(e.streamId,{info:r,controller:i,startTime:Date.now()})}});n(new Bs(r,a,Ya(e.totalLength)),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return yi(this,void 0,void 0,function*(){var e,t,n;const i=To.getInstance().previousDevices,r=yield To.getInstance().getDevices(void 0,!1),a=ta();if("Chrome"===(null===a||void 0===a?void 0:a.name)&&"iOS"!==a.os)for(let s of r){const e=i.find(e=>e.deviceId===s.deviceId);e&&""!==e.label&&e.kind===s.kind&&e.label!==s.label&&"default"===this.getActiveDevice(s.kind)&&this.emit(zr.ActiveDeviceChanged,s.kind,s.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let s of o){const a=po(s),o=this.localParticipant.getTrackPublication(a);if(o&&(null===(e=o.track)||void 0===e?void 0:e.isUserProvided))continue;const c=r.filter(e=>e.kind===s),l=this.getActiveDevice(s);l===(null===(t=i.filter(e=>e.kind===s)[0])||void 0===t?void 0:t.deviceId)&&c.length>0&&(null===(n=c[0])||void 0===n?void 0:n.deviceId)!==l?yield this.switchActiveDevice(s,c[0].deviceId):"audioinput"===s&&!Ra()||"videoinput"===s||!(c.length>0)||c.find(e=>e.deviceId===this.getActiveDevice(s))||"audiooutput"===s&&Ra()||(yield this.switchActiveDevice(s,c[0].deviceId))}})}acquireAudioContext(){return yi(this,void 0,void 0,function*(){var e,t;if("boolean"!==typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=ho())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),Sa(200)])}catch(_){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:_}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(zr.AudioPlaybackStatusChanged,n))})}createParticipant(e,t){var n;let i;return i=t?ic.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new ic(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(zr.ParticipantConnected,n),n.on(Vr.TrackPublished,e=>{this.emitWhenConnected(zr.TrackPublished,e,n)}).on(Vr.TrackSubscribed,(e,t)=>{e.kind===ca.Kind.Audio?(e.on(Hr.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Hr.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===ca.Kind.Video&&(e.on(Hr.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Hr.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(zr.TrackSubscribed,e,t,n)}).on(Vr.TrackUnpublished,e=>{this.emit(zr.TrackUnpublished,e,n)}).on(Vr.TrackUnsubscribed,(e,t)=>{this.emit(zr.TrackUnsubscribed,e,t,n)}).on(Vr.TrackMuted,e=>{this.emitWhenConnected(zr.TrackMuted,e,n)}).on(Vr.TrackUnmuted,e=>{this.emitWhenConnected(zr.TrackUnmuted,e,n)}).on(Vr.ParticipantMetadataChanged,e=>{this.emitWhenConnected(zr.ParticipantMetadataChanged,e,n)}).on(Vr.ParticipantNameChanged,e=>{this.emitWhenConnected(zr.ParticipantNameChanged,e,n)}).on(Vr.AttributesChanged,e=>{this.emitWhenConnected(zr.ParticipantAttributesChanged,e,n)}).on(Vr.ConnectionQualityChanged,e=>{this.emitWhenConnected(zr.ConnectionQualityChanged,e,n)}).on(Vr.ParticipantPermissionsChanged,e=>{this.emitWhenConnected(zr.ParticipantPermissionsChanged,e,n)}).on(Vr.TrackSubscriptionStatusChanged,(e,t)=>{this.emitWhenConnected(zr.TrackSubscriptionStatusChanged,e,t,n)}).on(Vr.TrackSubscriptionFailed,(e,t)=>{this.emit(zr.TrackSubscriptionFailed,e,n,t)}).on(Vr.TrackSubscriptionPermissionChanged,(e,t)=>{this.emitWhenConnected(zr.TrackSubscriptionPermissionChanged,e,t,n)}).on(Vr.Active,()=>{this.emitWhenConnected(zr.ParticipantActive,n),n.kind===Nt.AGENT&&this.localParticipant.setActiveAgent(n)}),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&ao(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=aa.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Tt.STATE_MISMATCH)))},4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&aa.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(zr.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===rc.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===rc.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return yi(this,void 0,void 0,function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new xt({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ee.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ot({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(zr.SignalConnected),this.emit(zr.Connected),this.setAndEmitConnectionState(rc.Connected),i.video){const e=new Ys(ca.Kind.Video,new Mt({source:bt.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:vt.AUDIO,name:"video-dummy"}),new Ps(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Wa(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Vr.LocalTrackPublished,e)}if(i.audio){const e=new Ys(ca.Kind.Audio,new Mt({source:bt.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:vt.AUDIO}),new ms(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Ka(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Vr.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new Ot({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:_t.ACTIVE,tracks:[],joinedAt:ee.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const a=Wa(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),o=new Mt({source:bt.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:vt.AUDIO});i.addSubscribedMediaTrack(a,o.sid,new MediaStream([a]),new RTCRtpReceiver),t.tracks=[...t.tracks,o]}if(r.audio){const e=Ka(),n=new Mt({source:bt.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:vt.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==zr.ActiveSpeakersChanged&&e!==zr.TranscriptionReceived){const t=oc(n).filter(e=>void 0!==e);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function oc(e){return e.map(e=>{if(e)return Array.isArray(e)?oc(e):"object"===typeof e?"logContext"in e?e.logContext:void 0:e})}ac.cleanupRegistry="undefined"!==typeof FinalizationRegistry&&new FinalizationRegistry(e=>{e()});var sc;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(sc||(sc={}));Ci.EventEmitter;Ci.EventEmitter;new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);class cc{constructor(){this.room=null,this.eventHandlers=[]}async startOutboundCall(e){try{this.room=new ac({adaptiveStream:!0,dynacast:!0}),this.setupEventListeners(),await this.room.connect(e.livekitUrl,e.token),console.log("Connected to telephony room:",e.roomName),e.phoneNumber&&this.emit({type:"call_started",data:{phoneNumber:e.phoneNumber}})}catch(t){throw console.error("Failed to start outbound call:",t),this.emit({type:"error",data:t}),t}}async handleIncomingCall(e){try{this.room=new ac({adaptiveStream:!0,dynacast:!0}),this.setupEventListeners(),await this.room.connect(e.livekitUrl,e.token),console.log("Ready to receive incoming calls on room:",e.roomName),this.emit({type:"call_started",data:{incoming:!0}})}catch(t){throw console.error("Failed to setup incoming call handler:",t),this.emit({type:"error",data:t}),t}}async endCall(){this.room&&(await this.room.disconnect(),this.room=null,this.emit({type:"call_ended"}),console.log("Call ended"))}async setMicrophoneEnabled(e){if(!this.room)throw new Error("Not connected to room");await this.room.localParticipant.setMicrophoneEnabled(e)}getConnectionState(){var e;return(null===(e=this.room)||void 0===e?void 0:e.state)||rc.Disconnected}isInCall(){var e;return(null===(e=this.room)||void 0===e?void 0:e.state)===rc.Connected}onEvent(e){this.eventHandlers.push(e)}removeEvent(e){const t=this.eventHandlers.indexOf(e);t>-1&&this.eventHandlers.splice(t,1)}setupEventListeners(){this.room&&(this.room.on(zr.ParticipantConnected,e=>{console.log("Participant connected to call:",e.identity),this.emit({type:"participant_connected",data:{participant:e}}),e.audioTrackPublications.forEach(e=>{if(e.track){e.track.attach().play().catch(e=>console.error("Failed to play audio:",e))}})}),this.room.on(zr.ParticipantDisconnected,e=>{console.log("Participant disconnected from call:",e.identity),this.emit({type:"participant_disconnected",data:{participant:e}})}),this.room.on("disconnected",()=>{console.log("Disconnected from telephony room"),this.emit({type:"call_ended"})}))}emit(e){this.eventHandlers.forEach(t=>{try{t(e)}catch(n){console.error("Error in event handler:",n)}})}}function lc(e){const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&"1"===t[0]?"+1 (".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):e}function dc(e){const t=e.replace(/\D/g,"");return 10===t.length||11===t.length&&"1"===t[0]}const uc=e=>{var t;let{session:n,agent:i,currentCall:a,onStartCall:o,onEndCall:s,onCallStatusUpdate:c}=e;const l=(0,r.useRef)(null),[u]=(0,r.useState)(()=>new cc),[h,p]=(0,r.useState)(""),[f,m]=(0,r.useState)(!0),[v,k]=(0,r.useState)(!1),[w,O]=(0,r.useState)(0),[_,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[null===n||void 0===n?void 0:n.messages]),(0,r.useEffect)(()=>{let e;return a&&"connected"===a.status&&(e=setInterval(()=>{const e=Math.floor(((new Date).getTime()-a.startTime.getTime())/1e3);O(e)},1e3)),()=>{e&&clearInterval(e)}},[a]),(0,r.useEffect)(()=>{const e=e=>{if(a)switch(e.type){case"call_started":c(d(d({},a),{},{status:"connected"}));break;case"call_ended":c(d(d({},a),{},{status:"ended",endTime:new Date}));break;case"participant_connected":console.log("Caller connected to the call");break;case"error":c(d(d({},a),{},{status:"failed",endTime:new Date}))}};return u.onEvent(e),()=>{u.removeEvent(e)}},[a,c,u]);const I=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};if(!n||!i)return(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center h-full bg-dark-50 text-center p-8",children:[(0,T.jsx)(b,{size:64,className:"text-dark-400 mb-6"}),(0,T.jsx)("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Select an Agent"}),(0,T.jsx)("p",{className:"text-dark-500 mb-6 max-w-md",children:"Choose an AI agent from the left panel to view call history and start managing phone conversations."}),(0,T.jsxs)("div",{className:"flex items-center gap-4 text-sm text-dark-400",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-3 h-3 bg-primary-600 rounded-full"}),(0,T.jsx)("span",{children:"Agent (You)"})]}),(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),(0,T.jsx)("span",{children:"Caller"})]})]})]});return(0,T.jsxs)("div",{className:"flex flex-col h-full bg-dark-50",children:[(0,T.jsxs)("div",{className:"border-b border-dark-200 bg-dark-100",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,T.jsxs)("div",{className:"flex items-center gap-3",children:[(0,T.jsx)("div",{className:"w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center",children:(0,T.jsx)(g,{size:20,className:"text-white"})}),(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{className:"font-semibold text-white",children:i.name}),(0,T.jsx)("div",{className:"flex items-center gap-2 text-sm text-dark-500",children:a?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:S("flex items-center gap-1",(e=>{switch(e){case"connecting":return"text-yellow-400";case"connected":return"text-green-400";case"ended":default:return"text-gray-400";case"failed":return"text-red-400"}})(a.status)),children:["connected"===a.status?(0,T.jsx)(E,{size:12,className:"animate-pulse"}):"connecting"===a.status?(0,T.jsx)(b,{size:12,className:"animate-pulse"}):(0,T.jsx)(y,{size:12}),(0,T.jsx)("span",{className:"capitalize",children:a.status})]}),"connected"===a.status&&(0,T.jsxs)("span",{className:"text-dark-400",children:["\u2022 ",I(w)]})]}):(0,T.jsxs)(T.Fragment,{children:[(()=>{switch(n.status){case"active":return(0,T.jsx)(E,{size:16,className:"text-green-500 animate-pulse"});case"paused":return(0,T.jsx)(b,{size:16,className:"text-yellow-500"});case"ended":return(0,T.jsx)(b,{size:16,className:"text-red-500"});default:return(0,T.jsx)(b,{size:16,className:"text-dark-400"})}})(),(0,T.jsx)("span",{children:(()=>{switch(n.status){case"active":return"Call in Progress";case"paused":return"Call Paused";case"ended":return"Call Ended";default:return"Unknown Status"}})()})]})})]})]}),(0,T.jsxs)("div",{className:"flex items-center gap-3",children:[i.autoReceiveCalls&&(0,T.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-400 bg-green-400/10 px-2 py-1 rounded",children:[(0,T.jsx)(x,{size:12}),(0,T.jsx)("span",{children:"Auto-receive"})]}),(null===a||void 0===a||null===(t=a.callerInfo)||void 0===t?void 0:t.phone)&&(0,T.jsxs)("div",{className:"text-right",children:[(0,T.jsx)("div",{className:"text-sm font-medium text-white",children:lc(a.callerInfo.phone)}),a.callerInfo.name&&(0,T.jsx)("div",{className:"text-xs text-dark-500",children:a.callerInfo.name})]}),(null===n||void 0===n?void 0:n.callerInfo)&&!a&&(0,T.jsxs)("div",{className:"text-right",children:[(0,T.jsx)("div",{className:"text-sm font-medium text-white",children:n.callerInfo.name||"Unknown Caller"}),n.callerInfo.phone&&(0,T.jsx)("div",{className:"text-xs text-dark-500",children:n.callerInfo.phone})]})]})]}),a&&(0,T.jsxs)("div",{className:"px-4 pb-3 flex items-center justify-center gap-4",children:[(0,T.jsx)("button",{onClick:async()=>{try{await u.setMicrophoneEnabled(!f),m(!f)}catch(e){console.error("Failed to toggle microphone:",e)}},className:S("p-2 rounded-full transition-colors",f?"bg-dark-300 hover:bg-dark-200 text-white":"bg-red-600 hover:bg-red-500 text-white"),disabled:"connected"!==a.status,title:f?"Mute microphone":"Unmute microphone",children:f?(0,T.jsx)(P,{className:"w-4 h-4"}):(0,T.jsx)(R,{className:"w-4 h-4"})}),(0,T.jsx)("button",{onClick:async()=>{try{await u.endCall(),s(),O(0)}catch(e){console.error("Failed to end call:",e)}},className:"p-2 rounded-full bg-red-600 hover:bg-red-500 text-white transition-colors",title:"End call",children:(0,T.jsx)(y,{className:"w-4 h-4"})})]})]}),(0,T.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-4",children:0===n.messages.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,T.jsx)(E,{size:48,className:"text-dark-400 mb-4"}),(0,T.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No Messages Yet"}),(0,T.jsx)("p",{className:"text-dark-500",children:"This conversation will appear here once the call starts."})]}):(0,T.jsxs)(T.Fragment,{children:[n.messages.map(e=>{const t="agent"===e.sender;return(0,T.jsxs)("div",{className:S("flex gap-3 mb-4",t?"justify-start":"justify-end"),children:[t&&(0,T.jsxs)("div",{className:"flex flex-col items-center",children:[(0,T.jsx)("div",{className:"w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center",children:(0,T.jsx)(g,{size:16,className:"text-white"})}),(0,T.jsx)("span",{className:"text-xs text-dark-500 mt-1",children:"Agent"})]}),(0,T.jsxs)("div",{className:S("max-w-[70%] rounded-lg p-3",t?"bg-dark-200 text-white":"bg-primary-600 text-white ml-auto"),children:[(0,T.jsx)("div",{className:"text-sm",children:e.content}),(0,T.jsx)("div",{className:S("text-xs mt-1",t?"text-dark-400":"text-primary-100"),children:(n=e.timestamp,n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))})]}),!t&&(0,T.jsxs)("div",{className:"flex flex-col items-center",children:[(0,T.jsx)("div",{className:"w-8 h-8 bg-green-600 rounded-full flex items-center justify-center",children:(0,T.jsx)(C,{size:16,className:"text-white"})}),(0,T.jsx)("span",{className:"text-xs text-dark-500 mt-1",children:"Caller"})]})]},e.id);var n}),(0,T.jsx)("div",{ref:l})]})}),(0,T.jsx)("div",{className:"p-4 border-t border-dark-200 bg-dark-100",children:a?(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsxs)("div",{className:"text-sm text-dark-500",children:["Call duration: ",I(w)]}),"connected"===a.status&&(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,T.jsx)("span",{className:"text-sm text-red-500 font-medium",children:"LIVE CALL"})]})]}):_?(0,T.jsxs)("div",{className:"space-y-3",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("input",{type:"tel",value:h,onChange:e=>p(e.target.value),placeholder:"(555) 123-4567",className:"flex-1 px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white placeholder-dark-400 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 text-sm",autoFocus:!0}),(0,T.jsxs)("button",{onClick:async()=>{if(!i||!h.trim())return;const e=h.trim();if(dc(e)){k(!0);try{const t="outbound-".concat(i.id,"-").concat(Date.now()),n="wss://test-9m0bd0iw.livekit.cloud";if(!n)throw new Error("LiveKit URL not configured");const r=await async function(e,t,n){try{const i="http://localhost:3002",r=await fetch("".concat(i,"/api/livekit-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomName:e,participantName:t,phoneNumber:n})});if(!r.ok)throw new Error("Token generation failed: ".concat(r.statusText));return(await r.json()).token}catch(i){throw console.error("Failed to generate telephony token:",i),i}}(t,"agent-".concat(i.id),e);await u.startOutboundCall({livekitUrl:n,token:r,roomName:t,phoneNumber:e}),o(i.id,e),N(!1)}catch(t){console.error("Failed to start outbound call:",t),alert("Failed to start call. Please check your configuration.")}finally{k(!1)}}else alert("Please enter a valid phone number")},disabled:v||!h.trim()||!dc(h),className:"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-500 disabled:bg-dark-300 disabled:text-dark-500 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-sm",children:[(0,T.jsx)(E,{className:"w-4 h-4"}),(0,T.jsx)("span",{children:v?"Calling...":"Call"})]}),(0,T.jsx)("button",{onClick:()=>{N(!1),p("")},className:"px-3 py-2 bg-dark-300 hover:bg-dark-200 text-white rounded-lg transition-colors text-sm",children:"Cancel"})]}),h&&!dc(h)&&(0,T.jsx)("p",{className:"text-xs text-red-400",children:"Please enter a valid phone number"})]}):(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[n?(0,T.jsxs)("div",{className:"text-sm text-dark-500",children:["Call duration: ",n.endTime?"".concat(Math.round((n.endTime.getTime()-n.startTime.getTime())/1e3/60)," min"):"".concat(Math.round((Date.now()-n.startTime.getTime())/1e3/60)," min")]}):(0,T.jsx)("div",{className:"text-sm text-dark-500",children:"Ready to make calls"}),(0,T.jsxs)("button",{onClick:()=>N(!0),disabled:!i||"offline"===i.status||"busy"===i.status,className:"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-500 disabled:bg-dark-300 disabled:text-dark-500 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-sm",children:[(0,T.jsx)(E,{className:"w-4 h-4"}),(0,T.jsx)("span",{children:"Make Call"})]})]})})]})},hc=e=>{let{agent:t,session:n,currentCall:i,onStartCall:r,onEndCall:a,onCallStatusUpdate:o}=e;return(0,T.jsx)("div",{className:"flex flex-col h-full bg-dark-50",children:(0,T.jsx)(uc,{session:n,agent:t,currentCall:i,onStartCall:r,onEndCall:a,onCallStatusUpdate:o})})},pc=p("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),fc=p("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),mc=p("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),gc=p("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),vc=p("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),bc=p("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),yc=p("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),kc=p("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Sc=p("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Tc=e=>{let{context:t,files:n,isContextUpdating:i,onContextUpdate:a,onFileUpload:o,onFileDelete:s,onFileDownload:c}=e;const[l,d]=(0,r.useState)(t),[u,h]=(0,r.useState)(!1),p=e=>{e.target.files&&o(e.target.files)},m=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return(0,T.jsxs)("div",{className:"flex flex-col h-full bg-dark-100 border-l border-dark-200",children:[(0,T.jsxs)("div",{className:"p-4 border-b border-dark-200",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Context"}),(0,T.jsx)("button",{onClick:()=>h(!u),className:"p-1.5 text-dark-400 hover:text-white transition-colors",title:"Edit context",children:(0,T.jsx)(bc,{size:16})})]}),(0,T.jsx)("div",{className:"space-y-3",children:u?(0,T.jsxs)("div",{className:"space-y-3",children:[(0,T.jsx)("textarea",{value:l,onChange:e=>d(e.target.value),placeholder:"Enter context information for the AI agent...",className:"w-full h-32 p-3 bg-dark-200 border border-dark-300 rounded-lg text-white placeholder-dark-500 resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("button",{onClick:()=>{a(l),h(!1)},disabled:i,className:S("flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",i?"bg-dark-300 text-dark-500 cursor-not-allowed":"bg-primary-600 hover:bg-primary-700 text-white"),children:[(0,T.jsx)(yc,{size:14}),i?"Updating...":"Update"]}),(0,T.jsx)("button",{onClick:()=>{d(t),h(!1)},className:"px-3 py-1.5 bg-dark-300 hover:bg-dark-400 text-white rounded-lg text-sm font-medium transition-colors",children:"Cancel"})]})]}):(0,T.jsx)("div",{className:"min-h-[8rem] p-3 bg-dark-200 border border-dark-300 rounded-lg text-dark-300 text-sm cursor-pointer hover:bg-dark-200/70 transition-colors",onClick:()=>h(!0),children:t||(0,T.jsx)("span",{className:"text-dark-500 italic",children:"Click to add context information..."})})})]}),(0,T.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,T.jsxs)("div",{className:"p-4 border-b border-dark-200",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Files"}),(0,T.jsxs)("label",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg cursor-pointer transition-colors text-sm font-medium",children:[(0,T.jsx)(kc,{size:14}),"Upload",(0,T.jsx)("input",{type:"file",multiple:!0,onChange:p,className:"hidden"})]})]}),(0,T.jsxs)("p",{className:"text-sm text-dark-500",children:[n.length," file",1!==n.length?"s":""," uploaded"]})]}),(0,T.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin",children:0===n.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[(0,T.jsx)(kc,{size:48,className:"text-dark-400 mb-4"}),(0,T.jsx)("h4",{className:"text-lg font-medium text-white mb-2",children:"No Files"}),(0,T.jsx)("p",{className:"text-dark-500 mb-4 text-sm",children:"Upload files to provide additional context to your AI agents."}),(0,T.jsxs)("label",{className:"flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg cursor-pointer transition-colors",children:[(0,T.jsx)(kc,{size:16}),"Upload Files",(0,T.jsx)("input",{type:"file",multiple:!0,onChange:p,className:"hidden"})]})]}):(0,T.jsx)("div",{className:"p-2",children:n.map(e=>{return(0,T.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-dark-200/50 hover:bg-dark-200 rounded-lg mb-2 transition-colors",children:[(0,T.jsx)("div",{className:"flex-shrink-0",children:(t=e.type,t.startsWith("image/")?(0,T.jsx)(pc,{size:16,className:"text-blue-500"}):t.startsWith("video/")?(0,T.jsx)(fc,{size:16,className:"text-purple-500"}):t.startsWith("audio/")?(0,T.jsx)(mc,{size:16,className:"text-green-500"}):t.includes("text")||t.includes("json")?(0,T.jsx)(gc,{size:16,className:"text-yellow-500"}):(0,T.jsx)(vc,{size:16,className:"text-dark-400"}))}),(0,T.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,T.jsx)("div",{className:"font-medium text-white truncate text-sm",children:e.name}),(0,T.jsxs)("div",{className:"flex items-center gap-2 text-xs text-dark-500",children:[(0,T.jsx)("span",{children:m(e.size)}),(0,T.jsx)("span",{children:"\u2022"}),(0,T.jsx)("span",{children:e.uploadDate.toLocaleDateString()})]})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1",children:[(0,T.jsx)("button",{onClick:()=>c(e),className:"p-1.5 text-dark-400 hover:text-white transition-colors",title:"Download file",children:(0,T.jsx)(Sc,{size:14})}),(0,T.jsx)("button",{onClick:()=>s(e.id),className:"p-1.5 text-dark-400 hover:text-red-400 transition-colors",title:"Delete file",children:(0,T.jsx)(f,{size:14})})]})]},e.id);var t})})})]})]})},wc=p("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Cc=e=>{let{isOpen:t,onClose:n,onCreateAgent:i,isCreating:a}=e;const[o,s]=(0,r.useState)({name:"",persona:"You are a helpful AI phone assistant. You can make and receive phone calls professionally and courteously. Always be polite, clear, and efficient in your communication.",human:"The user is someone who needs assistance with phone calls. They may need help making appointments, handling customer service, or managing business communications."}),[c,l]=(0,r.useState)({enabled:!0,agentType:"voice_convo_agent",enableSleeptime:!0,maxMessageBufferLength:20,minMessageBufferLength:5}),[u,h]=(0,r.useState)({}),p=(e,t)=>{s(n=>d(d({},n),{},{[e]:t})),u[e]&&h(t=>d(d({},t),{},{[e]:""}))};return t?(0,T.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,T.jsxs)("div",{className:"bg-dark-100 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-dark-200",children:[(0,T.jsxs)("div",{className:"flex items-center gap-3",children:[(0,T.jsx)("div",{className:"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center",children:(0,T.jsx)(g,{size:20,className:"text-white"})}),(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Create New Agent"}),(0,T.jsx)("p",{className:"text-sm text-dark-500",children:"Configure your AI phone assistant"})]})]}),(0,T.jsx)("button",{onClick:n,className:"p-2 hover:bg-dark-200 rounded-lg transition-colors",disabled:a,children:(0,T.jsx)(wc,{size:20,className:"text-dark-400"})})]}),(0,T.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t={};if(o.name.trim()||(t.name="Agent name is required"),o.persona.trim()||(t.persona="Persona is required"),o.human.trim()||(t.human="Human description is required"),h(t),0===Object.keys(t).length)try{await i(d(d({},o),{},{voiceSettings:c})),s({name:"",persona:"You are a helpful AI phone assistant. You can make and receive phone calls professionally and courteously. Always be polite, clear, and efficient in your communication.",human:"The user is someone who needs assistance with phone calls. They may need help making appointments, handling customer service, or managing business communications."}),l({enabled:!0,agentType:"voice_convo_agent",enableSleeptime:!0,maxMessageBufferLength:20,minMessageBufferLength:5}),h({})}catch(n){console.error("Error creating agent:",n);const e=n instanceof Error?n.message:"Unknown error occurred";alert("Failed to create agent: ".concat(e))}},className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-white mb-2",children:[(0,T.jsx)(C,{size:16}),"Agent Name"]}),(0,T.jsx)("input",{type:"text",value:o.name,onChange:e=>p("name",e.target.value),placeholder:"e.g., Customer Support Agent",className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:a}),u.name&&(0,T.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u.name})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-white mb-2",children:[(0,T.jsx)(g,{size:16}),"Agent Persona"]}),(0,T.jsx)("textarea",{value:o.persona,onChange:e=>p("persona",e.target.value),placeholder:"Describe how the agent should behave and respond...",rows:4,className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",disabled:a}),u.persona&&(0,T.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u.persona}),(0,T.jsx)("p",{className:"text-xs text-dark-500 mt-1",children:"Define the agent's personality, tone, and behavior during phone calls"})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-white mb-2",children:[(0,T.jsx)(gc,{size:16}),"Human Context"]}),(0,T.jsx)("textarea",{value:o.human,onChange:e=>p("human",e.target.value),placeholder:"Describe the typical caller or user context...",rows:3,className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",disabled:a}),u.human&&(0,T.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u.human}),(0,T.jsx)("p",{className:"text-xs text-dark-500 mt-1",children:"Describe who will be calling and what they typically need help with"})]}),(0,T.jsxs)("div",{className:"border border-dark-300 rounded-lg p-4",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,T.jsx)(P,{size:16,className:"text-primary-500"}),(0,T.jsx)("h3",{className:"text-sm font-medium text-white",children:"Voice Settings"})]}),(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-sm text-white font-medium",children:"Enable Voice"}),(0,T.jsx)("p",{className:"text-xs text-dark-500",children:"Enable voice conversation capabilities"})]}),(0,T.jsx)("button",{type:"button",onClick:()=>l(e=>d(d({},e),{},{enabled:!e.enabled})),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-dark-100 ".concat(c.enabled?"bg-primary-600":"bg-dark-300"),disabled:a,children:(0,T.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(c.enabled?"translate-x-6":"translate-x-1")})})]}),c.enabled&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-sm text-white font-medium mb-2 block",children:"Agent Type"}),(0,T.jsxs)("select",{value:c.agentType,onChange:e=>l(t=>d(d({},t),{},{agentType:e.target.value})),className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:a,children:[(0,T.jsx)("option",{value:"basic",children:"Basic Agent"}),(0,T.jsx)("option",{value:"voice_convo_agent",children:"Voice Conversation Agent"})]}),(0,T.jsx)("p",{className:"text-xs text-dark-500 mt-1",children:"Voice conversation agents are optimized for low-latency voice interactions"})]}),(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-sm text-white font-medium",children:"Enable Sleeptime"}),(0,T.jsx)("p",{className:"text-xs text-dark-500",children:"Use separate agent for context management"})]}),(0,T.jsx)("button",{type:"button",onClick:()=>l(e=>d(d({},e),{},{enableSleeptime:!e.enableSleeptime})),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-dark-100 ".concat(c.enableSleeptime?"bg-primary-600":"bg-dark-300"),disabled:a,children:(0,T.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(c.enableSleeptime?"translate-x-6":"translate-x-1")})})]}),(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-sm text-white font-medium mb-1 block",children:"Max Buffer Length"}),(0,T.jsx)("input",{type:"number",min:"1",max:"100",value:c.maxMessageBufferLength,onChange:e=>l(t=>d(d({},t),{},{maxMessageBufferLength:parseInt(e.target.value)||20})),className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:a}),(0,T.jsx)("p",{className:"text-xs text-dark-500 mt-1",children:"Maximum messages before compaction"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-sm text-white font-medium mb-1 block",children:"Min Buffer Length"}),(0,T.jsx)("input",{type:"number",min:"1",max:"50",value:c.minMessageBufferLength,onChange:e=>l(t=>d(d({},t),{},{minMessageBufferLength:parseInt(e.target.value)||5})),className:"w-full px-3 py-2 bg-dark-200 border border-dark-300 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:a}),(0,T.jsx)("p",{className:"text-xs text-dark-500 mt-1",children:"Minimum message continuity"})]})]})]})]})]})]}),(0,T.jsxs)("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-dark-200",children:[(0,T.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-dark-400 hover:text-white transition-colors",disabled:a,children:"Cancel"}),(0,T.jsx)("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-primary-800 disabled:cursor-not-allowed text-white rounded-lg transition-colors font-medium",disabled:a,children:a?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(g,{size:16}),"Create Agent"]})})]})]})]})}):null};function Ec(e,t){return function(){return e.apply(t,arguments)}}const{toString:xc}=Object.prototype,{getPrototypeOf:Pc}=Object,{iterator:Rc,toStringTag:Oc}=Symbol,_c=(Nc=Object.create(null),e=>{const t=xc.call(e);return Nc[t]||(Nc[t]=t.slice(8,-1).toLowerCase())});var Nc;const Ic=e=>(e=e.toLowerCase(),t=>_c(t)===e),Ac=e=>t=>typeof t===e,{isArray:Dc}=Array,Mc=Ac("undefined");const Lc=Ic("ArrayBuffer");const jc=Ac("string"),Uc=Ac("function"),Fc=Ac("number"),Bc=e=>null!==e&&"object"===typeof e,zc=e=>{if("object"!==_c(e))return!1;const t=Pc(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Oc in e)&&!(Rc in e)},Vc=Ic("Date"),qc=Ic("File"),Hc=Ic("Blob"),Wc=Ic("FileList"),Kc=Ic("URLSearchParams"),[Gc,Jc,Qc,$c]=["ReadableStream","Request","Response","Headers"].map(Ic);function Yc(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Dc(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let o;for(n=0;n<a;n++)o=i[n],t.call(null,e[o],o,e)}}function Xc(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const Zc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,el=e=>!Mc(e)&&e!==Zc;const tl=(nl="undefined"!==typeof Uint8Array&&Pc(Uint8Array),e=>nl&&e instanceof nl);var nl;const il=Ic("HTMLFormElement"),rl=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),al=Ic("RegExp"),ol=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};Yc(n,(n,r)=>{let a;!1!==(a=t(n,r,e))&&(i[r]=a||n)}),Object.defineProperties(e,i)};const sl=Ic("AsyncFunction"),cl=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),i=[],Zc.addEventListener("message",e=>{let{source:t,data:r}=e;t===Zc&&r===n&&i.length&&i.shift()()},!1),e=>{i.push(e),Zc.postMessage(n,"*")}):e=>setTimeout(e);var n,i})("function"===typeof setImmediate,Uc(Zc.postMessage)),ll="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Zc):"undefined"!==typeof process&&process.nextTick||cl,dl={isArray:Dc,isArrayBuffer:Lc,isBuffer:function(e){return null!==e&&!Mc(e)&&null!==e.constructor&&!Mc(e.constructor)&&Uc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Uc(e.append)&&("formdata"===(t=_c(e))||"object"===t&&Uc(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Lc(e.buffer),t},isString:jc,isNumber:Fc,isBoolean:e=>!0===e||!1===e,isObject:Bc,isPlainObject:zc,isReadableStream:Gc,isRequest:Jc,isResponse:Qc,isHeaders:$c,isUndefined:Mc,isDate:Vc,isFile:qc,isBlob:Hc,isRegExp:al,isFunction:Uc,isStream:e=>Bc(e)&&Uc(e.pipe),isURLSearchParams:Kc,isTypedArray:tl,isFileList:Wc,forEach:Yc,merge:function e(){const{caseless:t}=el(this)&&this||{},n={},i=(i,r)=>{const a=t&&Xc(n,r)||r;zc(n[a])&&zc(i)?n[a]=e(n[a],i):zc(i)?n[a]=e({},i):Dc(i)?n[a]=i.slice():n[a]=i};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&Yc(arguments[r],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Yc(t,(t,i)=>{n&&Uc(t)?e[i]=Ec(t,n):e[i]=t},{allOwnKeys:i}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,a,o;const s={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),a=r.length;a-- >0;)o=r[a],i&&!i(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&Pc(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:_c,kindOfTest:Ic,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(Dc(e))return e;let t=e.length;if(!Fc(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Rc]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:il,hasOwnProperty:rl,hasOwnProp:rl,reduceDescriptors:ol,freezeMethods:e=>{ol(e,(t,n)=>{if(Uc(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];Uc(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach(e=>{n[e]=!0})};return Dc(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Xc,global:Zc,isContextDefined:el,isSpecCompliantForm:function(e){return!!(e&&Uc(e.append)&&"FormData"===e[Oc]&&e[Rc])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(Bc(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const r=Dc(e)?[]:{};return Yc(e,(e,t)=>{const a=n(e,i+1);!Mc(a)&&(r[t]=a)}),t[i]=void 0,r}}return e};return n(e,0)},isAsyncFn:sl,isThenable:e=>e&&(Bc(e)||Uc(e))&&Uc(e.then)&&Uc(e.catch),setImmediate:cl,asap:ll,isIterable:e=>null!=e&&Uc(e[Rc])};function ul(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}dl.inherits(ul,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:dl.toJSONObject(this.config),code:this.code,status:this.status}}});const hl=ul.prototype,pl={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{pl[e]={value:e}}),Object.defineProperties(ul,pl),Object.defineProperty(hl,"isAxiosError",{value:!0}),ul.from=(e,t,n,i,r,a)=>{const o=Object.create(hl);return dl.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),ul.call(o,e.message,t,n,i,r),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};const fl=ul;function ml(e){return dl.isPlainObject(e)||dl.isArray(e)}function gl(e){return dl.endsWith(e,"[]")?e.slice(0,-2):e}function vl(e,t,n){return e?e.concat(t).map(function(e,t){return e=gl(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const bl=dl.toFlatObject(dl,{},null,function(e){return/^is[A-Z]/.test(e)});const yl=function(e,t,n){if(!dl.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=dl.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!dl.isUndefined(t[e])})).metaTokens,r=n.visitor||l,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&dl.isSpecCompliantForm(t);if(!dl.isFunction(r))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(dl.isDate(e))return e.toISOString();if(dl.isBoolean(e))return e.toString();if(!s&&dl.isBlob(e))throw new fl("Blob is not supported. Use a Buffer instead.");return dl.isArrayBuffer(e)||dl.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,r){let s=e;if(e&&!r&&"object"===typeof e)if(dl.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(dl.isArray(e)&&function(e){return dl.isArray(e)&&!e.some(ml)}(e)||(dl.isFileList(e)||dl.endsWith(n,"[]"))&&(s=dl.toArray(e)))return n=gl(n),s.forEach(function(e,i){!dl.isUndefined(e)&&null!==e&&t.append(!0===o?vl([n],i,a):null===o?n:n+"[]",c(e))}),!1;return!!ml(e)||(t.append(vl(r,n,a),c(e)),!1)}const d=[],u=Object.assign(bl,{defaultVisitor:l,convertValue:c,isVisitable:ml});if(!dl.isObject(e))throw new TypeError("data must be an object");return function e(n,i){if(!dl.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+i.join("."));d.push(n),dl.forEach(n,function(n,a){!0===(!(dl.isUndefined(n)||null===n)&&r.call(t,n,dl.isString(a)?a.trim():a,i,u))&&e(n,i?i.concat(a):[a])}),d.pop()}}(e),t};function kl(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Sl(e,t){this._pairs=[],e&&yl(e,this,t)}const Tl=Sl.prototype;Tl.append=function(e,t){this._pairs.push([e,t])},Tl.toString=function(e){const t=e?function(t){return e.call(this,t,kl)}:kl;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const wl=Sl;function Cl(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function El(e,t,n){if(!t)return e;const i=n&&n.encode||Cl;dl.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let a;if(a=r?r(t,n):dl.isURLSearchParams(t)?t.toString():new wl(t,n).toString(i),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const xl=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){dl.forEach(this.handlers,function(t){null!==t&&e(t)})}},Pl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rl={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:wl,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Ol="undefined"!==typeof window&&"undefined"!==typeof document,_l="object"===typeof navigator&&navigator||void 0,Nl=Ol&&(!_l||["ReactNative","NativeScript","NS"].indexOf(_l.product)<0),Il="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Al=Ol&&window.location.href||"http://localhost",Dl=d(d({},i),Rl);const Ml=function(e){function t(e,n,i,r){let a=e[r++];if("__proto__"===a)return!0;const o=Number.isFinite(+a),s=r>=e.length;if(a=!a&&dl.isArray(i)?i.length:a,s)return dl.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o;i[a]&&dl.isObject(i[a])||(i[a]=[]);return t(e,n,i[a],r)&&dl.isArray(i[a])&&(i[a]=function(e){const t={},n=Object.keys(e);let i;const r=n.length;let a;for(i=0;i<r;i++)a=n[i],t[a]=e[a];return t}(i[a])),!o}if(dl.isFormData(e)&&dl.isFunction(e.entries)){const n={};return dl.forEachEntry(e,(e,i)=>{t(function(e){return dl.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),i,n,0)}),n}return null};const Ll={transitional:Pl,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=dl.isObject(e);r&&dl.isHTMLForm(e)&&(e=new FormData(e));if(dl.isFormData(e))return i?JSON.stringify(Ml(e)):e;if(dl.isArrayBuffer(e)||dl.isBuffer(e)||dl.isStream(e)||dl.isFile(e)||dl.isBlob(e)||dl.isReadableStream(e))return e;if(dl.isArrayBufferView(e))return e.buffer;if(dl.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return yl(e,new Dl.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return Dl.isNode&&dl.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=dl.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return yl(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(e,t,n){if(dl.isString(e))try{return(t||JSON.parse)(e),dl.trim(e)}catch(_){if("SyntaxError"!==_.name)throw _}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Ll.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(dl.isResponse(e)||dl.isReadableStream(e))return e;if(e&&dl.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(_){if(n){if("SyntaxError"===_.name)throw fl.from(_,fl.ERR_BAD_RESPONSE,this,null,this.response);throw _}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Dl.classes.FormData,Blob:Dl.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};dl.forEach(["delete","get","head","post","put","patch"],e=>{Ll.headers[e]={}});const jl=Ll,Ul=dl.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Fl=Symbol("internals");function Bl(e){return e&&String(e).trim().toLowerCase()}function zl(e){return!1===e||null==e?e:dl.isArray(e)?e.map(zl):String(e)}function Vl(e,t,n,i,r){return dl.isFunction(i)?i.call(this,t,n):(r&&(t=n),dl.isString(t)?dl.isString(i)?-1!==t.indexOf(i):dl.isRegExp(i)?i.test(t):void 0:void 0)}class ql{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(e,t,n){const r=Bl(t);if(!r)throw new Error("header name must be a non-empty string");const a=dl.findKey(i,r);(!a||void 0===i[a]||!0===n||void 0===n&&!1!==i[a])&&(i[a||t]=zl(e))}const a=(e,t)=>dl.forEach(e,(e,n)=>r(e,n,t));if(dl.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(dl.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,i,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),i=e.substring(r+1).trim(),!n||t[n]&&Ul[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)}),t})(e),t);else if(dl.isObject(e)&&dl.isIterable(e)){let n,i,r={};for(const t of e){if(!dl.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[i=t[0]]=(n=r[i])?dl.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}a(r,t)}else null!=e&&r(t,e,n);return this}get(e,t){if(e=Bl(e)){const n=dl.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(dl.isFunction(t))return t.call(this,e,n);if(dl.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Bl(e)){const n=dl.findKey(this,e);return!(!n||void 0===this[n]||t&&!Vl(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function r(e){if(e=Bl(e)){const r=dl.findKey(n,e);!r||t&&!Vl(0,n[r],r,t)||(delete n[r],i=!0)}}return dl.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];e&&!Vl(0,this[r],r,e,!0)||(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return dl.forEach(this,(i,r)=>{const a=dl.findKey(n,r);if(a)return t[a]=zl(i),void delete t[r];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(r):String(r).trim();o!==r&&delete t[r],t[o]=zl(i),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return dl.forEach(this,(n,i)=>{null!=n&&!1!==n&&(t[i]=e&&dl.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[Fl]=this[Fl]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=Bl(e);t[i]||(!function(e,t){const n=dl.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+n,{value:function(e,n,r){return this[i].call(this,t,e,n,r)},configurable:!0})})}(n,e),t[i]=!0)}return dl.isArray(e)?e.forEach(i):i(e),this}}ql.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),dl.reduceDescriptors(ql.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[i]=e}}}),dl.freezeMethods(ql);const Hl=ql;function Wl(e,t){const n=this||jl,i=t||n,r=Hl.from(i.headers);let a=i.data;return dl.forEach(e,function(e){a=e.call(n,a,r.normalize(),t?t.status:void 0)}),r.normalize(),a}function Kl(e){return!(!e||!e.__CANCEL__)}function Gl(e,t,n){fl.call(this,null==e?"canceled":e,fl.ERR_CANCELED,t,n),this.name="CanceledError"}dl.inherits(Gl,fl,{__CANCEL__:!0});const Jl=Gl;function Ql(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new fl("Request failed with status code "+n.status,[fl.ERR_BAD_REQUEST,fl.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const $l=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let r,a=0,o=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=i[o];r||(r=c),n[a]=s,i[a]=c;let d=o,u=0;for(;d!==a;)u+=n[d++],d%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),c-r<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}};const Yl=function(e,t){let n,i,r=0,a=1e3/t;const o=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=a,n=null,i&&(clearTimeout(i),i=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-r;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];t>=a?o(c,e):(n=c,i||(i=setTimeout(()=>{i=null,o(n)},a-t)))},()=>n&&o(n)]},Xl=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0;const r=$l(50,250);return Yl(n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-i,c=r(s);i=a;e({loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&a<=o?(o-a)/c:void 0,event:n,lengthComputable:null!=o,[t?"download":"upload"]:!0})},n)},Zl=(e,t)=>{const n=null!=e;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},ed=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return dl.asap(()=>e(...n))},td=Dl.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Dl.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Dl.origin),Dl.navigator&&/(msie|trident)/i.test(Dl.navigator.userAgent)):()=>!0,nd=Dl.hasStandardBrowserEnv?{write(e,t,n,i,r,a){const o=[e+"="+encodeURIComponent(t)];dl.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),dl.isString(i)&&o.push("path="+i),dl.isString(r)&&o.push("domain="+r),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function id(e,t,n){let i=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(i||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const rd=e=>e instanceof Hl?d({},e):e;function ad(e,t){t=t||{};const n={};function i(e,t,n,i){return dl.isPlainObject(e)&&dl.isPlainObject(t)?dl.merge.call({caseless:i},e,t):dl.isPlainObject(t)?dl.merge({},t):dl.isArray(t)?t.slice():t}function r(e,t,n,r){return dl.isUndefined(t)?dl.isUndefined(e)?void 0:i(void 0,e,0,r):i(e,t,0,r)}function a(e,t){if(!dl.isUndefined(t))return i(void 0,t)}function o(e,t){return dl.isUndefined(t)?dl.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function s(n,r,a){return a in t?i(n,r):a in e?i(void 0,n):void 0}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>r(rd(e),rd(t),0,!0)};return dl.forEach(Object.keys(Object.assign({},e,t)),function(i){const a=c[i]||r,o=a(e[i],t[i],i);dl.isUndefined(o)&&a!==s||(n[i]=o)}),n}const od=e=>{const t=ad({},e);let n,{data:i,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:c}=t;if(t.headers=s=Hl.from(s),t.url=El(id(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),dl.isFormData(i))if(Dl.hasStandardBrowserEnv||Dl.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map(e=>e.trim()).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(Dl.hasStandardBrowserEnv&&(r&&dl.isFunction(r)&&(r=r(t)),r||!1!==r&&td(t.url))){const e=a&&o&&nd.read(o);e&&s.set(a,e)}return t},sd="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const i=od(e);let r=i.data;const a=Hl.from(i.headers).normalize();let o,s,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=i;function f(){l&&l(),d&&d(),i.cancelToken&&i.cancelToken.unsubscribe(o),i.signal&&i.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const i=Hl.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Ql(function(e){t(e),f()},function(e){n(e),f()},{data:u&&"text"!==u&&"json"!==u?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:i,config:e,request:m}),m=null}m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new fl("Request aborted",fl.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new fl("Network Error",fl.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const r=i.transitional||Pl;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),n(new fl(t,r.clarifyTimeoutError?fl.ETIMEDOUT:fl.ECONNABORTED,e,m)),m=null},void 0===r&&a.setContentType(null),"setRequestHeader"in m&&dl.forEach(a.toJSON(),function(e,t){m.setRequestHeader(t,e)}),dl.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),u&&"json"!==u&&(m.responseType=i.responseType),p&&([c,d]=Xl(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([s,l]=Xl(h),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",l)),(i.cancelToken||i.signal)&&(o=t=>{m&&(n(!t||t.type?new Jl(null,e,m):t),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(o),i.signal&&(i.signal.aborted?o():i.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(i.url);v&&-1===Dl.protocols.indexOf(v)?n(new fl("Unsupported protocol "+v+":",fl.ERR_BAD_REQUEST,e)):m.send(r||null)})},cd=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,i=new AbortController;const r=function(e){if(!n){n=!0,o();const t=e instanceof Error?e:this.reason;i.abort(t instanceof fl?t:new Jl(t instanceof Error?t.message:t))}};let a=t&&setTimeout(()=>{a=null,r(new fl("timeout ".concat(t," of ms exceeded"),fl.ETIMEDOUT))},t);const o=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:s}=i;return s.unsubscribe=()=>dl.asap(o),s}};function ld(e,t){this.v=e,this.k=t}function dd(e){return function(){return new ud(e.apply(this,arguments))}}function ud(e){var t,n;function i(t,n){try{var a=e[t](n),o=a.value,s=o instanceof ld;Promise.resolve(s?o.v:o).then(function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return i(c,n);n=e[c](n).value}r(a.done?"return":"normal",n)},function(e){i("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise(function(a,o){var s={key:e,arg:r,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,i(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function hd(e){return new ld(e,0)}function pd(e){var t={},n=!1;function i(t,i){return n=!0,i=new Promise(function(n){n(e[t](i))}),{done:!1,value:new ld(i,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):i("return",e)}),t}function fd(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new md(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function md(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return md=function(e){this.s=e,this.n=e.next},md.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new md(e)}ud.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},ud.prototype.next=function(e){return this._invoke("next",e)},ud.prototype.throw=function(e){return this._invoke("throw",e)},ud.prototype.return=function(e){return this._invoke("return",e)};const gd=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},vd=function(){var e=dd(function*(e,t){var n,i=!1,r=!1;try{for(var a,o=fd(bd(e));i=!(a=yield hd(o.next())).done;i=!1){const e=a.value;yield*pd(fd(gd(e,t)))}}catch(s){r=!0,n=s}finally{try{i&&null!=o.return&&(yield hd(o.return()))}finally{if(r)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),bd=function(){var e=dd(function*(e){if(e[Symbol.asyncIterator])return void(yield*pd(fd(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield hd(t.read());if(e)break;yield n}}finally{yield hd(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),yd=(e,t,n,i)=>{const r=vd(e,t);let a,o=0,s=e=>{a||(a=!0,i&&i(e))};return new ReadableStream({async pull(e){try{const{done:t,value:i}=await r.next();if(t)return s(),void e.close();let a=i.byteLength;if(n){let e=o+=a;n(e)}e.enqueue(new Uint8Array(i))}catch(t){throw s(t),t}},cancel:e=>(s(e),r.return())},{highWaterMark:2})},kd="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,Sd=kd&&"function"===typeof ReadableStream,Td=kd&&("function"===typeof TextEncoder?(wd=new TextEncoder,e=>wd.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var wd;const Cd=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch(_){return!1}},Ed=Sd&&Cd(()=>{let e=!1;const t=new Request(Dl.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),xd=Sd&&Cd(()=>dl.isReadableStream(new Response("").body)),Pd={stream:xd&&(e=>e.body)};var Rd;kd&&(Rd=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Pd[e]&&(Pd[e]=dl.isFunction(Rd[e])?t=>t[e]():(t,n)=>{throw new fl("Response type '".concat(e,"' is not supported"),fl.ERR_NOT_SUPPORT,n)})}));const Od=async(e,t)=>{const n=dl.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(dl.isBlob(e))return e.size;if(dl.isSpecCompliantForm(e)){const t=new Request(Dl.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return dl.isArrayBufferView(e)||dl.isArrayBuffer(e)?e.byteLength:(dl.isURLSearchParams(e)&&(e+=""),dl.isString(e)?(await Td(e)).byteLength:void 0)})(t):n},_d={http:null,xhr:sd,fetch:kd&&(async e=>{let{url:t,method:n,data:i,signal:r,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:c,responseType:l,headers:u,withCredentials:h="same-origin",fetchOptions:p}=od(e);l=l?(l+"").toLowerCase():"text";let f,m=cd([r,a&&a.toAbortSignal()],o);const g=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(c&&Ed&&"get"!==n&&"head"!==n&&0!==(v=await Od(u,i))){let e,n=new Request(t,{method:"POST",body:i,duplex:"half"});if(dl.isFormData(i)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body){const[e,t]=Zl(v,Xl(ed(c)));i=yd(n.body,65536,e,t)}}dl.isString(h)||(h=h?"include":"omit");const r="credentials"in Request.prototype;f=new Request(t,d(d({},p),{},{signal:m,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:r?h:void 0}));let a=await fetch(f,p);const o=xd&&("stream"===l||"response"===l);if(xd&&(s||o&&g)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=a[t]});const t=dl.toFiniteNumber(a.headers.get("content-length")),[n,i]=s&&Zl(t,Xl(ed(s),!0))||[];a=new Response(yd(a.body,65536,n,()=>{i&&i(),g&&g()}),e)}l=l||"text";let b=await Pd[dl.findKey(Pd,l)||"text"](a,e);return!o&&g&&g(),await new Promise((t,n)=>{Ql(t,n,{data:b,headers:Hl.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:f})})}catch(b){if(g&&g(),b&&"TypeError"===b.name&&/Load failed|fetch/i.test(b.message))throw Object.assign(new fl("Network Error",fl.ERR_NETWORK,e,f),{cause:b.cause||b});throw fl.from(b,b&&b.code,e,f)}})};dl.forEach(_d,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(_){}Object.defineProperty(e,"adapterName",{value:t})}});const Nd=e=>"- ".concat(e),Id=e=>dl.isFunction(e)||null===e||!1===e,Ad=e=>{e=dl.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let a=0;a<t;a++){let t;if(n=e[a],i=n,!Id(n)&&(i=_d[(t=String(n)).toLowerCase()],void 0===i))throw new fl("Unknown adapter '".concat(t,"'"));if(i)break;r[t||"#"+a]=i}if(!i){const e=Object.entries(r).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let n=t?e.length>1?"since :\n"+e.map(Nd).join("\n"):" "+Nd(e[0]):"as no adapter specified";throw new fl("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return i};function Dd(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Jl(null,e)}function Md(e){Dd(e),e.headers=Hl.from(e.headers),e.data=Wl.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Ad(e.adapter||jl.adapter)(e).then(function(t){return Dd(e),t.data=Wl.call(e,e.transformResponse,t),t.headers=Hl.from(t.headers),t},function(t){return Kl(t)||(Dd(e),t&&t.response&&(t.response.data=Wl.call(e,e.transformResponse,t.response),t.response.headers=Hl.from(t.response.headers))),Promise.reject(t)})}const Ld="1.10.0",jd={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{jd[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Ud={};jd.transitional=function(e,t,n){function i(e,t){return"[Axios v"+Ld+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,a)=>{if(!1===e)throw new fl(i(r," has been removed"+(t?" in "+t:"")),fl.ERR_DEPRECATED);return t&&!Ud[r]&&(Ud[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}},jd.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const Fd={assertOptions:function(e,t,n){if("object"!==typeof e)throw new fl("options must be an object",fl.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const a=i[r],o=t[a];if(o){const t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new fl("option "+a+" must be "+n,fl.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new fl("Unknown option "+a,fl.ERR_BAD_OPTION)}},validators:jd},Bd=Fd.validators;class zd{constructor(e){this.defaults=e||{},this.interceptors={request:new xl,response:new xl}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(_){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=ad(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;void 0!==n&&Fd.assertOptions(n,{silentJSONParsing:Bd.transitional(Bd.boolean),forcedJSONParsing:Bd.transitional(Bd.boolean),clarifyTimeoutError:Bd.transitional(Bd.boolean)},!1),null!=i&&(dl.isFunction(i)?t.paramsSerializer={serialize:i}:Fd.assertOptions(i,{encode:Bd.function,serialize:Bd.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Fd.assertOptions(t,{baseUrl:Bd.spelling("baseURL"),withXsrfToken:Bd.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&dl.merge(r.common,r[t.method]);r&&dl.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=Hl.concat(a,r);const o=[];let s=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let d,u=0;if(!s){const e=[Md.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{l=Md.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return El(id((e=ad(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}dl.forEach(["delete","get","head","options"],function(e){zd.prototype[e]=function(t,n){return this.request(ad(n||{},{method:e,url:t,data:(n||{}).data}))}}),dl.forEach(["post","put","patch"],function(e){function t(t){return function(n,i,r){return this.request(ad(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}zd.prototype[e]=t(),zd.prototype[e+"Form"]=t(!0)});const Vd=zd;class qd{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const i=new Promise(e=>{n.subscribe(e),t=e}).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e(function(e,i,r){n.reason||(n.reason=new Jl(e,i,r),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new qd(function(t){e=t}),cancel:e}}}const Hd=qd;const Wd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Wd).forEach(e=>{let[t,n]=e;Wd[n]=t});const Kd=Wd;const Gd=function e(t){const n=new Vd(t),i=Ec(Vd.prototype.request,n);return dl.extend(i,Vd.prototype,n,{allOwnKeys:!0}),dl.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(ad(t,n))},i}(jl);Gd.Axios=Vd,Gd.CanceledError=Jl,Gd.CancelToken=Hd,Gd.isCancel=Kl,Gd.VERSION=Ld,Gd.toFormData=yl,Gd.AxiosError=fl,Gd.Cancel=Gd.CanceledError,Gd.all=function(e){return Promise.all(e)},Gd.spread=function(e){return function(t){return e.apply(null,t)}},Gd.isAxiosError=function(e){return dl.isObject(e)&&!0===e.isAxiosError},Gd.mergeConfig=ad,Gd.AxiosHeaders=Hl,Gd.formToJSON=e=>Ml(dl.isHTMLForm(e)?new FormData(e):e),Gd.getAdapter=Ad,Gd.HttpStatusCode=Kd,Gd.default=Gd;const Jd=Gd;const Qd=new class{constructor(){this.baseUrl=void 0,this.apiKey=void 0,this.baseUrl="http://localhost:8284",this.apiKey={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_LIVEKIT_URL:"wss://test-9m0bd0iw.livekit.cloud",REACT_APP_LIVEKIT_API_KEY:"APIvewCcq5Rxi8X",REACT_APP_LIVEKIT_API_SECRET:"hYsLrq4mJgPeBd5zevoo4RVeB7DMOj6gvaPxz1Vp0DtA",REACT_APP_DEEPGRAM_API_KEY:"b588f1608d86f2268f76d00d90f4210e1d71d464",REACT_APP_CARTESIA_API_KEY:"sk_car_vYKXUKKFtepsuvtLXkwchF",REACT_APP_LETTA_API_URL:"http://localhost:8284",REACT_APP_TWILIO_PHONE_NUMBER:"+1234567890",REACT_APP_BACKEND_URL:"http://localhost:3002",REACT_APP_WEBSOCKET_URL:"ws://localhost:3002"}.REACT_APP_LETTA_API_KEY||""}getHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e.Authorization="Bearer ".concat(this.apiKey)),e}async createAgent(e){try{const t=e.voiceSettings,n=(null===t||void 0===t?void 0:t.enabled)&&"voice_convo_agent"===(null===t||void 0===t?void 0:t.agentType),i={name:e.name,memory_blocks:[{label:"persona",value:e.persona||"You are a helpful AI assistant that can make and receive phone calls."},{label:"human",value:e.human||"The user is a human who needs assistance with phone calls."}],llm_config:{model:"gpt-4o-mini",model_endpoint_type:"openai",model_endpoint:"https://api.openai.com/v1",context_window:128e3},embedding_config:{embedding_model:"text-embedding-3-small",embedding_endpoint_type:"openai",embedding_endpoint:"https://api.openai.com/v1",embedding_dim:1536}};n&&(i.agent_type="voice_convo_agent",i.enable_sleeptime=t.enableSleeptime,i.max_message_buffer_length=t.maxMessageBufferLength,i.min_message_buffer_length=t.minMessageBufferLength);return(await Jd.post("".concat(this.baseUrl,"/v1/agents/"),i,{headers:this.getHeaders(),timeout:1e4,maxRedirects:5})).data}catch(s){if(console.error("Error creating Letta agent:",s),Jd.isAxiosError(s)){var t,n,i,r,a,o;const e=(null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.detail)||(null===(i=s.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||s.message,c=null===(a=s.response)||void 0===a?void 0:a.status,l="Status: ".concat(c,", Error: ").concat(e,", URL: ").concat(null===(o=s.config)||void 0===o?void 0:o.url);throw console.error("Full error details:",l),new Error("Failed to create agent: ".concat(l))}throw new Error("Failed to create agent: ".concat(s instanceof Error?s.message:"Unknown error"))}}async getAgents(){try{return(await Jd.get("".concat(this.baseUrl,"/v1/agents/"),{headers:this.getHeaders(),timeout:1e4,maxRedirects:5})).data}catch(n){var e,t;if(console.error("Error fetching Letta agents:",n),Jd.isAxiosError(n))throw new Error("Failed to fetch agents: ".concat((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n.message));throw new Error("Failed to fetch agents: Unknown error")}}async deleteAgent(e){try{await Jd.delete("".concat(this.baseUrl,"/v1/agents/").concat(e),{headers:this.getHeaders(),timeout:1e4,maxRedirects:5})}catch(i){var t,n;if(console.error("Error deleting Letta agent:",i),Jd.isAxiosError(i))throw new Error("Failed to delete agent: ".concat((null===(t=i.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||i.message));throw new Error("Failed to delete agent: Unknown error")}}async deleteAllAgents(){try{const e=await this.getAgents();if(console.log("Found ".concat(e.length," agents to delete")),0===e.length)return void console.log("No agents to delete");const t=[];for(const a of e)try{console.log("Deleting agent: ".concat(a.id," (").concat(a.name,")")),await this.deleteAgent(a.id),console.log("Successfully deleted agent: ".concat(a.id)),t.push({id:a.id,success:!0})}catch(i){console.error("Failed to delete agent ".concat(a.id,":"),i),t.push({id:a.id,success:!1,error:i})}const n=t.filter(e=>e.success).length,r=t.filter(e=>!e.success).length;if(console.log("Deletion complete: ".concat(n," successful, ").concat(r," failed")),r>0&&0===n)throw new Error("All ".concat(r," agent deletions failed"));r>0&&console.warn("".concat(r," out of ").concat(e.length," agents failed to delete, but ").concat(n," were successful"))}catch(i){var e,t,n;if(console.error("Error in deleteAllAgents:",i),i instanceof Error&&null!==(e=i.message)&&void 0!==e&&e.includes("agent deletions failed"))throw i;if(Jd.isAxiosError(i))throw new Error("Failed to delete all agents: ".concat((null===(t=i.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||i.message));throw new Error("Failed to delete all agents: ".concat(i instanceof Error?i.message:"Unknown error"))}}async getMessages(e,t,n){try{const i=new URLSearchParams;void 0!==t&&i.append("start",t.toString()),void 0!==n&&i.append("count",n.toString());return(await Jd.get("".concat(this.baseUrl,"/v1/agents/").concat(e,"/messages?").concat(i.toString()),{headers:this.getHeaders(),timeout:1e4})).data}catch(a){var i,r;if(console.error("Error fetching Letta messages:",a),Jd.isAxiosError(a))throw new Error("Failed to fetch messages: ".concat((null===(i=a.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||a.message));throw new Error("Failed to fetch messages: Unknown error")}}getVoiceEndpoint(e){const t=this.baseUrl.replace(":8284",":8283");return"".concat(t,"/v1/voice-beta/").concat(e)}},$d=[{id:"1",name:"customer_support_guide.pdf",size:1024e3,type:"application/pdf",uploadDate:new Date(Date.now()-864e5)},{id:"2",name:"product_catalog.xlsx",size:2048e3,type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",uploadDate:new Date(Date.now()-1728e5)},{id:"3",name:"company_logo.png",size:512e3,type:"image/png",uploadDate:new Date(Date.now()-2592e5)}];const Yd=function(){var e;const[t,n]=(0,r.useState)({agents:[],selectedAgent:null,currentSession:null,currentCall:null,context:"You are a helpful customer support agent. Be polite, professional, and solve customer issues efficiently. Always confirm understanding before providing solutions.",files:$d,isContextUpdating:!1}),[i,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{const e=(await Qd.getAgents()).filter(e=>!e.name.endsWith("sleeptime")).map(e=>({id:e.id,name:e.name,status:"online",lastActive:new Date(e.updated_at),description:e.persona?e.persona.split(".")[0]:"Letta AI Agent",autoReceiveCalls:!0}));n(t=>d(d({},t),{},{agents:e}))}catch(e){console.error("Failed to load Letta agents:",e)}})()},[]),(0,r.useEffect)(()=>{var e;if(null===(e=t.selectedAgent)||void 0===e||!e.id)return;const i=setInterval(async()=>{try{const e=(await Qd.getMessages(t.selectedAgent.id)).filter(e=>"assistant_message"===e.message_type||"user"===e.role).map((e,t)=>({id:e.id||"msg-".concat(t),content:e.message||e.content||"",timestamp:new Date(e.created_at||Date.now()),sender:"assistant_message"===e.message_type||"assistant"===e.role?"agent":"caller",type:"text"}));n(t=>d(d({},t),{},{currentSession:t.currentSession?d(d({},t.currentSession),{},{messages:e}):null}))}catch(e){e instanceof Error&&e.message.includes("404")||console.error("Failed to poll messages:",e)}},5e3);return()=>clearInterval(i)},[null===(e=t.selectedAgent)||void 0===e?void 0:e.id]);const c=(0,r.useCallback)(async e=>{n(t=>d(d({},t),{},{selectedAgent:e,currentSession:{id:"session-".concat(e.id),agentId:e.id,messages:[],status:"active",startTime:new Date}}));try{const t=(await Qd.getMessages(e.id)).filter(e=>"assistant_message"===e.message_type||"user"===e.role).map((e,t)=>({id:e.id||"msg-".concat(t),content:e.message||e.content||"",timestamp:new Date(e.created_at||Date.now()),sender:"assistant_message"===e.message_type||"assistant"===e.role?"agent":"caller",type:"text"}));n(e=>d(d({},e),{},{currentSession:e.currentSession?d(d({},e.currentSession),{},{messages:t}):null}))}catch(t){t instanceof Error&&t.message.includes("404")||console.error("Failed to fetch messages for agent:",e.id,t)}},[]),l=(0,r.useCallback)(()=>{a(!0)},[]),u=(0,r.useCallback)(async()=>{if(window.confirm("Are you sure you want to delete ALL agents from the Letta server? This action cannot be undone."))try{await Qd.deleteAllAgents();const e=(await Qd.getAgents()).filter(e=>!e.name.endsWith("sleeptime")).map(e=>({id:e.id,name:e.name,status:"online",lastActive:new Date(e.updated_at),description:e.persona?e.persona.split(".")[0]:"Letta AI Agent",autoReceiveCalls:!0}));n(t=>d(d({},t),{},{agents:e,selectedAgent:null,currentSession:null})),0===e.length?alert("\u2705 All agents have been successfully deleted from the server."):alert("\u26a0\ufe0f Deletion completed. ".concat(e.length," agents remain on the server."))}catch(e){console.error("Failed to delete all agents:",e),alert("\u274c Failed to delete agents: ".concat(e instanceof Error?e.message:"Unknown error"))}},[]),h=(0,r.useCallback)(async e=>{s(!0);try{const t=await Qd.createAgent({name:e.name,persona:e.persona,human:e.human,voiceSettings:e.voiceSettings}),i={id:t.id,name:t.name,status:"online",lastActive:new Date,description:e.persona.split(".")[0]};n(e=>d(d({},e),{},{agents:[...e.agents,i],selectedAgent:i,currentSession:null})),a(!1),console.log("Agent created successfully:",t)}catch(t){console.error("Failed to create agent:",t),alert("Failed to create agent: ".concat(t instanceof Error?t.message:"Unknown error"))}finally{s(!1)}},[]),p=(0,r.useCallback)(async e=>{n(e=>d(d({},e),{},{isContextUpdating:!0})),await new Promise(e=>setTimeout(e,1e3)),n(t=>d(d({},t),{},{context:e,isContextUpdating:!1})),console.log("Context updated:",e)},[]),f=(0,r.useCallback)(e=>{const t=Array.from(e).map((e,t)=>({id:"new-".concat(Date.now(),"-").concat(t),name:e.name,size:e.size,type:e.type,uploadDate:new Date}));n(e=>d(d({},e),{},{files:[...e.files,...t]})),console.log("Files uploaded:",t)},[]),m=(0,r.useCallback)(e=>{n(t=>d(d({},t),{},{files:t.files.filter(t=>t.id!==e)})),console.log("File deleted:",e)},[]),g=(0,r.useCallback)(e=>{console.log("Downloading file:",e.name),alert("Download feature for ".concat(e.name," coming soon!"))},[]),v=(0,r.useCallback)((e,t)=>{n(n=>d(d({},n),{},{agents:n.agents.map(n=>n.id===e?d(d({},n),{},{autoReceiveCalls:t}):n)})),console.log("Auto-receive calls ".concat(t?"enabled":"disabled"," for agent ").concat(e))},[]),b=(0,r.useCallback)(async(e,i)=>{if(!t.agents.find(t=>t.id===e))return void alert("Agent not found");if(!i)return void alert("Please enter a phone number to call");const r={id:"call-".concat(Date.now()),agentId:e,status:"connecting",startTime:new Date,callerInfo:{phone:i}};n(t=>d(d({},t),{},{currentCall:r,agents:t.agents.map(t=>t.id===e?d(d({},t),{},{status:"busy"}):t)}));try{const t=await fetch("http://localhost:3002/api/make-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:i,agentId:e})}),r=await t.json();if(!t.ok){var a;if(409===t.status&&"number_busy"===r.error)return alert("".concat(r.message,"\n\n").concat(r.details,"\n\nPlease try a different number or wait for the current call to end.")),void n(t=>d(d({},t),{},{currentCall:null,agents:t.agents.map(t=>t.id===e?d(d({},t),{},{status:"online"}):t)}));if(503===t.status&&null!==(a=r.error)&&void 0!==a&&a.includes("demo mode"))return alert("\u26a0\ufe0f LiveKit SIP not configured.\n\nTo enable real calls:\n1. Set LIVEKIT_API_KEY and LIVEKIT_API_SECRET in .env\n2. Configure SIP trunk ID in .env.agent\n3. Restart the server"),void n(t=>d(d({},t),{},{currentCall:null,agents:t.agents.map(t=>t.id===e?d(d({},t),{},{status:"online"}):t)}));throw new Error("Failed to make call: ".concat(r.error||t.statusText))}console.log("Outbound call dispatched:",r),n(e=>d(d({},e),{},{currentCall:e.currentCall?d(d({},e.currentCall),{},{id:r.roomName||"call-".concat(Date.now()),status:"connected"}):null}))}catch(o){console.error("Failed to start call:",o),n(t=>d(d({},t),{},{currentCall:null,agents:t.agents.map(t=>t.id===e?d(d({},t),{},{status:"online"}):t)})),alert("Failed to start call: ".concat(o instanceof Error?o.message:"Unknown error"))}},[t.agents,t.currentCall]),y=(0,r.useCallback)(async()=>{if(t.currentCall){const r=d(d({},t.currentCall),{},{status:"ended",endTime:new Date,duration:Math.floor(((new Date).getTime()-t.currentCall.startTime.getTime())/1e3)});try{var e;await fetch("http://localhost:3002/api/end-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:null===(e=t.currentCall.callerInfo)||void 0===e?void 0:e.phone,agentId:t.currentCall.agentId})})}catch(i){console.error("Failed to end call on backend:",i)}n(e=>d(d({},e),{},{currentCall:null,agents:e.agents.map(e=>e.id===r.agentId?d(d({},e),{},{status:"online"}):e)})),console.log("Call ended:",r)}},[t.currentCall]),k=(0,r.useCallback)(e=>{n(t=>d(d({},t),{},{currentCall:e}))},[]);return(0,T.jsxs)("div",{className:"flex h-screen bg-dark-50 text-white",children:[(0,T.jsx)("div",{className:"w-80 flex-shrink-0",children:(0,T.jsx)(w,{agents:t.agents,selectedAgent:t.selectedAgent,onAgentSelect:c,onNewAgent:l,onToggleAutoReceive:v,onDeleteAllAgents:u})}),(0,T.jsx)("div",{className:"flex-1",children:(0,T.jsx)(hc,{agent:t.selectedAgent,session:t.currentSession,currentCall:t.currentCall,onStartCall:b,onEndCall:y,onCallStatusUpdate:k})}),(0,T.jsx)("div",{className:"w-80 flex-shrink-0",children:(0,T.jsx)(Tc,{context:t.context,files:t.files,isContextUpdating:t.isContextUpdating,onContextUpdate:p,onFileUpload:f,onFileDelete:m,onFileDownload:g})}),(0,T.jsx)(Cc,{isOpen:i,onClose:()=>a(!1),onCreateAgent:h,isCreating:o})]})};a.createRoot(document.getElementById("root")).render((0,T.jsx)(r.StrictMode,{children:(0,T.jsx)(Yd,{})}))})();
//# sourceMappingURL=main.49c09005.js.map